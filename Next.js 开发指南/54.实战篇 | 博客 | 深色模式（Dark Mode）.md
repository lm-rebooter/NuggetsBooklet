## å‰è¨€

æœ¬ç¯‡æˆ‘ä»¬æ¥å®ç°æ·±è‰²æ¨¡å¼ã€‚å®ƒä¹Ÿè¢«å«åšæš—é»‘æ¨¡å¼ã€é»‘å¤œæ¨¡å¼ç­‰ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬é€‰ç”¨çš„æ˜¯è‹¹æœå®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42e0a67dbaec435d9b2efd47a3531122~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2104\&h=616\&s=266452\&e=png\&b=fdfdfd)

## 1. æ·±è‰²æ¨¡å¼

â€œæ·±è‰²æ¨¡å¼â€æœ¬è´¨ä¸Šæ˜¯ä¸€å¥—é‡‡ç”¨æ·±è‰²èƒŒæ™¯ã€æµ…è‰²æ–‡æ¡ˆçš„é…è‰²æ–¹æ¡ˆã€‚å…¶å®å¾ˆæ—©å°±æœ‰ã€‚ç°åœ¨è¶Šæ¥è¶Šæµè¡Œï¼Œæ˜¯å› ä¸ºè‹¹æœåœ¨ 2018 å¹´æå‡ºäº†è¿™ä¸€æ¦‚å¿µã€‚

å…ˆæ˜¯ 2018 å¹´çš„ macOS Mojave ç‡å…ˆæ”¯æŒäº†æ·±è‰²å¤–è§‚ï¼Œç„¶å 2019 å¹´ IOS 13 æ­£å¼æ”¯æŒæ·±è‰²å¤–è§‚ã€‚è¿™äº›éƒ½æ˜¯ç³»ç»Ÿçº§åˆ«çš„æ”¯æŒï¼Œå¯ä»¥å°†æ•´ä¸ªç³»ç»Ÿçš„ç•Œé¢åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼ã€‚ç”±æ­¤æ·±è‰²æ¨¡å¼å¼€å§‹è¿›å…¥äººä»¬çš„è§†é‡ï¼Œæˆä¸ºè®¾è®¡å¸ˆã€å‰ç«¯å·¥ç¨‹å¸ˆçš„å­¦ä¹ å†…å®¹â€¦â€¦

ä½¿ç”¨æ·±è‰²æ¨¡å¼ä¹Ÿç¡®å®æœ‰ä¸€äº›å¥½å¤„ï¼š

1.  ä¿æŠ¤è§†åŠ›ã€‚æ¯•ç«Ÿæ™šä¸Šçš„æ—¶å€™ï¼Œæµ…è‰²æœ‰äº›åˆºçœ¼ã€‚
2.  å¢åŠ æ²‰æµ¸æ„Ÿã€‚é˜…è¯»æµè§ˆç±» App æˆ–æ˜¯å†…å®¹åˆ›ä½œå‹ Appï¼ˆæ¯”å¦‚ä»£ç ç¼–è¾‘å™¨ï¼‰å¾€å¾€ä¼šä½¿ç”¨æ·±è‰²æ¨¡å¼ï¼Œå®ƒä»¬ä¼šå€ŸåŠ©é»‘åº•ç™½å­—çš„é«˜å¯¹æ¯”åº¦ç‰¹æ€§è®©ç”¨æˆ·è§†çº¿ä¿æŒé›†ä¸­ã€‚æ‰€ä»¥åˆ‡æ¢æ·±è‰²æ¨¡å¼åï¼Œå¯ä»¥å¢åŠ æ²‰æµ¸æ„Ÿï¼Œæå‡ä½¿ç”¨æ¬²æœ›ã€‚
3.  çœç”µã€‚æ ¹æ®è°·æ­Œçš„å®˜æ–¹æ•°æ®ï¼Œé‡‡ç”¨ OLED å±å¹•çš„æ‰‹æœºåœ¨ã€Œæ·±è‰²æ¨¡å¼ã€ä¸‹ï¼Œè€—ç”µå¯ä¸‹é™è¾¾63%ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea2428b4d4df4a5a8a7eaca04607e892~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=3024\&h=1516\&s=396568\&e=png\&b=111111)

## 2. å¦‚ä½•é€‚é…ï¼Ÿ

å¦‚æœæˆ‘ä»¬å¼€å‘é¡µé¢ï¼Œè¯¥å¦‚ä½•æ”¯æŒæ·±è‰²æ¨¡å¼å‘¢ï¼Ÿ

### 2.1. CSS åª’ä½“æŸ¥è¯¢

CSS æä¾›äº† [prefers-color-scheme](https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme) åª’ä½“æŸ¥è¯¢ç‰¹æ€§ï¼Œç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å°†ç³»ç»Ÿçš„ä¸»é¢˜è‰²è®¾ç½®ä¸ºæµ…è‰²æˆ–è€…æ·±è‰²ã€‚

æ¯”å¦‚ Next.js è„šæ‰‹æ¶é»˜è®¤åˆ›å»ºé¡¹ç›®çš„ `app/globals.css`ä¸­ï¼Œå°±æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```javascript
:root {
  --foreground-rgb: 0, 0, 0;
  --background-start-rgb: 214, 219, 220;
  --background-end-rgb: 255, 255, 255;
}

@media (prefers-color-scheme: dark) {
  :root {
    --foreground-rgb: 255, 255, 255;
    --background-start-rgb: 0, 0, 0;
    --background-end-rgb: 0, 0, 0;
  }
}
```

è¿™å°±æ˜¯ä¸€æ®µæ ¹æ®ç³»ç»Ÿçš„ä¸»é¢˜è‰²è°ƒæ•´ç½‘é¡µåŸºç¡€æ ·å¼çš„ä»£ç ã€‚æ­¤æ—¶é¡µé¢ä¼šæ ¹æ®ç³»ç»Ÿçš„å¤–è§‚æ¨¡å¼è¿›è¡Œè°ƒæ•´ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š

![1.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fcc5d4d12534980a1a3ab7665b24fcb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=923\&h=630\&s=471100\&e=gif\&f=40\&b=ececee)

æ³¨ï¼šæµè§ˆå™¨è®¾ç½®é‡Œä¹Ÿæœ‰è®¾ç½®æ¨¡å¼çš„åœ°æ–¹ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e3c585429d14ad591703e9b78978256~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1848\&h=444\&s=81383\&e=png\&b=26272a)

ä½†è¿™é‡Œè®¾ç½®çš„æ˜¯æµè§ˆå™¨çš„å¤–è§‚ï¼Œä¸ä¼šå½±å“å…·ä½“é¡µé¢çš„å¤–è§‚æ¨¡å¼ã€‚

### 2.2. JS æŸ¥è¯¢

CSS æŸ¥è¯¢ä¼šè‡ªåŠ¨è·Ÿéšç³»ç»Ÿè®¾ç½®ï¼Œä½†å¦‚æœä½ è¦è‡ªå®šä¹‰å¤–è§‚æ¨¡å¼ï¼Œå°±æ¯”å¦‚å¾ˆå¤šåšå®¢é¡µé¢å³ä¸Šè§’éƒ½æœ‰ä¸ªå¤–è§‚æ¨¡å¼æŒ‰é’®ï¼Œç‚¹å‡»å¯ä»¥åˆ‡æ¢åˆ° light / dark æ¨¡å¼ï¼Œè¿™ç§å°±éœ€è¦ä¾èµ– JS äº†ã€‚

Web API æä¾›äº† [Window.matchMedia()](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia) æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„ MediaQueryList å¯¹è±¡ï¼Œè¡¨ç¤ºæŒ‡å®šçš„åª’ä½“æŸ¥è¯¢å­—ç¬¦ä¸²è§£æåçš„ç»“æœã€‚è¿”å›çš„ MediaQueryList å¯è¢«ç”¨äºåˆ¤å®š Document æ˜¯å¦åŒ¹é…åª’ä½“æŸ¥è¯¢ï¼Œæˆ–è€…ç›‘æ§ä¸€ä¸ª document æ¥åˆ¤å®šå®ƒåŒ¹é…äº†æˆ–è€…åœæ­¢åŒ¹é…äº†æ­¤åª’ä½“æŸ¥è¯¢ã€‚

#### åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ·±è‰²æ¨¡å¼

```javascript
if (window.matchMedia('(prefers-color-scheme)').media !== 'not all') {
  console.log('ğŸ‰ Dark mode is supported');
}
```

å…¶å®æ”¯æŒç‡è¿˜è›®å¥½çš„ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58867d0f23414c83b94d4368abb91e66~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=3430\&h=1442\&s=524605\&e=png\&b=f0e8d8)

#### ç›‘å¬æ·±è‰²æ¨¡å¼å˜åŒ–

```javascript
const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

darkModeMediaQuery.addEventListener('change', (e) => {
  const darkModeOn = e.matches;
  console.log(`Dark mode is ${darkModeOn ? 'ğŸŒ’ on' : 'â˜€ï¸ off'}.`);
});
```

#### è‡ªå®šä¹‰ React hook

å¦‚æœä½¿ç”¨ Reactï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª hookï¼Œæ–°å»º `app/theme.js`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
import { useEffect, useState } from "react"

function useTheme() {
 
  const [theme, setTheme] = useState('light')

  useEffect(() => {

    const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setTheme(darkModeMediaQuery.matches ? 'dark' : 'light')
    const listener = (event) => {
      setTheme(event.matches ? 'dark' : 'light');
    };

    darkModeMediaQuery.addEventListener('change', listener);
    return () => {
      darkModeMediaQuery.removeEventListener('change', listener);
    };
    
  }, [])
  
  return {
    theme,
    isDarkMode: theme === "dark",
    isLightMode: theme === "light",
  }
}

export default useTheme
```

ä¿®æ”¹ `app/page.js`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
'use client'

import Image from "next/image";
import useTheme from "./theme";

export default function Home() {
  
  const {theme} = useTheme()

  return (
    <div>Hello World! {theme}</div>
  );
}

```

æµè§ˆå™¨æ•ˆæœå¦‚ä¸‹ï¼š

![3.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93460b20b16b4038b4d32308b28e8e84~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1153\&h=558\&s=281990\&e=gif\&f=23\&b=e4e9ec)

### 2.3. æµ‹è¯•ä¸åŒçš„æ¨¡å¼

å¦‚æœè¦æµ‹è¯•é¡µé¢çš„æµ…è‰²/æ·±è‰²æ¨¡å¼ï¼Œä¿®æ”¹ç³»ç»Ÿçš„å¤–è§‚æ¨¡å¼ä¼šæœ‰äº›éº»çƒ¦ï¼ŒChrome æä¾›äº†å¿«é€Ÿåˆ‡æ¢çš„æ–¹å¼ï¼š

![2.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f81e3cdefa1a43159a1502ffe1f3f8a9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1196\&h=558\&s=366613\&e=gif\&f=32\&b=fcfcfc)

å…¶æ­¥éª¤ä¸ºï¼š

1.  æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2.  Command + Shift + P æ‰“å¼€å‘½ä»¤
3.  è¾“å…¥ dark æˆ–è€… light æœç´¢å‘½ä»¤
4.  å›è½¦ç¡®å®š

æ³¨ï¼šè¿™åªæ˜¯ç”¨äºæµ‹è¯•ï¼Œæ•ˆæœæ˜¯æš‚æ—¶çš„ï¼Œå…³é—­å¼€å‘è€…å·¥å…·ï¼Œå°±ä¼šé€€å‡ºè®¾ç½®çš„æ ·å¼ã€‚

## 3. å®æˆ˜åº”ç”¨

åŸºç¡€çŸ¥è¯†æˆ‘ä»¬å°±è¯´è¿™ä¹ˆå¤šï¼Œåªæ˜¯å¸®åŠ©å¤§å®¶ç†è§£æ·±è‰²æ¨¡å¼çš„æ¦‚å¿µå’Œå®ç°çš„åŸºæœ¬åŸç†ã€‚

åœ¨ Next.js é¡¹ç›®ä¸­ï¼Œå®ç°æ‰‹åŠ¨åˆ‡æ¢å¤–è§‚æ¨¡å¼çš„æ•ˆæœï¼Œé€šå¸¸è¿˜è¦æ­é… React Context æˆ–è€…çŠ¶æ€ç®¡ç†åº“æ¥å®ç°ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ [next-themes](https://github.com/pacocoursey/next-themes) è¿™ä¸ªåŒ…æ¥å®ç°ã€‚

### 3.1. next-themes

å®‰è£…ä¾èµ–é¡¹ï¼š

```bash
npm install next-themes @headlessui/react
```

å…¶ä¸­ [@headlessui/react](https://github.com/tailwindlabs/headlessui) æ˜¯ UI åº“ï¼Œååˆ†é€‚åˆæ­é… Tailwind.cssã€‚

æ–°å»º `app/theme-providers.js`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```jsx
'use client'

import { ThemeProvider } from 'next-themes'

export function ThemeProviders({ children }) {
  return (
    <ThemeProvider attribute="class" defaultTheme="light" enableSystem>
      {children}
    </ThemeProvider>
  )
}
```

ä¿®æ”¹ `app/layout.js`ï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š

```jsx
import siteMetadata from '@/data/siteMetadata'
import "./globals.css";
import { ThemeProviders } from './theme-providers'

export const metadata = {
  // ...
}

export default function RootLayout({ children }) {
  return (
    <html lang={siteMetadata.locale} suppressHydrationWarning>
      <body>
        <ThemeProviders>
          {children}
        </ThemeProviders>
      </body>
    </html>
  );
}
```

ä¿®æ”¹çš„ä»£ç æœ‰ 2 ç‚¹ï¼š

1.  html ä½¿ç”¨ suppressHydrationWarning å–æ¶ˆæ°´åˆé”™è¯¯è­¦å‘Šï¼Œè¿™æ˜¯å› ä¸º next-theme ä¼šä¿®æ”¹ html å…ƒç´ çš„å±æ€§ã€‚å› ä¸º suppressHydrationWarning åªä½œç”¨äºä¸€å±‚ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå®ƒä¼šå½±å“æ•´ä¸ªåº”ç”¨çš„æ°´åˆé”™è¯¯è­¦å‘Šã€‚
2.  ä½¿ç”¨ ThemeProviders ç»„ä»¶åŒ…è£¹ children

æ­¤æ—¶é¡µé¢å¹¶ä¸æœ‰ä»€ä¹ˆç‰¹æ®Šæ•ˆæœï¼Œå› ä¸ºè¿™æ­¥ç›¸å½“äºåœ¨é¡¶å±‚ä½¿ç”¨äº† React Contextï¼Œå‚¨å­˜äº†ä¸€ä¸ªç”¨äºè¡¨ç¤ºå½“å‰ä¸»é¢˜çš„å€¼ï¼Œé»˜è®¤æ˜¯ `"light"`ã€‚

æ­¤æ—¶å› ä¸ºæˆ‘ä»¬è®¾ç½®äº† `attribute="class"`ï¼Œå½“åˆ‡æ¢ä¸»é¢˜çš„æ—¶å€™ï¼Œå®ƒä¼šå¯¹åº”ç”Ÿæˆ `class="dark"`è¿™ç§å±æ€§ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36e097ed44e84d79a5507beaf299116d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1202\&h=126\&s=34834\&e=png\&b=2e2e2e)

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº† `style="color-scheme: dark;"`å±æ€§ï¼Œè¯¦ç»†ä»‹ç»å‚è€ƒ [MDN color-scheme](https://developer.mozilla.org/en-US/docs/Web/CSS/color-scheme)ã€‚ç®€å•æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„é¢œè‰²æ–¹æ¡ˆå¯¹ç”¨æˆ·ç•Œé¢è¿›è¡Œè°ƒæ•´ï¼ŒåŒ…æ‹¬è¡¨å•æ§ä»¶ã€æ»šåŠ¨æ¡å’Œ CSS ç³»ç»Ÿé¢œè‰²çš„ä½¿ç”¨å€¼ã€‚

å› ä¸ºæˆ‘ä»¬æ”¹ç”¨äº† JS æ¥æ‰‹åŠ¨æ§åˆ¶ä¸»é¢˜å€¼ï¼Œæ‰€ä»¥å†™æ ·å¼æ•ˆæœçš„æ—¶å€™ï¼Œä¹Ÿä¸èƒ½å†ç”¨ @media (prefers-color-scheme: dark) è¿™ç§æ–¹å¼ï¼Œå®ƒä¼šæ ¹æ®ç³»ç»Ÿçš„ä¸»é¢˜å€¼è€Œé Context ä¸­çš„ä¸»é¢˜å€¼è¿›è¡Œä¿®æ”¹ã€‚

å¦‚æœä½ è¦å†™ dark å’Œ light ä¸¤å¥—ä¸»é¢˜ï¼Œå› ä¸º html æ·»åŠ äº† `.dark` ç±»ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å†™ï¼š

```javascript
html,
body {
  color: #000;
  background: #fff;
}

.dark {
  html, body {
    color: #fff;
    background: #000;
  }
}
```

å½“ç„¶å› ä¸ºæˆ‘ä»¬é¡¹ç›®ä½¿ç”¨äº† Tailwind.cssï¼ŒTailwind.css ä¹Ÿæ˜¯æ”¯æŒ [Dark Mode](https://tailwindcss.com/docs/dark-mode#toggling-dark-mode-manually) çš„ã€‚ä¿®æ”¹ `tailwind.config.js`ï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼ˆå¦‚æœä½ æŒ‰ç…§ä¹‹å‰çš„æ–‡ç« å†™é¡¹ç›®ï¼Œæ­¤æ—¶åº”è¯¥å·²ç»æ·»åŠ äº†ï¼‰ï¼š

```javascript
module.exports = {
  darkMode: 'class'
}
```

ä¿®æ”¹ `app/page.js`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```jsx
'use client'

import { useState, useEffect } from 'react'
import { useTheme } from 'next-themes'

const ThemeSwitch = () => {
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme } = useTheme()

  useEffect(() => {
    setMounted(true)
  }, [])

  if (!mounted) {
    return null
  }

  return (
    <>
      <h1 className="text-black dark:text-white">Hello World! {theme}</h1>
      <select value={theme} onChange={e => setTheme(e.target.value)}>
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>
    </>

  )
}

export default ThemeSwitch
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ useTheme å’Œ Taildwind.cssã€‚

1.  ä½¿ç”¨ useTheme éœ€è¦æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä¸”éœ€è¦åˆ¤æ–­ç¯å¢ƒï¼Œå¦åˆ™ä¼šå¯¼è‡´æ°´åˆé”™è¯¯
2.  `"text-black dark:text-white"` å±•ç¤ºäº†å¦‚ä½•ä¸ºä¸€ä¸ªå…ƒç´ å®šä¹‰ä¸åŒä¸»é¢˜ä¸‹çš„æ ·å¼

æ­¤æ—¶æ•ˆæœå¦‚ä¸‹ï¼š

![4.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/618593f99c17417aaaf565d9d7e06ea0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1103\&h=461\&s=1064578\&e=gif\&f=53\&b=2c2c2c)

### 3.2. é¡¹ç›®å¼€å‘

æ–°å»º `components/ThemeSwitch.js`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```jsx
'use client'

import { Fragment, useEffect, useState } from 'react'
import { useTheme } from 'next-themes'
import { Menu, RadioGroup, Transition } from '@headlessui/react'

const Sun = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 20 20"
    fill="currentColor"
    className="h-6 w-6 text-gray-900 dark:text-gray-100"
  >
    <path
      fillRule="evenodd"
      d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
      clipRule="evenodd"
    />
  </svg>
)
const Moon = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 20 20"
    fill="currentColor"
    className="h-6 w-6 text-gray-900 dark:text-gray-100"
  >
    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
  </svg>
)
const Monitor = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 20 20"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
    className="h-6 w-6 text-gray-900 dark:text-gray-100"
  >
    <rect x="3" y="3" width="14" height="10" rx="2" ry="2"></rect>
    <line x1="7" y1="17" x2="13" y2="17"></line>
    <line x1="10" y1="13" x2="10" y2="17"></line>
  </svg>
)

const ThemeSwitch = () => {
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme, resolvedTheme } = useTheme()

  // When mounted on client, now we can show the UI
  useEffect(() => setMounted(true), [])

  if (!mounted) return null

  return (
    <div className="mr-5">
      <Menu as="div" className="relative inline-block text-left">
        <div>
          <Menu.Button>{resolvedTheme === 'dark' ? <Moon /> : <Sun />}</Menu.Button>
        </div>
        <Transition
          as={Fragment}
          enter="transition ease-out duration-100"
          enterFrom="transform opacity-0 scale-95"
          enterTo="transform opacity-100 scale-100"
          leave="transition ease-in duration-75"
          leaveFrom="transform opacity-100 scale-100"
          leaveTo="transform opacity-0 scale-95"
        >
          <Menu.Items className="absolute right-0 mt-2 w-32 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-800">
            <RadioGroup value={theme} onChange={setTheme}>
              <div className="p-1">
                <RadioGroup.Option value="light">
                  <Menu.Item>
                    <button className="group flex w-full items-center rounded-md px-2 py-2 text-sm">
                      <div className="mr-2">
                        <Sun />
                      </div>
                      Light
                    </button>
                  </Menu.Item>
                </RadioGroup.Option>
                <RadioGroup.Option value="dark">
                  <Menu.Item>
                    <button className="group flex w-full items-center rounded-md px-2 py-2 text-sm">
                      <div className="mr-2">
                        <Moon />
                      </div>
                      Dark
                    </button>
                  </Menu.Item>
                </RadioGroup.Option>
                <RadioGroup.Option value="system">
                  <Menu.Item>
                    <button className="group flex w-full items-center rounded-md px-2 py-2 text-sm">
                      <div className="mr-2">
                        <Monitor />
                      </div>
                      System
                    </button>
                  </Menu.Item>
                </RadioGroup.Option>
              </div>
            </RadioGroup>
          </Menu.Items>
        </Transition>
      </Menu>
    </div>
  )
}

export default ThemeSwitch
```

è¿™æ®µä»£ç çœ‹ä¼¼å¾ˆé•¿ï¼Œä½†å®ç°çš„æ•ˆæœå…¶å®å¾ˆç®€å•ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dea2cfbb8a274a338e98461edf232c9a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1306\&h=542\&s=56899\&e=png\&b=fefefe)

ä¸ºäº†æ–¹ä¾¿å¼•å…¥ï¼Œä¿®æ”¹ `jsconfig.json`ï¼š

```javascript
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/data/*": ["data/*"],
      "@/components/*": ["components/*"],
      "contentlayer/generated": ["./.contentlayer/generated"]
    }
  },
  // ...
}
```

æˆ‘ä»¬å°†ç»„ä»¶æ·»åŠ åˆ°æ ¹å¸ƒå±€ `app/layout.js`ä¸­ï¼š

```jsx
import siteMetadata from '@/data/siteMetadata'
import "./globals.css";
import { ThemeProviders } from './theme-providers'
import ThemeSwitch from '@/components/ThemeSwitch';

// ...

export default function RootLayout({ children }) {
  return (
    <html lang={siteMetadata.locale} suppressHydrationWarning>
      <body>
        <ThemeProviders>
          <header className="flex justify-end">
            <ThemeSwitch />
          </header>
          {children}
        </ThemeProviders>
      </body>
    </html>
  );
}
```

è¿™æ ·æ‰€æœ‰é¡µé¢çš„å³ä¸Šè§’éƒ½ä¼šæœ‰è¿™ä¸ªåˆ‡æ¢ä¸»é¢˜çš„æŒ‰é’®ã€‚

ç°åœ¨è¦åšçš„å°±æ˜¯ä¸ºå…ƒç´ è®¾ç½®ä¸åŒä¸»é¢˜çš„æ ·å¼ã€‚æ ¹æ®ä¸ŠèŠ‚çš„æè¿°æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¾ç½®ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨ CSS è¿›è¡Œè®¾ç½®ï¼š

```javascript
.dark {
  // ...
}
```

ä¸€ç§æ˜¯ä½¿ç”¨ Tailwind.cssï¼Œæ·»åŠ  `dark:`å¼€å¤´çš„ç±»åï¼š

```javascript
<h1 className="text-3xl font-bold dark:text-white">{post.title}</h1>
```

æ¯”è¾ƒéº»çƒ¦çš„åœ°æ–¹åœ¨äºæ–‡ç« é¡µé¢ï¼Œå› ä¸ºæ–‡ç« çš„å†…å®¹æ¸²æŸ“æ˜¯ç”± MDX ç”Ÿæˆï¼Œä¸èƒ½ç›´æ¥æ·»åŠ ç±»åã€‚

ä½†å…¶å® tailwindcss-typography åŒæ ·æä¾›äº† dark mode æ”¯æŒï¼Œä½ åªè¦åœ¨å¤–å±‚æ·»åŠ ä¸€ä¸ª `dark:prose-invert` ç±»åï¼š

```javascript
<article class="prose dark:prose-invert">{{ markdown }}</article>
```

æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ `app/posts/[id]/page.js`ï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š

```jsx
// ...

const Page = ({ params }) => {
  const post = allPosts.find((post) => post._raw.flattenedPath === params.id)
  if (!post) notFound()
  const MDXContent = useMDXComponent(post.body.code)
  const jsonLd = post.structuredData
  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
        />
      <article className="mx-auto max-w-xl py-8 prose prose-slate dark:prose-invert">
        <div className="mb-8 text-center">
          <time dateTime={post.date} className="mb-1 text-xs text-gray-600 dark:text-white">
            {dayjs(post.date).format('DD/MM/YYYY')}
          </time>
          <h1 className="text-3xl font-bold dark:text-white">{post.title}</h1>
        </div>
        <MDXContent />
      </article>
    </>
  )
}

export default Page
```

æ­¤æ—¶æ–‡ç« é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š

![5.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e1a5769c7d84f10a96cf4daedba8361~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1019\&h=686\&s=300406\&e=gif\&f=55\&b=fefefe)

æˆ‘ä»¬æˆåŠŸå®ç°äº†æ·±è‰²æ¨¡å¼ï¼

## é¡¹ç›®æºç 

> 1.  åŠŸèƒ½å®ç°ï¼šåšå®¢æ”¯æŒæ·±è‰²æ¨¡å¼
> 2.  æºç åœ°å€ï¼š<https://github.com/mqyqingfeng/next-app-demo/tree/next-blog-3>
> 3.  ä¸‹è½½ä»£ç ï¼š`git clone -b next-blog-3 git@github.com:mqyqingfeng/next-app-demo.git`

## å‚è€ƒé“¾æ¥

1.  <https://support.apple.com/zh-cn/guide/mac-help/mchl52e1c2d2/mac>
2.  <https://juejin.cn/post/7298997940019085366>
3.  <https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme>
4.  <https://web.dev/articles/prefers-color-scheme?hl=zh-cn#reacting_on_dark_mode_changes>
5.  <https://web.dev/articles/color-scheme?hl=zh-cn>
6.  <https://www.uisdc.com/dark-mode-history>
7.  <https://juejin.cn/post/7062986403205873701>
