
          
## ä¸€ å‰è¨€

æœ¬ç« èŠ‚å°†å›´ç»•è‡ªå®šä¹‰ hooks å±•å¼€ï¼Œæœ¬ç« èŠ‚å«çš„çŸ¥è¯†ç‚¹å¦‚ä¸‹ï¼š

* è‡ªå®šä¹‰ hooks çš„è®¾è®¡å’Œç¼–å†™ã€‚
* å‡ ä¸ªè‡ªå®šä¹‰ hooks å®æˆ˜ã€‚

## äºŒ å…¨é¢ç†è§£è‡ªå®šä¹‰ hooks 

åœ¨ hooks åŸç†ç« èŠ‚ï¼Œè¯¦ç»†ä»‹ç»äº† `React Hooks` åŸç†ï¼Œåœ¨å…¶ä»–çš„ç« èŠ‚ï¼Œä¹Ÿé™†ç»­è®²è§£äº†æ‰€æœ‰å¸¸ç”¨çš„ hooks ç”¨æ³•ã€‚æ¥ä¸‹æ¥é’ˆå¯¹ hooks è¿›è¡ŒåŠŸèƒ½æ€§æ‹“å±•ï¼Œæ¥ç ”ç©¶ä¸€ä¸‹åœ¨ React ä¸­ä¸€ç§é€»è¾‘å¤ç”¨ï¼Œç»„ä»¶å¼ºåŒ–æ–¹å¼â€”â€”è‡ªå®šä¹‰ hooks ã€‚

### 1 æ¦‚å¿µ

è‡ªå®šä¹‰ hooks æ˜¯åœ¨ React Hooks åŸºç¡€ä¸Šçš„ä¸€ä¸ªæ‹“å±•ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ¶å®šæ»¡è¶³ä¸šåŠ¡éœ€è¦çš„ç»„åˆ hooks ï¼Œæ›´æ³¨é‡çš„æ˜¯é€»è¾‘å•å…ƒã€‚é€šè¿‡ä¸šåŠ¡åœºæ™¯ä¸åŒï¼Œåˆ°åº•éœ€è¦React Hooks åšä»€ä¹ˆï¼Œæ€ä¹ˆæ ·æŠŠä¸€æ®µé€»è¾‘å°è£…èµ·æ¥ï¼Œåšåˆ°å¤ç”¨ï¼Œè¿™æ˜¯è‡ªå®šä¹‰ hooks äº§ç”Ÿçš„åˆè¡·ã€‚

è‡ªå®šä¹‰ hooks ä¹Ÿå¯ä»¥è¯´æ˜¯ React Hooks èšåˆäº§ç‰©ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª React Hooks ç»„æˆï¼Œç”¨äºè§£å†³ä¸€äº›å¤æ‚é€»è¾‘ã€‚

ä¸€ä¸ªä¼ ç»Ÿè‡ªå®šä¹‰ hooks é•¿å¦‚ä¸‹çš„æ ·å­ï¼š

ç¼–å†™ï¼š
````js
function useXXX(å‚æ•°A,å‚æ•°B){
    /*  
     ...è‡ªå®šä¹‰ hooks é€»è¾‘
     å†…éƒ¨åº”ç”¨äº†å…¶ä»– React Hooks â€”â€” useState | useEffect | useRef ...
    */
    return [xxx,...]
}

````
ä½¿ç”¨ï¼š

````js
const [ xxx , ... ] = useXXX(å‚æ•°A,å‚æ•°B...)
````

å®é™…ä¸Šè‡ªå®šä¹‰ hooks çš„ç¼–å†™å¾ˆç®€å•ï¼Œå¼€å‘è€…åªéœ€è¦å…³å¿ƒï¼Œä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼ˆä¹Ÿå¯ä»¥æ²¡æœ‰å‚æ•°ï¼‰ï¼Œå’Œè¿”å›ä»€ä¹ˆå†…å®¹å°±å¯ä»¥äº†ï¼Œå½“ç„¶æœ‰ä¸€äº›ç›‘å¬å’Œæ‰§è¡Œå‰¯ä½œç”¨çš„è‡ªå®šä¹‰ hooks ï¼Œæ ¹æœ¬æ— éœ€è¿”å›å€¼ã€‚

è‡ªå®šä¹‰ hooks å‚æ•°å¯èƒ½æ˜¯ä»¥ä¸‹å†…å®¹ï¼š

*  hooks åˆå§‹åŒ–å€¼ã€‚
* ä¸€äº›å‰¯ä½œç”¨æˆ–äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚
* å¯ä»¥æ˜¯ useRef è·å–çš„ DOM å…ƒç´ æˆ–è€…ç»„ä»¶å®ä¾‹ã€‚
* ä¸éœ€è¦å‚æ•°

è‡ªå®šä¹‰ hooks è¿”å›å€¼å¯èƒ½æ˜¯ä»¥ä¸‹å†…å®¹ï¼š

* è´Ÿè´£æ¸²æŸ“è§†å›¾è·å–çš„çŠ¶æ€ã€‚
* æ›´æ–°å‡½æ•°ç»„ä»¶æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯ useState æˆ–è€… useReducerã€‚
* ä¸€äº›ä¼ é€’ç»™å­å­™ç»„ä»¶çš„çŠ¶æ€ã€‚
* æ²¡æœ‰è¿”å›å€¼ã€‚

### 2 ç‰¹æ€§

ä¸Šè¿°è®²åˆ°äº†è‡ªå®šä¹‰ hooks åŸºæœ¬æ¦‚å¿µï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹å®ƒçš„ç‰¹æ€§ã€‚

#### â‘  é©±åŠ¨æ¡ä»¶

é¦–å…ˆè¦æ˜ç™½ä¸€ç‚¹ï¼Œå¼€å‘è€…å†™çš„è‡ªå®šä¹‰ hooks æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”å‡½æ•°åœ¨å‡½æ•°ç»„ä»¶ä¸­è¢«æ‰§è¡Œã€‚é‚£ä¹ˆ**è‡ªå®šä¹‰ hooks é©±åŠ¨æœ¬è´¨ä¸Šå°±æ˜¯å‡½æ•°ç»„ä»¶çš„æ‰§è¡Œ**ã€‚

è‡ªå®šä¹‰ hooks é©±åŠ¨æ¡ä»¶ï¼š

* props æ”¹å˜å¸¦æ¥çš„å‡½æ•°ç»„ä»¶æ‰§è¡Œã€‚
* useState | useReducer æ”¹å˜ state å¼•èµ·å‡½æ•°ç»„ä»¶çš„æ›´æ–°ã€‚



![1.jpg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9fca8bd0234c43fda413c71b2023d8a2~tplv-k3u1fbpfcp-watermark.image)

#### â‘¡ é¡ºåºåŸåˆ™

è‡ªå®šä¹‰ hooks å†…éƒ¨è‡³å°‘æœ‰ä¸€ä¸ª React Hooks ï¼Œé‚£ä¹ˆè‡ªå®šä¹‰ hooks ä¹Ÿè¦éµå¾ª hooks çš„è§„åˆ™ï¼Œ**ä¸èƒ½æ”¾åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œè€Œä¸”è¦ä¿æŒæ‰§è¡Œé¡ºåºçš„ä¸€è‡´æ€§ã€‚** è‡³äºä¸ºä»€ä¹ˆï¼Ÿ åœ¨ hooks åŸç†ç« èŠ‚å·²ç»è®²è¿‡äº†ã€‚

#### â‘¢ æ¡ä»¶é™å®š

åœ¨è‡ªå®šä¹‰ hooks ä¸­ï¼Œæ¡ä»¶é™å®š**ç‰¹åˆ«é‡è¦**ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºè€ƒè™‘ hooks çš„é™å®šæ¡ä»¶ï¼Œæ˜¯ä¸€ä¸ªå‡ºè‰²çš„è‡ªå®šä¹‰ hooks é‡è¦å› ç´ ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

ä¸€äº›åŒå­¦å®¹æ˜“æ»¥ç”¨è‡ªå®šä¹‰ hooks å¯¼è‡´ä¸€äº›é—®é¢˜çš„å‘ç”Ÿ ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªè‡ªå®šä¹‰è¿™é‡Œå†™ï¼š

````js
function useXXX(){
    const value = React.useContext(defaultContext)
    /* .....ç”¨ä¸Šä¸‹æ–‡ä¸­ value ä¸€æ®µåˆå§‹åŒ–é€»è¾‘  */
    const newValue = initValueFunction(value) /* åˆå§‹åŒ– value å¾—åˆ°æ–°çš„ newValue  */
    /* ...... */
    return newValue
}
````
æ¯”å¦‚ä¸Šè¿°ä¸€ä¸ªéå¸¸ç®€å•è‡ªå®šä¹‰ hooks ï¼Œä» `context` å–å‡ºçŠ¶æ€ value ï¼Œé€šè¿‡ `initValueFunction` åŠ å·¥ value ï¼Œå¾—åˆ°å¹¶è¿”å›æœ€æ–°çš„ newValue ã€‚å¦‚æœç›´æ¥æŒ‰ç…§ä¸Šè¿°è¿™ä¹ˆå†™ï¼Œä¼šå¯¼è‡´ä»€ä¹ˆå‘ç”Ÿå‘¢ï¼Ÿ

é¦–å…ˆæ¯ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œå°±ä¼šæ‰§è¡Œæ­¤è‡ªå®šä¹‰ hooks ï¼Œé‚£ä¹ˆå°±ä¼šé‡å¤æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼Œé‡å¤æ‰§è¡Œ`initValueFunction` ï¼Œæ¯ä¸€æ¬¡éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªæœ€æ–°çš„ newValue ã€‚ å¦‚æœ newValue ä½œä¸º `useMemo` å’Œ `useEffect` çš„ deps ï¼Œæˆ–è€…ä½œä¸ºå­ç»„ä»¶çš„ props ï¼Œé‚£ä¹ˆå­ç»„ä»¶çš„æµ…æ¯”è¾ƒ props å°†å¤±å»ä½œç”¨ï¼Œé‚£ä¹ˆä¼šå¸¦æ¥ä¸€ä¸²éº»çƒ¦ã€‚

é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ useRef å¯¹ newValue ç¼“å­˜ï¼Œç„¶åæ¯æ¬¡æ‰§è¡Œè‡ªå®šä¹‰ hooks åˆ¤æ–­æœ‰æ— ç¼“å­˜å€¼ã€‚å¦‚ä¸‹ï¼š

````js
function useXXX(){
    const newValue =  React.useRef(null)  /* åˆ›å»ºä¸€ä¸ª value ä¿å­˜çŠ¶æ€ã€‚  */
    const value = React.useContext(defaultContext)
    if(!newValue.current){  /* å¦‚æœ newValue ä¸å­˜åœ¨ */
          newValue.current = initValueFunction(value)
    }
    return newValue.current
}
````

* ç”¨ä¸€ä¸ª useRef ä¿å­˜åˆå§‹åŒ–è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ value å€¼ ã€‚
* åˆ¤æ–­å¦‚æœ value ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆé€šè¿‡ initValueFunction åˆ›å»ºï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è¿”å› newValue.current ã€‚

å¦‚ä¸ŠåŠ äº†æ¡ä»¶åˆ¤æ–­ä¹‹åï¼Œä¼šè®©è‡ªå®šä¹‰ hooks å†…éƒ¨æŒ‰ç…§æœŸæœ›çš„æ–¹å‘å‘å±•ã€‚æ¡ä»¶é™å®šæ˜¯ç¼–å†™å‡ºè‰²çš„ hooks é‡è¦çš„å› ç´ ã€‚

#### â‘£ è€ƒè™‘å¯å˜æ€§

åœ¨ç¼–å†™è‡ªå®šä¹‰ hooks çš„æ—¶å€™ï¼Œå¯å˜æ€§ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ hooks ç‰¹æ€§ã€‚ä»€ä¹ˆå«åšå¯å˜æ€§ï¼Œ**å°±æ˜¯è€ƒè™‘ä¸€äº›çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯å¦æœ‰ä¾èµ–äºå½“å‰å€¼å˜åŒ–çš„æ‰§è¡Œé€»è¾‘æˆ–æ‰§è¡Œå‰¯ä½œç”¨ã€‚**

æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ğŸŒ°ä¸­ï¼Œå¦‚æœ defaultContext ä¸­çš„ value æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå¦‚æœè¿˜åƒä¸Šè¿°ç”¨ useRef è¿™ä¹ˆå†™ï¼Œå°±ä¼šé€ æˆ context å˜åŒ–ï¼Œå¾—ä¸åˆ°æœ€æ–°çš„ value å€¼çš„æƒ…å†µå‘ç”Ÿã€‚

æ‰€ä»¥ä¸ºäº†è§£å†³ä¸Šè¿°å¯å˜æ€§çš„é—®é¢˜ï¼š

* å¯¹äºä¾èµ–äºå¯å˜æ€§çŠ¶æ€çš„æ‰§è¡Œé€»è¾‘ï¼Œå¯ä»¥ç”¨ `useMemo` æ¥å¤„ç†ã€‚
* å¯¹äºå¯å˜æ€§çŠ¶æ€çš„æ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¯ä»¥ç”¨ `useEffect` æ¥å¤„ç†ã€‚ 
* å¯¹äºä¾èµ–å¯å˜æ€§çŠ¶æ€çš„å‡½æ•°æˆ–è€…å±æ€§ï¼Œå¯ä»¥ç”¨`useCallback`æ¥å¤„ç†ã€‚
äºæ˜¯éœ€è¦æŠŠä¸Šè¿°è‡ªå®šä¹‰ hooks æ”¹ç‰ˆã€‚

````js
function useXXX(){
    const value = React.useContext(defaultContext)
    const newValue = React.useMemo(()=> initValueFunction(value) ,[  value  ] )  
    return  newValue
}
````

* ç”¨ React.useMemo æ¥å¯¹ initValueFunction åˆå§‹åŒ–é€»è¾‘åšç¼“å­˜ï¼Œå½“ä¸Šä¸‹æ–‡ value æ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„ newValue ã€‚

è¿™åªæ˜¯ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œè¦æ¯”è¿™ç§æƒ…å†µå¤æ‚ã€‚å¼€å‘è€…åº”è¯¥æ³¨æ„åœ¨è‡ªå®šä¹‰ hooks ä¸­ï¼Œå“ªäº›çŠ¶æ€æ˜¯å¯å˜çš„ï¼ŒçŠ¶æ€æ”¹å˜ï¼Œåˆä¼šç´§è·Ÿç€å“ªäº›å½±å“ã€‚

#### â‘¤ é—­åŒ…æ•ˆåº”

é—­åŒ…ä¹Ÿæ˜¯è‡ªå®šä¹‰ hooks åº”è¯¥æ³¨æ„çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å’Œ â‘£ æœ¬è´¨ä¸€æ ·ã€‚é¦–å…ˆå‡½æ•°ç»„ä»¶æ›´æ–°å°±æ˜¯å‡½æ•°æœ¬èº«æ‰§è¡Œï¼Œä¸€æ¬¡æ›´æ–°æ‰€æœ‰å«æœ‰çŠ¶æ€çš„ hooks ï¼ˆ `useState` å’Œ `useReducer` ï¼‰äº§ç”Ÿçš„çŠ¶æ€ state æ˜¯é‡æ–°å£°æ˜çš„ã€‚ä½†æ˜¯å¦‚æœåƒ `useEffect` ï¼Œ `useMemo` ï¼Œ`useCallback` ç­‰ï¼Œå®ƒä»¬å†…éƒ¨å¦‚æœå¼•ç”¨äº† state æˆ– props çš„å€¼ï¼Œè€Œä¸”è¿™äº›çŠ¶æ€æœ€åä¿å­˜åœ¨äº†å‡½æ•°ç»„ä»¶å¯¹åº”çš„ fiber ä¸Šï¼Œé‚£ä¹ˆæ­¤æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œå®Œæ¯•åï¼Œè¿™äº›çŠ¶æ€å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶é‡Šæ”¾ã€‚è¿™æ ·é€ æˆçš„å½±å“æ˜¯ï¼Œä¸Šè¿° hooks å¦‚æœæ²¡æœ‰æŠŠå†…éƒ¨ä½¿ç”¨çš„ state æˆ– props ä½œä¸ºä¾èµ–é¡¹ï¼Œé‚£ä¹ˆå†…éƒ¨å°±ä¸€ç›´æ— æ³•ä½¿ç”¨æœ€æ–°çš„ props æˆ–è€… state ã€‚

æ¯”å¦‚æˆ‘ä¸¾ä¸ªç®€å•çš„ä¾‹å­ã€‚

````js
function useTest(){
    const [ number ] = React.useState(0)
    const value = React.useMemo(()=>{
         // å†…éƒ¨å¼•ç”¨äº† number è¿›è¡Œè®¡ç®—
    },[])
}
````
* å¦‚ä¸Š useMemo å†…éƒ¨ä½¿ç”¨äº† state ä¸­çš„ number è¿›è¡Œè®¡ç®—ï¼Œå½“ number æ”¹å˜ä½†æ˜¯æ— æ³•å¾—åˆ°æœ€æ–°çš„ value ã€‚è¿™å°±æ˜¯ä¸Šé¢æˆ‘è¯´åˆ°çš„é—­åŒ…é—®é¢˜ã€‚è§£å†³æ–¹æ³•å°±æ˜¯ useMemo çš„ deps ä¸­åŠ å…¥ numberã€‚

ä½†æ˜¯æœ‰çš„æ—¶å€™è¿™ç§ä¾èµ–å…³ç³»å¾€å¾€æ˜¯æ›´å¤æ‚çš„ã€‚æˆ‘å°†å¦‚ä¸Š demo ä¿®æ”¹ã€‚

````js
function useTest(){
    const [ number ] = React.useState(0)
    const value = React.useMemo(()=>{
         // å†…éƒ¨å¼•ç”¨äº† number è¿›è¡Œè®¡ç®—
    },[ number ])
    const callback = React.useCallback(function(){
         // å†…éƒ¨å¼•ç”¨äº† useEffect
    },[ value ])
    
}
````
* å¦‚ä¸Šï¼Œåœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šï¼ŒåˆåŠ äº† useCallback è€Œä¸”å†…éƒ¨å¼•ç”¨äº† useMemo ç”Ÿæˆçš„ valueã€‚ è¿™ä¸ªæ—¶å€™å¦‚æœ useCallback æ‰§è¡Œï¼Œå†…éƒ¨æƒ³è¦è·å–æ–°çš„çŠ¶æ€å€¼ valueï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠ value æ”¾åœ¨ useCallback çš„ deps ä¸­ã€‚

**ğŸ¤”æ€è€ƒï¼šå¦‚ä½•åˆ†æ¸…æ¥šä¾èµ–å…³ç³»å‘¢ï¼Ÿ**

* **ç¬¬ä¸€æ­¥**ï¼šæ‰¾åˆ° hooks å†…éƒ¨å¯èƒ½å‘ç”Ÿå˜åŒ–çš„çŠ¶æ€ ï¼Œ è¿™ä¸ªçŠ¶æ€å¯ä»¥æ˜¯ state æˆ–è€… propsã€‚
* **ç¬¬äºŒæ­¥**ï¼šåˆ†æ useMemo æˆ–è€… useCallback å†…éƒ¨æ˜¯å¦ä½¿ç”¨ä¸Šè¿°çŠ¶æ€ï¼Œæˆ–è€…æ˜¯å¦**å…³è”ä½¿ç”¨** useMemo æˆ–è€… useCallback æ´¾ç”Ÿå‡ºæ¥çš„çŠ¶æ€ï¼ˆ æ¯”å¦‚ä¸Šè¿°çš„ value ï¼Œå°±æ˜¯ useMemo æ´¾ç”Ÿçš„çŠ¶æ€ ï¼‰ ï¼Œå¦‚æœæœ‰ä½¿ç”¨ï¼Œé‚£ä¹ˆåŠ å…¥åˆ° deps ã€‚
* **ç¬¬ä¸‰æ­¥**ï¼šåˆ†æ useEffect ï¼ŒuseLayoutEffect ï¼ŒuseImperativeHandle å†…éƒ¨æ˜¯å¦ä½¿ç”¨ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤äº§ç”Ÿçš„å€¼ï¼Œè€Œä¸”è¿˜è¦è¿™äº›å€¼åšä¸€äº›å‰¯ä½œç”¨ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆåŠ å…¥åˆ° deps ã€‚

## ä¸‰ è‡ªå®šä¹‰ hooks è®¾è®¡

ä¸Šè¿°ä»‹ç»äº†è‡ªå®šä¹‰ hooks çš„æ¦‚å¿µå’Œç‰¹æ€§ï¼Œæ¥ä¸‹æ¥é‡ç‚¹åˆ†æä¸€ä¸‹ï¼Œå¦‚ä½•å»è®¾è®¡ä¸€ä¸ªè‡ªå®šä¹‰ hooks ã€‚

é¦–å…ˆæ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè‡ªå®šä¹‰ hooks è§£å†³é€»è¾‘å¤ç”¨çš„é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨æ­£å¸¸çš„ä¸šåŠ¡å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¦æ˜ç™½å“ªäº›é€»è¾‘æ˜¯é‡å¤æ€§å¼ºçš„é€»è¾‘ï¼Œè¿™æ®µé€»è¾‘ä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆã€‚

ä¸‹é¢æˆ‘æŠŠè‡ªå®šä¹‰ hooks èƒ½å®ç°çš„åŠŸèƒ½åŒ–æ•´ä¸ºé›¶ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½æ˜¯ä¸‹é¢ä¸€ç§æˆ–è€…å‡ ç§çš„ç»“åˆã€‚

### 1 æ¥æ”¶çŠ¶æ€

è‡ªå®šä¹‰ hooks ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°æ¥ç›´æ¥æ¥æ”¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ useContext ï¼Œæ¥éšå¼è·å–ä¸Šä¸‹æ–‡ä¸­çš„çŠ¶æ€ã€‚æ¯”å¦‚ React Router ä¸­æœ€ç®€å•çš„ä¸€ä¸ªè‡ªå®šä¹‰ hooks â€”â€” useHistory ï¼Œç”¨äºè·å– history å¯¹è±¡ã€‚

````js
export default function useHistory() {
    return useContext(RouterContext).history
}
````

æ³¨æ„âš ï¸ï¼š**å¦‚æœä½¿ç”¨äº†å†…éƒ¨å«æœ‰ useContext çš„è‡ªå®šä¹‰ hooks ï¼Œé‚£ä¹ˆå½“ context ä¸Šä¸‹æ–‡æ”¹å˜ï¼Œä¼šè®©ä½¿ç”¨è‡ªå®šä¹‰ hooks çš„ç»„ä»¶è‡ªåŠ¨æ¸²æŸ“ã€‚**

### 2 å­˜å‚¨ï½œç®¡ç†çŠ¶æ€

**å‚¨å­˜çŠ¶æ€**

è‡ªå®šä¹‰ hooks ä¹Ÿå¯ä»¥ç”¨æ¥å‚¨å­˜å’Œç®¡ç†çŠ¶æ€ã€‚æœ¬è´¨ä¸Šåº”ç”¨ useRef ä¿å­˜åŸå§‹å¯¹è±¡çš„ç‰¹æ€§ã€‚

æ¯”å¦‚ `rc-form` ä¸­çš„ `useForm` é‡Œé¢å°±æ˜¯ç”¨ useRef æ¥ä¿å­˜è¡¨å•çŠ¶æ€ç®¡ç† Store çš„ã€‚ç®€åŒ–æµç¨‹å¦‚ä¸‹

````js
function useForm(){
    const formCurrent = React.useRef(null)
    if(!formCurrent.current){
        formCurrent.current = new FormStore()
    }
    return formCurrent.current
}
````

**è®°å½•çŠ¶æ€**

å½“ç„¶ useRef å’Œ useEffect å¯ä»¥é…åˆè®°å½•å‡½æ•°ç»„ä»¶çš„å†…éƒ¨çš„çŠ¶æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰ hooks ç”¨äºè®°å½•å‡½æ•°ç»„ä»¶æ‰§è¡Œæ¬¡æ•°ï¼Œå’Œæ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“ã€‚

````js
function useRenderCount(){
    const isFirstRender = React.useRef(true) /* è®°å½•æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ */
    const renderCount = React.useRef(1)      /* è®°å½•æ¸²æŸ“æ¬¡æ•° */
    useEffect(()=>{
        isFirstRender.current = false        /* ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæˆï¼Œæ”¹å˜çŠ¶æ€ */
    },[])
    useEffect(()=>{
        if(!isFirstRender.current) renderCount.current++ /* å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œé‚£ä¹ˆæ·»åŠ æ¸²æŸ“æ¬¡æ•°  */
    })  
    return [ renderCount.current , isFirstRender.current ]
} 
````
* å¦‚ä¸Šç”¨ isFirstRender  è®°å½•æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ ï¼Œç”¨ renderCount è®°å½•æ¸²æŸ“æ¬¡æ•°ï¼Œç¬¬ä¸€ä¸ª useEffect ä¾èµ–é¡¹ä¸ºç©ºï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œç¬¬äºŒä¸ª useEffect æ²¡æœ‰ä¾èµ–é¡¹ï¼Œæ¯ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œï¼Œéƒ½ä¼šæ‰§è¡Œï¼Œç»Ÿè®¡æ¸²æŸ“æ¬¡æ•°ã€‚

ä¸Šè¿°åªæ˜¯ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œå½“ç„¶åœ¨å…·ä½“å¼€å‘ä¸­ï¼Œå¯ä»¥ç”¨è‡ªå®šä¹‰ hooks å»è®°å½•ä¸€äº›å…¶ä»–çš„ä¸œè¥¿ã€‚æ¯”å¦‚å…ƒç´ çš„ä¿¡æ¯ï¼Œå› ä¸ºå¯ä»¥åœ¨ useEffect ä¸­è·å–åˆ°æœ€æ–°çš„ DOM å…ƒç´ ä¿¡æ¯çš„ã€‚ 

### 3 æ›´æ–°çŠ¶æ€

**æ”¹å˜çŠ¶æ€**

è‡ªå®šä¹‰ hooks å†…éƒ¨å¯ä»¥ä¿å­˜çŠ¶æ€ï¼Œå¯ä»¥æŠŠæ›´æ–°çŠ¶æ€çš„æ–¹æ³•æš´éœ²å‡ºå»ï¼Œæ¥æ”¹å˜ hooks å†…éƒ¨çŠ¶æ€ã€‚è€Œæ›´æ–°çŠ¶æ€çš„æ–¹æ³•å¯ä»¥æ˜¯ç»„åˆå¤šæ€çš„ã€‚

æ¯”å¦‚å®ç°ä¸€ä¸ªé˜²æŠ–èŠ‚æµçš„è‡ªå®šä¹‰ hooks ï¼š

````js
export function debounce(fn, time) {
    let timer = null;
    return function(...arg) {
      if (timer) clearTimeout(timer);
      timer = setTimeout(() => {
        fn.apply(this, arg);
      }, time);
    };
}

function useDebounceState(defauleValue,time){
    const [ value , changeValue ] = useState(defauleValue)
    /* å¯¹ changeValue åšé˜²æŠ–å¤„ç†   */
    const newChange = React.useMemo(()=> debounce(changeValue,time) ,[ time ])
    return [ value , newChange ]
}
````
ä½¿ç”¨ï¼š

````js
export default function Index(){
    const [ value , setValue ] = useDebounceState('',300)
    console.log(value)
    return <div style={{ marginTop:'50px' }} >
        ã€ŠReact è¿›é˜¶å®è·µæŒ‡å—ã€‹
        <input placeholder="" onChange={(e)=>setValue(e.target.value)}  />
    </div>
}
````

æ•ˆæœï¼š

![3.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5aa90ff8fe8f401e8ba669af510c35d3~tplv-k3u1fbpfcp-watermark.image)

**ç»„åˆstate**

è‡ªå®šä¹‰ hooks å¯ä»¥ç»´æŠ¤å¤šä¸ª state ï¼Œç„¶åå¯ä»¥ç»„åˆæ›´æ–°å‡½æ•°ã€‚æˆ‘è¿™ä¹ˆè¯´å¯èƒ½å¾ˆå¤šåŒå­¦ä¸ç†è§£ï¼Œä¸‹é¢æˆ‘æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æ§åˆ¶æ•°æ®åŠ è½½å’Œloadingæ•ˆæœï¼Œ

````js
function useControlData(){
    const [ isLoading , setLoading ] = React.useState(false)
    const [ data,  setData ] = React.useState([])
    const getData = (data)=> { /* è·å–åˆ°æ•°æ®ï¼Œæ¸…ç©º loading æ•ˆæœ  */
        setLoading(false)
        setData(data)
    }  
    // ... å…¶ä»–é€»è¾‘
    const resetData = () =>{  /* è¯·æ±‚æ•°æ®ä¹‹å‰ï¼Œæ·»åŠ  loading æ•ˆæœ */
        setLoading(true)
        setData([])
    }
    return [ getData , resetData , ...  ] 
}
````

**åˆç†state**

useState å’Œ useRef éƒ½å¯ä»¥ä¿å­˜çŠ¶æ€ï¼š

* useRef åªè¦ç»„ä»¶ä¸é”€æ¯ï¼Œä¸€ç›´å­˜åœ¨ï¼Œè€Œä¸”å¯ä»¥éšæ—¶è®¿é—®æœ€æ–°çŠ¶æ€å€¼ã€‚
* useState å¯ä»¥è®©ç»„ä»¶æ›´æ–°ï¼Œä½†æ˜¯ state éœ€è¦åœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œçš„æ—¶å€™æ‰æ›´æ–°ï¼Œè€Œä¸”å¦‚æœæƒ³è®© useEffect æˆ–è€… useMemo è®¿é—®æœ€æ–°çš„ state å€¼ï¼Œéœ€è¦å°† state æ·»åŠ åˆ° deps ä¾èµ–é¡¹ä¸­ã€‚

è‡ªå®šä¹‰ hooks å¯ä»¥é€šè¿‡ useState + useRef çš„ç‰¹æ€§ï¼Œå–å…¶ç²¾åï¼Œæ›´åˆç†çš„ç®¡ç† stateã€‚æ¯”å¦‚å¦‚ä¸‹å®ç°ä¸€ä¸ª**åŒæ­¥çš„state**

````js
function useSyncState(defaultValue){
   const value = React.useRef(defaultValue)        /* useRef ç”¨äºä¿å­˜çŠ¶æ€ */
   const [ ,forceUpdate ] = React.useState(null)   /* useState ç”¨äºæ›´æ–°ç»„ä»¶ */
   const dispatch = (fn) => {                      /* æ¨¡æ‹Ÿä¸€ä¸ªæ›´æ–°å‡½æ•° */
       let newValue
       if( typeof fn === 'function' ){
            newValue = fn(value.current)           /* å½“å‚æ•°ä¸ºå‡½æ•°çš„æƒ…å†µ */
       }else{
           newValue = fn                           /* å½“å‚æ•°ä¸ºå…¶ä»–çš„æƒ…å†µ */
       }
       value.current = newValue
       forceUpdate({})                             /* å¼ºåˆ¶æ›´æ–° */
   } 
   return [  value , dispatch  ]                   /* è¿”å›å’Œ useState ä¸€æ ·çš„æ ¼å¼ */
}
````

* useRef ç”¨äºä¿å­˜çŠ¶æ€ ï¼ŒuseState ç”¨äºæ›´æ–°ç»„ä»¶ã€‚ 
* åšä¸€ä¸ª `dispatch` å¤„ç†å‚æ•°ä¸ºå‡½æ•°çš„æƒ…å†µã€‚åœ¨ dispatch å†…éƒ¨ç”¨ forceUpdate è§¦å‘çœŸæ­£çš„æ›´æ–°ã€‚
* è¿”å›çš„ç»“æ„å’Œ useState ç»“æ„ç›¸åŒã€‚ä¸è¿‡æ³¨æ„çš„æ˜¯ä½¿ç”¨çš„æ—¶å€™è¦ç”¨ value.current ã€‚

ä½¿ç”¨ï¼š

````js
export default function Index(){
    const [ data , setData  ] = useSyncState(0)
    return <div style={{ marginTop:'50px' }} >
        ã€ŠReact è¿›é˜¶å®è·µæŒ‡å—ã€‹ ç‚¹èµ ğŸ‘ { data.current }
       <button onClick={ ()=> {
           setData(num => num + 1)
           console.log(data.current) //æ‰“å°åˆ°æœ€æ–°çš„å€¼
       } } >ç‚¹å‡»</button>
    </div>
}
````


### 4 æ“çºµ DOM / ç»„ä»¶å®ä¾‹

è‡ªå®šä¹‰ hooks ä¹Ÿå¯ä»¥è®¾è®¡æˆå¯¹åŸç”Ÿ DOM çš„æ“çºµæ§åˆ¶ã€‚ç©¶å…¶åŸç†ç”¨ useRef è·å–å…ƒç´ ï¼Œ åœ¨ useEffect ä¸­åšå…ƒç´ çš„ç›‘å¬ã€‚

æ¯”å¦‚å¦‚ä¸‹åœºæ™¯ï¼Œç”¨ä¸€ä¸ªè‡ªå®šä¹‰ hooks åšä¸€äº›åŸºäº DOM çš„æ“ä½œ ã€‚

````js
/* TODO: æ“çºµåŸç”Ÿdom  */
function useGetDOM(){
    const dom = React.useRef()
    React.useEffect(()=>{
       /* åšä¸€äº›åŸºäº dom çš„æ“ä½œ */
       console.log(dom.current)
    },[])
    return dom
}
````
* è‡ªå®šä¹‰ useGetDOM ï¼Œç”¨ useRef è·å– DOM å…ƒç´ ï¼Œåœ¨ useEffect ä¸­åšä¸€äº›åŸºäº DOM çš„æ“ä½œã€‚

ä½¿ç”¨ï¼š

````js
export default function Index(){
    const dom = useGetDOM()
    return <div ref={ dom } >
        ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹
        <button >ç‚¹èµ</button>
    </div>
}
````


### 5 æ‰§è¡Œå‰¯ä½œç”¨

è‡ªå®šä¹‰ hooks ä¹Ÿå¯ä»¥æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚è¯´ç›‘å¬ä¸€äº› props æˆ– state å˜åŒ–è€Œå¸¦æ¥çš„å‰¯ä½œç”¨ã€‚æ¯”å¦‚å¦‚ä¸‹ç›‘å¬ï¼Œå½“ `value` æ”¹å˜çš„æ—¶å€™ï¼Œæ‰§è¡Œ `cb`ã€‚

````js
function useEffectProps(value,cb){
    const isMounted = React.useRef(false)
    React.useEffect(()=>{
         /* é˜²æ­¢ç¬¬ä¸€æ¬¡æ‰§è¡Œ */
        isMounted.current && cb && cb()
    },[ value ])
    React.useEffect(()=>{
          /* ç¬¬ä¸€æ¬¡æŒ‚è½½ */
         isMounted.current = true
    },[])
}
````
* ç”¨ useRef ä¿å­˜æ˜¯å¦ç¬¬ä¸€æ¬¡çš„çŠ¶æ€ã€‚ç„¶ååœ¨ä¸€ä¸ª useEffect æ”¹å˜åŠ è½½å®ŒæˆçŠ¶æ€ã€‚
* åªæœ‰å½“ä¸æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½ä¸” value æ”¹å˜çš„æ—¶å€™ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•° cb ã€‚
* å½“ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰ hooks å°±å¯ä»¥ç›‘å¬ï¼Œprops æˆ–è€… state å˜åŒ–ã€‚æ¥ä¸‹æ¥å°è¯•ä¸€ä¸‹ã€‚

ä½¿ç”¨ç»„ä»¶å’Œçˆ¶ç»„ä»¶ï¼š
````js
function Index(props){
    useEffectProps( props.a ,()=>{/* ç›‘å¬ a å˜åŒ– */
        console.log('props a å˜åŒ–:', props.a  )
    } )
    return <div>å­ç»„ä»¶</div>
}
export default function Home(){
    const [ a , setA ] = React.useState(0)
    const [ b , setB ] = React.useState(0)
    return <div>
        <Index a={a}  b={b} />
        <button onClick={()=> setA(a+1)} >æ”¹å˜ props a  </button>
        <button onClick={()=> setB(b+1)} >æ”¹å˜ props b  </button>
    </div>
}
````
æ•ˆæœï¼š


![2.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abe8ac2134bf40c890a71e0b12688879~tplv-k3u1fbpfcp-watermark.image)


* å½“åŠ¨æ€ç›‘å¬ props.a ï¼Œprops.a å˜åŒ–ï¼Œç›‘å¬å‡½æ•°æ‰§è¡Œã€‚


### 6 æŒç»­ç»´æŠ¤ä¸­ï½

æœ¬ç« èŠ‚ï¼Œç¬¬äºŒåä¸ƒç« èŠ‚ï¼Œç¬¬åå››ç« èŠ‚ä¸ºæŒç»­ç»´æŠ¤ç« èŠ‚ï¼Œä¼šæœ‰æ›´å¤šç²¾å½©çš„è‡ªå®šä¹‰ hooks è®¾è®¡åœºæ™¯ã€‚

## å›› æ€»ç»“

æœ¬ç« èŠ‚å­¦ä¹ çš„å†…å®¹å¦‚ä¸‹ï¼š

* è‡ªå®šä¹‰ hooks çš„æ¦‚å¿µä¸ç‰¹æ€§ã€‚
* è‡ªå®šä¹‰ hooks è®¾è®¡æ–¹å¼ã€‚

ä¸‹ä¸€ç« å°†ä»‹ç»è‡ªå®šä¹‰ hooks å®è·µã€‚
