åœ¨ä¹‹å‰çš„ç« èŠ‚é‡Œï¼Œæˆ‘ä»¬ä¸»è¦å¯¹å®¢æˆ·ç«¯çš„è®¾è®¡çŸ¥è¯†ä¸èƒŒæ™¯åšäº†ä¸€äº›äº†è§£ã€‚

ä»æœ¬ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥åˆ°å®¢æˆ·ç«¯é¡¹ç›®çš„å¼€å‘é˜¶æ®µäº†ã€‚

åœ¨æœ¬ç« èŠ‚æˆ‘ä»¬ä¸»è¦çš„ç›®çš„å°±æ˜¯æ¥åˆå§‹åŒ–æˆ‘ä»¬é¡¹ç›®çš„åŸºç¡€ç»“æ„ï¼Œå®Œæˆæ•´ä¸ª **Monorepo** çš„é¡¹ç›®ç»“æ„åˆ›å»ºã€‚

### åˆ›å»ºä»“åº“

ç¬¬ä¸€æ­¥ï¼Œæˆ‘åœ¨ä»£ç æ‰˜ç®¡å¹³å°ä¸­åˆ›å»ºäº†è¿œç¨‹çš„åŸå§‹ä»“åº“ï¼Œåœ¨è¿™é‡Œé¦–é€‰æ˜¯ **GitHub**ï¼Œå¦‚æœæ²¡æœ‰æ¢¯å­çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ **Gitee**ã€‚æœ‰ç‰¹æ®Šçˆ±å¥½ä¹Ÿå¯ä»¥é€‰ç”¨ **Coding**ã€ **GitLab** ç­‰ä»£ç æ‰˜ç®¡å¹³å°ã€‚

> æœ¬é¡¹ç›®æ˜¯ä½¿ç”¨`GitHub`æ¥è¿›è¡Œä»£ç æ‰˜ç®¡çš„ï¼Œç›®å‰æ‰€æœ‰çš„ä»£ç åœ°å€éƒ½æ˜¯åœ¨ [Ignition-Space](https://github.com/Ignition-Space) å½“ä¸­ã€‚æ„Ÿå…´è¶£å¯ä»¥ç‚¹ä¸€ä¸ª **Star**ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨å¹³å°ä¸Šåˆ›å»ºå¯¹åº”çš„é¡¹ç›®ï¼Œå¡«å†™å¥½ç›¸å…³ä¿¡æ¯åï¼Œé¡¹ç›®ä»“åº“å°±åˆ›å»ºå®Œæˆäº†ï¼Œé¡¹ç›®çš„åå­—æ˜¯ [Ignition-web](https://github.com/Ignition-Space/Ignition-web)ï¼Œç‚¹å‡»å¯ä»¥ç›´æ¥åˆ°è¾¾ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bc9888602b34bd2b052fa0c7e6a3cdb\~tplv-k3u1fbpfcp-zoom-1.image)

æ¥ä¸‹æ¥ï¼Œé€šè¿‡ **Git** å°†ä»“åº“å…‹éš†åˆ°æœ¬åœ°åï¼Œå°±å¯ä»¥è¿›å…¥åˆ°é¡¹ç›®å¼€å‘é˜¶æ®µäº†ã€‚

**Git shell çš„æ–¹å¼**

```shell
# å…‹éš†é¡¹ç›®

git clone https://github.com/Ignition-Space/Ignition-web.git
```

**Source Tree**

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ac531f5869d44dbbdce6586f40904a4\~tplv-k3u1fbpfcp-zoom-1.image)

### åˆå§‹åŒ–é¡¹ç›®

å½“ä»“åº“ä¸æœ¬åœ°å»ºç«‹å¥½è”ç³»ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åˆå§‹åŒ–é¡¹ç›®ç»“æ„äº†ã€‚å‰ç«¯æ‰€æœ‰çš„åŒ…å’Œåº”ç”¨éƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“å½“ä¸­ï¼Œé¡¹ç›®ä½¿ç”¨ [pnpm](https://pnpm.io/) ä½œä¸ºä¸»è¦çš„åŒ…ç®¡ç†å·¥å…·ã€‚æˆ‘ä¹Ÿéå¸¸å»ºè®®ä½¿ç”¨å®ƒæ¥ç®¡ç†æˆ‘ä»¬æ—¥å¸¸å¼€å‘å½“ä¸­çš„ä¾èµ–åŒ…ï¼Œå®ƒçš„ä¼˜ç‚¹ä¸ç¼ºç‚¹å¯ä»¥çœ‹è¿™ç¯‡æ–‡æ¡£[å…³äºç°ä»£åŒ…ç®¡ç†å™¨çš„æ·±åº¦æ€è€ƒâ€”â€”ä¸ºä»€ä¹ˆç°åœ¨æˆ‘æ›´æ¨è pnpm è€Œä¸æ˜¯ npm/yarn?](https://juejin.cn/post/6932046455733485575)

é¦–å…ˆï¼Œé€šè¿‡ `pnpm init` æ¥åˆå§‹åŒ–å‰ç«¯é¡¹ç›®ï¼Œæœ¬è´¨ä¸Šå’Œ `npm init` ä¸€è‡´ã€‚å‘½ä»¤æ‰§è¡Œåä¼šå¦‚ä¸‹å›¾ä¸€æ ·ï¼Œå¡«å†™é¡¹ç›®çš„åˆå§‹åŒ–ä¿¡æ¯ï¼ŒæŠŠè‡ªå·±è¦åšçš„é¡¹ç›®ç›¸å…³åç§°ã€ä½œè€…ã€æè¿°ç­‰å¡«å†™å¥½å³å¯ã€‚

```shell
# åˆå§‹åŒ–
pnpm init
```

å½“çœ‹åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸­å‡ºç° **package.json** æ–‡ä»¶å°±ä»£è¡¨é¡¹ç›®åˆå§‹åŒ–æˆåŠŸäº†ã€‚

### Monorepo

å¯¹äºæ­å»ºå¹³å°æ¥è¯´ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é€šç”¨å‹çš„åŠŸèƒ½ï¼Œè€ƒè™‘åˆ°å¤šé¡¹ç›®å¤ç”¨çš„æƒ…å†µä¸‹é€šå¸¸ä¼šå°†å…¶å•ç‹¬å°è£…ğŸ“¦æˆä¸º **sdk**ï¼Œæ¯”å¦‚è´Ÿè´£æ¸²æŸ“çš„æ¸²æŸ“å™¨ï¼Œç®¡ç†é€šç”¨ç‰©æ–™çš„ç»„ä»¶åº“ï¼Œå®šä¹‰æ¥å£æ¨¡å‹çš„è¯·æ±‚æ¨¡å—ç­‰ç­‰ï¼Œè¿™äº›éƒ½ä¼šå•ç‹¬çš„ä½œä¸º **npm** åŒ…å‘å¸ƒã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿæœ‰ç‰©æ–™ç®¡ç†å¹³å°ã€ç¼–è¾‘å™¨å¹³å°ã€æ–‡æ¡£ç­‰ç­‰åº”ç”¨ä»“åº“ã€‚ä¸ºäº†æ›´å¥½çš„ç»´æŠ¤å®ƒä»¬ï¼Œå¸¸è§„æ¡ä»¶ä¸‹æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼Œä¸€ç§æ˜¯å¤šä»“åº“åˆ†ç»„ï¼Œå¦ä¸€ç§å°±æ˜¯ `monorepo` äº†ã€‚

ä½œä¸ºä¸€ä¸ªç¤ºä¾‹é¡¹ç›®æ¥è¯´ï¼Œå¤ªå¤šä»“åº“ä¸ç®¡æ˜¯å¯¹å­¦ä¹ è€…è¿˜æ˜¯ç»´æŠ¤è€…éƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©äº†å•ä¸€ä»“åº“çš„ `monorepo` çš„æ–¹å¼æ¥ç®¡ç†é¡¹ç›®çš„åº”ç”¨å’Œå­åŒ…ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å¸¦å¤§å®¶ä½¿ç”¨ `pnpm workspace` æ¥åˆå§‹åŒ–æ•´ä¸ªé¡¹ç›®çš„å·¥ç¨‹æ¶æ„ã€‚

**é¦–å…ˆ**ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ†åˆ«åˆ›å»º `app` å’Œ `package` ç›®å½•ï¼Œç”¨äºå­˜æ”¾åº”ç”¨ä¸ç±»åº“ã€‚ç„¶ååœ¨åˆ›å»º `pnpm-workspace` é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥å®šä¹‰ `monorepo` çš„å·¥ä½œåŒºé—´ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

```diff
lgnition-web            
+  app 
+  packages  
+  LICENSE
+  README.md
+  package.json
+  pnpm-lock.yaml
+  pnpm-workspace.yaml
```

åˆ›å»ºå¥½ç›®å½•æ–‡ä»¶åï¼Œåœ¨ `pnpm-workspace.yaml` ä¸­å£°æ˜ `app` å’Œ `packages` çš„å·¥ä½œåŒºã€‚ç¡®ä¿å®ƒä»¬èƒ½å¤Ÿæ­£å¸¸çš„è¢«å½“ä½œå·¥ä½œåŒºé—´è¯†åˆ«ï¼š

*   **app**ï¼šæ”¾ç½®é¡¹ç›®çš„åº”ç”¨å’Œå­åº”ç”¨å·¥ç¨‹ï¼Œæ¯”å¦‚æ¥å£æœåŠ¡ï¼Œæ­å»ºå¹³å°**webå®¢æˆ·ç«¯**ã€‚
*   **packages**ï¼šæ”¾ç½®é¡¹ç›®ä¸­åˆ›å»ºçš„npmå­åŒ…ï¼Œå¦‚ç¼–è¾‘å™¨ç»„ä»¶ï¼Œç‰©æ–™åº“ï¼Œæ ¸å¿ƒå®ç°ç­‰**npmåŒ…**ã€‚

```yaml
packages:
  - 'app/**'
  - 'packages/**'
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ•´ä¸ªä½ä»£ç å¹³å°é¡¹ç›®åˆ’åˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯çš„è¯å·²ç»å•ç‹¬æ‘˜å‡ºå»åšä¸€ä¸ªç‹¬ç«‹çš„ä»“åº“ç»´æŠ¤ï¼Œå®¢æˆ·ç«¯ç›¸å…³çš„å­˜æ”¾ç›®å‰è€ƒè™‘ç”¨å¾®å‰ç«¯æ¥åšæŒ‚è½½ï¼Œåç»­é€šè¿‡ä¸»å·¥ç¨‹å°†æ‰€æœ‰å¾®åº”ç”¨è¿›è¡Œæ”¶æ•›ã€‚å‰©ä¸‹çš„å°±æ˜¯ä¸ºä½ä»£ç å¹³å°æä¾›æ”¯æ’‘çš„åº•å±‚é€»è¾‘ **SDK**ï¼Œåœ¨å®¢æˆ·ç«¯æ¥å…¥å°½å¯èƒ½çš„å¿«é€Ÿä¾¿æ·ï¼Œæ— æ˜æ˜¾å¿ƒæ™ºè´Ÿæ‹…ã€‚

![å·¥ç¨‹æ ·æ¿.drawio (1).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f26a2223cbb4d928512c877f75aa9cb\~tplv-k3u1fbpfcp-zoom-1.image)


![Untitled (2).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c72e3c94139d4d55bcd5f2201d2b01da~tplv-k3u1fbpfcp-watermark.image?)

æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºä¸€äº›åŒ…çš„èµ„æº **Diff** é€šè¿‡å®ƒä»¬æ¥ç†è§£å½“å‰çš„æ–‡ä»¶ç›®å½•å˜æ›´ã€‚

```diff
lgnition-web           
â”œâ”€ app                                           
+     main                                   
+     editor     
+     ...
â”œâ”€ package                                     
+     core                            
+     materials                                   
+     render   
+     ...
â”œâ”€ LICENSE
â”œâ”€ README.md
â”œâ”€ package.json
â”œâ”€ pnpm-lock.yaml
â””â”€ pnpm-workspace.yaml
```

## ESLint

å¯¹äºç°åœ¨å¼€å‘é¡¹ç›®æ¥è¯´ï¼Œ**ESLint** è§„èŒƒå·²ç»æˆä¸ºå¿…ä¸å¯å°‘çš„ä¸€ä¸ªç¯èŠ‚ã€‚å‡å°‘äº†ä¸åŒå¼€å‘è€…ä»£ç å·®å¼‚åŒ–ä»¥åŠä¸€äº›å¸¸è§„çš„é”™è¯¯è¯­æ³•æ ¡éªŒã€‚

å¯¹äº **Monorepo** çš„ä»“åº“æ¥è¯´ï¼Œå¯ä»¥åœ¨ä¸»ä»“åº“ä¸­åˆ›å»º **ESLint** çš„æ£€æŸ¥è§„åˆ™ï¼Œç„¶åä½œç”¨äºæ‰€æœ‰å­é¡¹ç›®ã€‚

> åœ¨ä¼ ç»Ÿçš„ **Multirepos** ä»“åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ä¸ªé¡¹ç›®éƒ½åˆ›å»º **ESLint**ï¼Œè¿™å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªå†—ä½™çš„äº‹æƒ…ã€‚

ä¸‹é¢ï¼Œæˆ‘å°±æ¥å¸¦å¤§å®¶ä¸€æ­¥ä¸€æ­¥å®‰è£… **ESLint**ï¼Œå¹¶é…ç½®å¥½å¯¹åº”çš„è§„åˆ™æ£€æŸ¥ã€‚

**é¦–å…ˆ**ï¼šç»™å…¨å±€å®‰è£… **ESLint** å’Œ **TypeScript**ã€‚é€šè¿‡ **pnpm** ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š

```csharp
# -D è¿è¡Œæ—¶ä¾èµ–
# -w æ ‡è¯†å…¨å±€å®‰è£… @
pnpm add eslint typescript -Dw
```

å½“å‡ºç°å¦‚ä¸‹ä¿¡æ¯è¯´æ˜å®‰è£…å®Œæˆäº†ã€‚

```diff
devDependencies:
+ typescript 4.6.3
+ eslint 8.12.0
```

ä½¿ç”¨ `eslint --init` å¯ä»¥åˆå§‹åŒ–é¡¹ç›®çš„ç›¸å…³ **ESLint** é…ç½®ï¼Œå¹¶ç”Ÿæˆ eslintrc.js æ–‡ä»¶ã€‚æ‰§è¡Œå‘½ä»¤åå¦‚ä¸‹å›¾ï¼Œä¼šæç¤ºé€‰æ‹©ä¸€äº›ç›¸å…³çš„é¡¹ç›®ä¿¡æ¯ã€‚å¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼š[æŸ¥çœ‹é…ç½®](https://link.juejin.cn/?target=https%3A%2F%2Feslint.org%2Fdocs%2Fuser-guide%2Fconfiguring%2F)ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2743708b83584da4ba374c4e1618ffe2\~tplv-k3u1fbpfcp-zoom-1.image)

é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶ã€‚

```diff
  lgnition-web           
â”œâ”€ app                                           
+     main                                   
+     editor     
+     ...
â”œâ”€ package                                     
+     core                            
+     materials                                   
+     render   
+     ...
â”œâ”€ LICENSE
+ .eslintignore
+ .eslintrc.js
â”œâ”€ README.md
â”œâ”€ package.json
â”œâ”€ pnpm-lock.yaml
â””â”€ pnpm-workspace.yaml
```

**æ­¤æ—¶**ï¼šæˆ‘ä»¬é¡¹ç›®çš„ **ESLint** å°±åˆ›å»ºå¥½äº†ï¼Œä¸‹é¢å°±å¯ä»¥é€‰æ‹©ä¸€ä¸ªç”¨æˆ·ç¾¤ä½“è¾ƒä¸ºå¹¿æ³›è§„èŒƒåŒ–çš„åº“ä½œä¸ºåŸºç¡€ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„ä¹ æƒ¯è¿›è¡Œé¢å¤–çš„é…ç½®ã€‚

æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢ **standard** è¿™ä¸ªåº“ï¼Œä¸‹é¢å°±ä»¥ **standard** åšä¸ºä½¿ç”¨æ•™ç¨‹æ¥å®‰è£…å¦‚ä¸‹ä¾èµ–ï¼š

```shell
pnpm install @typescript-eslint/parser eslint-config-standard eslint-config-standard-jsx eslint-plugin-import eslint-plugin-node eslint-plugin-promise -D -w
```

å®‰è£…å®Œæˆåï¼Œä¿®æ”¹ `.eslintrc.js` åŠ è½½è§„åˆ™é…ç½®ã€‚æˆ‘çš„é…ç½®çœ‹èµ·æ¥æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œå°† **parser** æ›´æ¢ä¸º **@typescript-eslint/parser** æ¥æ”¯æŒ **TypeScript**ã€‚é€šè¿‡ **extends** ç»§æ‰¿ **standard standard-jsx** æ¥æ”¯æŒ **JS & JSX** æ¨¡å¼ã€‚

```diff
module.exports = {
  env: {
    node: true,
    es2021: true,
    browser: true
  },
  extends: [
+    'standard',
+    'standard-jsx'
  ],
+  parser: '@typescript-eslint/parser',
  rules: {
     // è‡ªå®šä¹‰è§„åˆ™
+    'no-unused-vars': 'off',
+    'no-useless-constructor': 'off'
  }
}
```

**VSCode** çš„ **ESLint** æ’ä»¶æ­¤æ—¶å·²ç»è¯†åˆ«åˆ°äº†æˆ‘ä»¬é¡¹ç›®ä¸­çš„ä¸è§„èŒƒä»£ç ï¼Œä¼šå‡ºç°æ³¢æµªçº¿æç¤ºçº æ­£ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a6d18e600e44cd58fded3f26a41b0f2\~tplv-k3u1fbpfcp-zoom-1.image)

é€šè¿‡æ‰§è¡Œ `eslint --ext .js,.jsx,.ts,.tsx` ï¼Œæ¥è¯•è¯•çœ‹å‘½ä»¤è¡Œçš„ä¸è§„èŒƒä»£ç æ£€æŸ¥æ˜¯å¦æ˜¯èƒ½å¤Ÿä½¿ç”¨çš„ï¼Œå¯ä»¥æ­£å¸¸æ£€æµ‹çš„è¯ï¼Œå°†å‘½ä»¤æ·»åŠ åˆ°æ ¹ç›®å½• **package.json** æ‰§è¡Œè„šæœ¬å½“ä¸­ï¼š

```diff
"script": {
+    "lint:js": "eslint --ext .js,.jsx,.ts,.tsx ./",
+    "lint:fix": "eslint --fix --cache --ext .js,.jsx,.ts,.tsx ./"
}
```

æ‰§è¡Œ **lint** è„šæœ¬åï¼Œä¼šå°† **Error** å’Œ **Warning** éƒ½è¾“å‡ºåœ¨æ§åˆ¶å°ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc36cf14e95943e09eca112dcad3cae4\~tplv-k3u1fbpfcp-zoom-1.image)

æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„å…¨å±€**ESLint**è§„åˆ™å°±é…ç½®å®Œæ¯•äº†ï¼Œåç»­åœ¨å­é¡¹ç›®å½“ä¸­å¼€å‘æ—¶ï¼Œå°±ä¸éœ€è¦å†é‡æ–°é…ç½®ä¸€éè§„åˆ™æ£€æŸ¥ï¼Œä¼šç›´æ¥ä½¿ç”¨å…¨å±€çš„è§„èŒƒæç¤ºã€‚æ­¤æ—¶ï¼Œ**Lint** ä¼šå¯¹æ•´ä¸ªé¡¹ç›®éƒ½è¿›è¡Œè§„åˆ™æ‰«æï¼ŒåŒ…æ‹¬ä¸‹é¢çš„å­åº”ç”¨å’Œå­åŒ…éƒ½èƒ½äº«å—åˆ°å¯¹åº”çš„è§„åˆ™æ£€æŸ¥ã€‚

### å­åŒ…(SubPackage)æ„å»º

åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œéœ€è¦æ„å»ºæˆ‘ä»¬çš„ä¸€äº› **Npm** åŒ…ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œ**Webpack**ã€**Rollup** è¿™äº›æ‰“åŒ…å·¥å…·é…ç½®æ— ç–‘æ˜¯ç¹ççš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æ‰“åŒ…æ„å»ºå·¥å…·ã€‚

åŸºäºè¿™äº›å› ç´ ï¼Œæˆ‘é€‰æ‹©äº† **Microbundle**ã€**Tsdx**ã€**Vite** è¿™å‡ ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„æ„å»ºåº“ã€‚é€šè¿‡ [npm trends](https://npmtrends.com/microbundle-vs-tsdx-vs-vite) å°†å®ƒä»¬è¿›è¡Œæ¯”å¯¹åéƒ½æ˜¯åŸºäº **Rollup** çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡ä½é…ç½®çš„æ–¹å¼å¿«é€Ÿäº§å‡º **UMD**ã€**ESM** ç­‰æ¨¡å—äº§ç‰©ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f09e504c91364d4aba92ec13f967a22a\~tplv-k3u1fbpfcp-zoom-1.image)

æœ€ç»ˆï¼Œæˆ‘æ‹Ÿå®šäº† **Vite** ä½œä¸ºä¾èµ–åº“çš„æ„å»ºå·¥å…·ï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   éƒ½æ˜¯é€šè¿‡é¢„ç½® **Rollup** é…ç½®ä½œä¸ºæ„å»ºå·¥å…·ï¼Œ**Vite** ä¸ä»…ä»…æ”¯æŒç±»åº“çš„æ‰“åŒ…ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä½œä¸º **Bundless** æ„å»ºå™¨ï¼Œåç»­å¿«é€Ÿç§»åŠ¨ **Demo** æœåŠ¡ï¼Œæœ‰åˆ©äºè°ƒè¯•ï¼›
*   **Vite** ç¤¾åŒºç”Ÿæ€å¥½ï¼Œç»´æŠ¤åŠ›åº¦å¤§ï¼Œæ’ä»¶ç»´æŠ¤ä¹Ÿå¯è§‚ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œé›†æˆæ‰©å±•ã€‚

ä¸‹é¢ï¼Œæˆ‘å°† **Vite** ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šç¢°åˆ°çš„é—®é¢˜åšä¸€ä¸ªæ±‡æ€»ï¼Œå¹¶æ„å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¾èµ–åº“ã€‚

**é¦–å…ˆ**ï¼Œä½¿ç”¨ `pnpm create` å¿«é€Ÿé€‰æ‹©åˆ›å»ºéœ€è¦çš„æ¨¡æ¿é¡¹ç›®ã€‚

```diff
pnpm create vite core --template react-ts
```

åˆå§‹åŒ–åï¼Œæ•´ä½“çš„ç›®å½•ç»“æ„éå¸¸çš„ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```diff
core
+  src
+  package.json                         
+  tsconfig.json
+  vite.config.ts
```

æ¥ä¸‹æ¥å°±æ˜¯é…ç½®ç›¸å…³çš„æ„å»ºä¿¡æ¯äº†ï¼š

*   åœ¨ **build** ä¸­å£°æ˜å¥½å…¥å£æ–‡ä»¶å’Œå‡ºå£æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ **lib** å½“ä¸­çš„ä¿¡æ¯ï¼›
*   **TypeScript** æ”¯æŒï¼Œä½¿ç”¨ **vite-plugin-dts** æ’ä»¶è¿›è¡Œä¸€äº›ç±»å‹çš„æ‰“åŒ…è¾“å‡ºï¼›
*   å¯¹äºä¸€äº›å…¬ç”¨æ¨¡å—ï¼Œå¦‚ **React**ï¼Œéœ€è¦ä½¿ç”¨ **external** å°†å…¶æ’é™¤ï¼Œé¿å…åç»­äº§ç”Ÿçš„é‡å¤çš„æ¨¡å—ä¾èµ–ä»£ç æ²¡æœ‰è¢« **tracking** æ‰ï¼›
*   å®šä¹‰å¥½å…¨å±€ **UMD** çš„å…³é”®ä¿¡æ¯ï¼Œé¿å…å› ä¸ºç¯å¢ƒç¼ºå°‘ç›¸å…³ä¾èµ–è€Œå‡ºç°é—®é¢˜ã€‚

```diff
import react from "@vitejs/plugin-react";
import dts from 'vite-plugin-dts'

export default {
  plugins: [
+    react(),
+    dts()],
  build: {
    lib: {
+      entry: 'src/index.ts',
+      fileName: (format) => `index.${format}.js`
    },
+    rollupOptions: {
      // æ’é™¤ React å’Œ React DOMï¼Œå› ä¸ºè¿™äº›åº“åº”è¯¥ç”±ä½¿ç”¨ä½ çš„åº“çš„é¡¹ç›®æ¥æä¾›
+      external: ['react', 'react-dom'],
+      output: {
+        // é…ç½® UMD æ ¼å¼ï¼Œä½¿ä½ çš„ç»„ä»¶åº“å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨
+       globals: {
+          react: 'React',
+          'react-dom': 'ReactDOM'
+        },
+        // é…ç½® minify é€‰é¡¹ï¼Œä½¿è¾“å‡ºæ–‡ä»¶æ›´å°
+        minifyInternalExports: true
      }
    }
  }
};
```

é€šè¿‡ä»¥ä¸Šçš„ç®€å•é…ç½®ï¼ŒåŸºæœ¬ä¸Šèƒ½å¤Ÿå®Œæˆ **80%** çš„ç±»åº“æ„å»ºæ”¯æŒï¼Œå‰©ä¸‹çš„ç±»ä¼¼ **Storybook** å’Œ **TailwindCSS** ç­‰éƒ½æ˜¯å¯ä»¥é€šè¿‡æ’ä»¶æ¥å¿«é€Ÿåˆå§‹åŒ–é›†æˆã€‚

## æ„å»º

ç”±äºæˆ‘ä»¬æ˜¯ä¸€ä¸ª **Monorepo** çš„é¡¹ç›®ï¼Œå¿…ä¸å¯å°‘çš„å°±æ˜¯å­åŒ…ä¸å­åŒ…ä¹‹é—´çš„ç›¸äº’ä¾èµ–ï¼Œå­åŒ…ä¸åº”ç”¨ä¹‹é—´çš„ç›¸äº’ä¾èµ–ï¼Œæ‰€ä»¥ä¸ºäº†æ›´å¥½çš„æµç¨‹åŒ–æ„å»ºé¡¹ç›®ï¼Œå¯¹æ•´ä¸ªå·¥ç¨‹éœ€è¦ä¸€ä¸ªå¥½çš„å·¥å…·æ¥ç®¡ç†å·¥ä½œåŒºå’Œä»»åŠ¡ï¼Œæ ‡å‡†æ¯æ„å»ºçš„å·¥ä½œæµç¨‹ã€‚

**Turborepo** æ˜¯ä¸€ä¸ªé’ˆå¯¹ **JavaScript** å’Œ **TypeScript** ä»£ç åº“ä¼˜åŒ–çš„æ™ºèƒ½æ„å»ºç³»ç»Ÿã€‚å¦‚ä¸‹å®˜æ–¹å›¾æ‰€ç¤ºï¼Œé€šè¿‡å®ƒå¯ä»¥å¿«é€Ÿç»„ç»‡é¡¹ç›®å·¥ç¨‹ä¸­çš„ **build**ã€**lint**ã€**test** ç­‰ **CI** æµç¨‹é˜¶æ®µéœ€è¦åšçš„äº‹æƒ…ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/505c8cd17de048ffa3ddc2469f671702\~tplv-k3u1fbpfcp-zoom-1.image)

é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨å·²æœ‰çš„ **Monorepo** é¡¹ç›®ä¸­æ·»åŠ  **Tubro** å‘¢ï¼Ÿå¯ä»¥å‚è€ƒã€Š[Add Turborepo to your existing monorepo](https://turbo.build/repo/docs/getting-started/existing-monorepo)ã€‹å®‰è£…ç›¸åº”çš„ä¾èµ–åŒ…ã€‚å®‰è£…å®Œæˆåï¼Œåœ¨æœ¬åœ°åˆ›å»º \*\*turbo.json \*\* é…ç½®æ–‡ä»¶ã€‚

å¦‚ä¸‹æ˜¯å·¥ç¨‹ä¸­çš„åŸºæœ¬å†…å®¹é…ç½®ï¼Œä¸»è¦æ˜¯ç”¨äºæ„å»º **CI** ä½¿ç”¨ã€‚åœ¨å·¥ç¨‹ **package** ä¸­æ‰§è¡Œ `turbo run build --filter @lgnition-web/editor` å³å¯å®Œæˆæ„å»ºç¼–è¾‘å™¨åº”ç”¨çš„ç›¸å…³ä»»åŠ¡ã€‚

```json
{
  "pipeline": {
    "build": {
      "dependsOn": [
        "^build"
      ],
      "outputs": [
        "dist/**",
        ".next/**"
      ]
    },
    "test": {
      "dependsOn": ["build"],
      "inputs": ["test/**/*.ts", "test/**/*.tsx"]
    },
    "lint": {
      "outputs": []
    },
    "dev": {
      "cache": false
    }
  }
}
```

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šçš„é¡¹ç›®æ“ä½œä¸é…ç½®ï¼ŒåŸºæœ¬ä¸Šå®Œæˆäº†é¡¹ç›®çš„åˆå§‹åŒ–ã€‚æˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„è¿œç¨‹ä»“åº“ï¼Œå°†é¡¹ç›®åº”ç”¨ä¸ä¾èµ–åŒ…åˆ†åˆ«å­˜æ”¾åœ¨ **app** ä¸ **package** ä¸‹ç®¡ç†ï¼Œæœ€åé€šè¿‡å…¨å±€é…ç½® **ESLint** æ¥åšç»Ÿä¸€çš„è§„åˆ™æ£€æŸ¥ã€‚

é’ˆå¯¹éœ€è¦æ„å»ºçš„ä¾èµ–é¡¹ç›®ï¼Œæˆ‘åœ¨åé¢çš„é¡¹ç›®ä¸­éƒ½ä¼šä½¿ç”¨ **tsdx** æ¥åˆå§‹åŒ–æ„å»ºé¡¹ç›®ï¼Œé¿å…æˆ‘ä»¬é‡å¤æ€§çš„åˆ›å»ºå¤æ‚çš„ **Rollup** å·¥ç¨‹ï¼Œå¯ä»¥æ›´å¥½åœ°æŠ•å…¥åˆ°çœŸå®ç¼–ç å½“ä¸­å»ã€‚

ç°å¦‚ä»Šï¼Œè¶Šæ¥è¶Šå¤šç«çƒ­çš„é¡¹ç›®éƒ½åœ¨ä½¿ç”¨ **Monorepo** æ¥ç®¡ç†è‡ªèº«çš„ç›¸å…³æ‹†åˆ†ä»£ç åŒ…ã€‚å¦‚ **Babel**ã€**Vue** ç­‰çŸ¥åçš„å¼€æºé¡¹ç›®ã€‚å¾ˆå¤šåŒå­¦ä»¥å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡ **pnpm** å’Œ **Monorepo**ï¼Œé‚£ä¹ˆåœ¨å¼€å§‹å‡†å¤‡è·Ÿåšè¿™ä¸ªé¡¹ç›®çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨å®ƒã€‚æˆ‘ç›¸ä¿¡ä½ ä¸€å®šä¼šæœ‰æƒŠå–œå’Œæ”¶è·ã€‚

å­¦ä¹ å®Œæœ¬ç« èŠ‚åï¼Œæˆ‘æƒ³ä½ ä¸€å®šä¼šå¯¹å¤šä»“åº“çš„ **Monpopo** æœ‰æ›´åŠ æ·±åˆ»çš„è®¤è¯†ï¼Œå·¥ä½œä¸­ä¹Ÿèƒ½äº§ç”Ÿæ›´å¤šçš„æ€è€ƒã€‚

## èµ„æºæ¨è

*   [pnpm](https://link.juejin.cn/?target=https%3A%2F%2Fpnpm.io%2F)
*   [å…³äºç°ä»£åŒ…ç®¡ç†å™¨çš„æ·±åº¦æ€è€ƒâ€”â€”ä¸ºä»€ä¹ˆç°åœ¨æˆ‘æ›´æ¨è pnpm è€Œä¸æ˜¯ npm/yarn?](https://juejin.cn/post/6932046455733485575)
*   [ESLint](https://link.juejin.cn/?target=https%3A%2F%2Feslint.org%2Fdocs)ã€‚
*   [vitejs](https://vitejs.dev/guide/)
*   [Monorepo](https://link.juejin.cn/?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FMonorepo)
*   [turborepo](https://turbo.build/repo/docs/core-concepts/monorepos/running-tasks)
*   [å°† Turborepo æ·»åŠ åˆ°æ‚¨ç°æœ‰çš„ monorepo](https://turbo.build/repo/docs/getting-started/existing-monorepo)

## å†™åœ¨æœ€å

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘