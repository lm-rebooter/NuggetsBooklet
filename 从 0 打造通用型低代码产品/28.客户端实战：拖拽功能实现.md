å¸‚åœºä¸Šç»å¤§éƒ¨åˆ†çš„å¯è§†åŒ–æ­å»ºå¹³å°éƒ½ä¼šä½¿ç”¨æ‹–æ‹‰æ‹½æ¥å®Œæˆå¯¹åº”é¡µé¢çš„å¸ƒå±€ï¼Œå‡å°‘éç ”å‘æˆå‘˜å¯¹äºé€‰æ‹©ç‰©æ–™è¿›è¡Œæ•´ä½“å¸ƒå±€çš„å­¦ä¹ æˆæœ¬ï¼Œæ‰€ä»¥æµç•…çš„æ‹–æ‹½åŠŸèƒ½æ˜¯åŸºäº **GUI** çš„ä½ä»£ç å¹³å°ä¸­ç¼–è¾‘å™¨æ¨¡å—çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚

åœ¨ **HTML5** ä¸­ï¼Œæä¾›äº† **Drag & Drop** ç›¸å…³çš„ **API** ç”¨æ¥å®ç°å…ƒç´ çš„æ‹–åŠ¨å’Œæ”¾ç½®ã€‚

å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

åˆ†åˆ«åˆ›å»ºäº†ä¸€ä¸ªæ‹–åŠ¨åŒºå’Œä¸€ä¸ªæ”¾ç½®åŒºï¼Œä¸ºå…ƒç´ æ ‡ç­¾å±æ€§è®¾ç½® **draggable** å’Œ **dropzone** å³å¯å¼€å¯å…ƒç´ æ‹–æ‹½è¡Œä¸ºï¼Œä»è€Œèƒ½å¤Ÿä½¿æ“ä½œè€…å°†æ‹–åŠ¨åŒºçš„å…ƒç´ æŒªåŠ¨åˆ°æ”¾ç½®åŒºå½“ä¸­å»ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba557cc58bd742098476096070abddea~tplv-k3u1fbpfcp-watermark.image?)

```html
<style>
  #drag {
    padding: 10px;
    border: 1px solid black;
    display: flex;
    justify-content: flex-start;
    gap: 20px;
  }

  #drag > div {
    width: 50px;
    height: 50px;
    border: 1px solid black;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #drop {
    margin-top: 20px;
    padding: 50px;
    border: 2px dashed black;
  }
</style>


<div id="drag">
  <div data-id="text" draggable="true" >æ–‡æœ¬</div>
  <div draggable="true" >å›¾ç‰‡</div>
  <div draggable="true"  >å®¹å™¨</div>
  <div draggable="true" >å¯Œæ–‡æœ¬</div>
  <div draggable="true" >æ ‡é¢˜</div>
</div>
<div id="drop" dropzone="true" >
  å°†æ‹–åŠ¨å…ƒç´ æ”¾åˆ°è¿™é‡Œ
</div>

<script>
  const drag = document.getElementById('drag');
  const drop = document.getElementById('drop');

  drag.addEventListener('dragstart', function(event) {
    console.log(event, 'event')
    // è®¾ç½®ä¼ è¾“çš„æ•°æ®ç±»å‹å’Œå€¼
    event.dataTransfer.setData('text/plain', event.target.outerText);
  });

  drop.addEventListener('dragover', function(event) {
    // é˜²æ­¢é»˜è®¤è¡Œä¸ºï¼Œä»¥å…è®¸æ‹–åŠ¨å…ƒç´ æ”¾ç½®åˆ°ç›®æ ‡å…ƒç´ ä¸Š
    event.preventDefault();
    // æ·»åŠ æ ·å¼ä»¥æç¤ºç”¨æˆ·
    drop.classList.add('hover');
  });

  drop.addEventListener('dragleave', function(event) {
    // ç§»é™¤ä¹‹å‰æ·»åŠ çš„æ ·å¼
    drop.classList.remove('hover');
  });

  drop.addEventListener('drop', function(event) {
    // é˜²æ­¢é»˜è®¤è¡Œä¸º
    event.preventDefault();
    // ç§»é™¤æ ·å¼
    drop.classList.remove('hover');
    // è·å–ä¼ è¾“çš„æ•°æ®
    const data = event.dataTransfer.getData('text/plain');
    // åœ¨æŒ‡å®šåŒºåŸŸä¸­æ’å…¥æ‹–åŠ¨çš„å…ƒç´ 
    drop.innerHTML = data;
  });
</script>
```

åˆæ­¥äº†è§£äº† **Drag & Drop** çš„ç›¸å…³æ¦‚å¿µåï¼Œæ¥ä¸‹æ¥çš„å†…å®¹ä¼šä¸»è¦å›´ç»•å®ç°ä¸€ä¸ªç¼–è¾‘å™¨åº”è¯¥å…·å¤‡çš„æ‹–æ‹½åŠŸèƒ½ä¸ºå‡ºå‘ç‚¹ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†å®Œæˆåç»­ç¼–è¾‘å™¨å¯è§†åŒ–å¸ƒå±€ **GUI** çš„èƒ½åŠ›ã€‚

## æ‹–æ‹½å¼•æ“æ–¹æ¡ˆ

åœ¨å¼€å¤´çš„æ—¶å€™äº†è§£äº† **HTML5** åŸç”Ÿçš„æ‹–æ‹½æ–¹æ¡ˆï¼Œå¾ˆæ˜æ˜¾å¦‚æœéœ€è¦ç”¨äºé¡¹ç›®å¼€å‘éœ€è¦ä¸å°‘çš„å·¥ä½œé‡å’Œæ”¹é€ æˆæœ¬ã€‚

ç›®å‰ä¸ºæ­¢ï¼Œç¤¾åŒºæœ‰ä¸å°‘çš„æˆç†Ÿçš„æ–¹æ¡ˆéƒ½å¯ä»¥é€‰æ‹©ï¼Œä½†ç”±äºæˆ‘ä»¬çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† **React** æŠ€æœ¯æ ˆï¼Œæ‰€ä»¥æ¨èå¦‚ä¸‹å‡ ä¸ªç¤¾åŒºæ¯”è¾ƒç«çƒ­å’Œç»´æŠ¤åº¦é«˜çš„ä¸€äº›å¼€æºç»„ä»¶ï¼š

- **react-dnd**: æ˜¯ä¸€ä¸ª**React** æ‹–æ”¾åº“çš„å®ç”¨åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„å¯ä»¥ç”¨äºåˆ›å»ºå¯æ‹–æ‹½å’Œå¯æ”¾ç½®ç»„ä»¶çš„ **é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰**å’Œ **Hook** å‡½æ•°ï¼Œå¯ä»¥è½»æ¾åœ°å®ç°å„ç§æ‹–æ”¾æ“ä½œã€‚å¯å¸®åŠ©å¼€å‘æ„å»ºå¤æ‚çš„æ‹–æ”¾ç•Œé¢ï¼ŒåŒæ—¶ä¿æŒç»„ä»¶åˆ†ç¦»ï¼›
- **react-beautiful-dnd**ï¼šåŸºäº **react-dnd** æ‰©å±•çš„æ‹–æ‹½åº“ï¼Œæä¾›äº†ä¸€ä¸ªç¾è§‚çš„è§†è§‰åé¦ˆï¼Œä»¥åŠé«˜æ°´å‡†çš„æ€§èƒ½ä¼˜åŒ–ã€‚æ”¯æŒæ‹–æ”¾åˆ—è¡¨ã€ç½‘æ ¼å’Œæ ‘å½¢ç»“æ„ç­‰åœºæ™¯çš„è¿ç”¨ï¼ŒåŒæ—¶å¯ä»¥é…åˆè™šæ‹Ÿåˆ—è¡¨æŠ€æœ¯æ¥ä¼˜åŒ–éƒ¨åˆ†æ€§èƒ½ç“¶é¢ˆçš„åœºæ™¯ï¼›
- **dnd-kit**ï¼šç”¨äº **React** çš„**è½»é‡çº§**ã€**æ¨¡å—åŒ–**ã€**é«˜æ€§èƒ½**ã€å¯è®¿é—®ä¸”å¯æ‰©å±•çš„æ‹–æ”¾å·¥å…·åŒ…ã€‚

ä»¥ä¸Šå‡ ä¸ªå¼€æºç»„ä»¶åŸºæœ¬ä¸Šèƒ½å¤Ÿé€‚ç”¨äºæ—¥å¸¸å¼€å‘å·¥ä½œä¸­ç»å¤§éƒ¨åˆ†çš„åŸºç¡€äº¦æˆ–è€…æ˜¯å¤æ‚çš„åœºæ™¯äº†ï¼Œæ ¹æ®ä¸åŒçš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„åº“å³å¯ã€‚

å¯¹äºä½ä»£ç çš„æ‹–æ‹½åœºæ™¯æ— éå°±æ˜¯è€ƒè™‘å‡ ç‚¹ï¼Œä¸€ä¸ªæ˜¯åŸºç¡€çš„æ‹–æ‹½åŠŸèƒ½ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯å®¹å™¨å†…ç»„ä»¶çš„äº’ç›¸æ‹–æ‹½å’ŒåµŒå¥—æ‹–æ‹½ã€‚åŸºäºè¿™äº›åœºæ™¯åˆ†æä¸ªäººè¿˜æ˜¯æ¯”è¾ƒæ¨èä½¿ç”¨ **dnd-kit/core** å®ƒæ¥åšä¸ºæ‹–æ‹½å¼•æ“çš„å®ç°é€‰å‹çš„ï¼Œé™¤äº†åŸºç¡€çš„æ‹–æ‹½çš„åŠŸèƒ½å¤–ï¼Œ**dnd-kit** è¿˜æä¾›äº†è®¸å¤šå¯è‡ªå®šä¹‰çš„ç»„ä»¶å’Œé’©å­ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒçš„æ‹–æ‹½éœ€æ±‚ï¼Œåœ¨ **React**ã€**Vue**ã€**Angular**ã€**Svelte** ç­‰çƒ­é—¨çš„å¼€å‘æ¡†æ¶ & åº“ä¸‹éƒ½æœ‰å¯¹åº”çš„å®ç°ï¼Œå¯¹è·¨å¹³å°çš„æ”¯æŒä¹Ÿéå¸¸ä¸é”™ã€‚

é™¤æ­¤ä¹‹å¤– **dnd-kit** çš„æ€§èƒ½ä¹Ÿæœ‰ç›¸å½“ç¨‹åº¦çš„ä¿éšœï¼Œå°¤å…¶æ˜¯åœ¨ **DOMå…ƒç´ ** è¿‡å¤šçš„æ—¶å€™èƒ½æœ‰æ•ˆå‡ç¼“æ“ä½œå¡é¡¿å’Œå¸ƒå±€æŠ–åŠ¨ã€‚

> å¦‚æœæƒ³è¦æ›´ç²¾ç®€çš„å®ç°ï¼Œ**react-dnd** ä¹Ÿæ˜¯éå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯éœ€è¦ç›¸åº”çš„æ‰¿æ‹…å¼€å‘è¿‡ç¨‹ä¸­ä¸€ç³»åˆ—çš„åœºæ™¯å®ç°ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªéå¸¸æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ã€‚æ€»ä½“æ¥è¯´ï¼ŒåŸºäºæ•°æ®é©±åŠ¨çš„æ‹–æ‹½æ–¹æ¡ˆæ•´ä½“éƒ½æ€§èƒ½éƒ½ä¸ä¼šç›¸å·®å¤ªå¤šï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©å–œæ¬¢çš„åº“è¿›è¡Œå¼€å‘ï¼Œä¸å¿…å¼ºæ±‚çº¦æŸã€‚

## æ‹–æ‹½å¼•æ“çš„å®ç°åˆ†æ

ä¸Šä¸€èŠ‚ä¸­ï¼Œåˆ†æäº† **React** å½“ä¸­æ¯”è¾ƒæµè¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œä»¥æ­¤æ¥å®ç°ä¸€ä¸ªåŸºæœ¬çš„æ‹–æ‹½å¼•æ“ï¼Œå…¶ç»“æœå°±æ˜¯è¦å®ç°å°†ç‰©æ–™ç»„ä»¶æ”¾ç½®åˆ°ç”»å¸ƒåŒºåŸŸï¼Œå¹¶ä¸”æŒ‰ç…§ä¸€å®šçš„å¸ƒå±€è§„å¾‹è¿›è¡Œç¼–æ’ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ”¯æŒæ·±å±‚æ¬¡çš„ç»„ä»¶æ ‘å½¢ç»“æ„åµŒå¥—ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé’ˆå¯¹ç›®å‰çš„éœ€æ±‚åšçš„æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

æ•´ä¸ªç¼–è¾‘å™¨ç”»å¸ƒçš„å¸ƒå±€åˆ†ä¸ºå®¹å™¨å¸ƒå±€å’Œç»„ä»¶ä¸¤ä¾§ï¼Œå®¹å™¨å¸ƒå±€è´Ÿè´£è¡Œåˆ—çš„ç¼–æ’ï¼Œç»„ä»¶è´Ÿè´£å†…å®¹çš„æ˜¾ç¤ºï¼Œä¸¤è€…å„å¸å…¶èŒã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0137c288ded34a9f9ffa73fd449d98f4~tplv-k3u1fbpfcp-watermark.image?)

å®ç°åçš„äº§ç‰©ç»“æœå¦‚ä¸‹ï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ecb64eef7324ea6a7cf1f07ca2f4b53~tplv-k3u1fbpfcp-watermark.image?)

é€šè¿‡ **@dnd-kit/core** å’Œ **react-dnd** éƒ½å¯ä»¥å®ç°ä»¥ä¸‹çš„åŸºæœ¬æ•ˆæœã€‚
ä»¥ä¸‹å‡ ä¸ªäº‹ä¾‹éƒ½æ˜¯æ¯”è¾ƒå¥½çš„ä¸€ä¸ªå®ç°è¿‡ç¨‹ï¼Œæ ¹æ®é€‰æ‹©æŠ€æœ¯æ ˆå¯ä»¥å®ç°å¯¹åº”çš„æ•ˆæœï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒå­¦ä¹ ä¸€ä¸‹ã€‚

- **react-dnd**ï¼š[https://medium.com/kustomerengineering/building-complex-nested-drag-and-drop-user-interfaces-with-react-dnd-87ae5b72c803](https://medium.com/kustomerengineering/building-complex-nested-drag-and-drop-user-interfaces-with-react-dnd-87ae5b72c803)
- **@dnd-kit/core**: [https://codesandbox.io/s/dnd-kit-nested-containers-forked-rr0mqy?file=/src/app.js](https://codesandbox.io/s/dnd-kit-nested-containers-forked-rr0mqy?file=/src/app.js)
- **@dnd-kit/sortable**: [https://master--5fc05e08a4a65d0021ae0bf2.chromatic.com/?path=/docs/presets-sortable-multiple-containers--vertical-grid](https://master--5fc05e08a4a65d0021ae0bf2.chromatic.com/?path=/docs/presets-sortable-multiple-containers--vertical-grid)

## é›†æˆåŒ–è§£å†³æ–¹æ¡ˆ

ä»é›¶å®ç°ä¸€ä¸ªæ‹–æ‹½çš„å…¨é“¾è·¯æµç¨‹æ— ç–‘æ˜¯ä¸€é¡¹å·¨å¤§çš„æŒ‘æˆ˜ï¼Œè¿™å…¶ä¸­ä¸ä»…ä»…åŒ…å«äº†**ç‰©æ–™ç»„ä»¶æ”¾ç½®**ã€**ç”»å¸ƒç»„ä»¶äº¤äº’**ã€**å®¹å™¨å¸ƒå±€**ç­‰åŸºç¡€åŠŸèƒ½çš„å®ç°ï¼ŒåŒæ—¶è¿˜éœ€è¦å°†å…¶è¿‡ç¨‹å°è£…ç§°ç‹¬ç«‹çš„**API**æˆ–è€…æ˜¯**ç»„ä»¶**ï¼Œå…¶å·¥ä½œé‡å’Œä»£ç ç¨‹åº¦å¯¹æ–°åŒå­¦è€Œè¨€ï¼Œæ— ç–‘æ˜¯ä¸€ä¸ªåŠé€€çš„å‰å¥ã€‚

å› æ­¤ï¼Œåœ¨æ–¹æ¡ˆè®¾è®¡ç¡®å®šå¥½ä¹‹åï¼Œå¯ä»¥å…ˆåœ¨ç¤¾åŒºçœ‹çœ‹æœ‰æ²¡æœ‰æˆç†Ÿçš„æ–¹æ¡ˆï¼Œå¦‚æœå·²ç»æœ‰ä¸€éƒ¨åˆ†ç¨³å®šçš„é›†æˆåŒ–æ–¹æ¡ˆä¸”å¯ä»¥åˆæ­¥çš„æ»¡è¶³äº§å“çš„éœ€æ±‚çš„è¯ï¼Œé€šè¿‡ä¸€å®šç¨‹åº¦çš„è‡ªå®šä¹‰åå®Œå…¨èƒ½å¤Ÿæ‰¿æ‹…èµ·ä¸€äº›è‡ªå®šä¹‰çš„éœ€æ±‚æ‰©å±•ã€‚

ä¸‹é¢æ˜¯å‡ ä¸ªå€¼å¾—æ¨èçš„è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä¸å°‘çš„æ­å»ºç±»äº§å“åœ¨ä½¿ç”¨å®ƒä»¬ï¼š

- **React-Grid-Layout**: **React-Grid-Layout** æ˜¯ä¸€ä¸ªç±»ä¼¼äº **Packery** æˆ– **Gridster** çš„ç½‘æ ¼å¸ƒå±€ç³»ç»Ÿï¼Œå…·æœ‰å“åº”èƒ½åŠ›å¹¶æ”¯æŒæ–­ç‚¹ï¼ŒåŒæ—¶æ–­ç‚¹å¸ƒå±€å¯ä»¥ç”±ç”¨æˆ·æä¾›æˆ–è‡ªåŠ¨ç”Ÿæˆã€‚
- **craft.js**: **craft.js** æ˜¯ä¸€ä¸ªä»ä¸Šè‡³ä¸‹çš„æ¨¡å—åŒ–é¡µé¢ç¼–è¾‘å™¨çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå†…ç½®äº†ä¸€å¥—å®Œå–„çš„æ‹–æ‹½ä½“ç³»ï¼Œèƒ½æœ‰æ•ˆçš„å¤„ç†ç”¨æˆ·ç»„ä»¶çš„ç»„ç»‡ä¸æ˜¾ç¤ºã€‚

ç”±äº **craft.js** å¯¹æ–°æ‰‹ç›¸å¯¹å‹å¥½ï¼Œèƒ½å¤Ÿç¨å¾®å‡å°‘å…¨é“¾è·¯ä½ä»£ç äº§å“ä¸­çš„ä¸€äº›æŠ€æœ¯ç—›ç‚¹ï¼Œç”±æµ…å…¥æ·±çš„æ…¢æ…¢æ”»å…‹å…¶ä¸­çš„éš¾ç‚¹ï¼Œå†æ ¹æ®è‡ªå·±çš„æƒ³æ³•å®Œæˆå±äºè‡ªå·±çš„ä¸€ä¸ªäº§å“è®¾è®¡ï¼Œå¾ªåºæ¸è¿›å®Œæˆè¿›é˜¶ã€‚

æ‰€ä»¥åœ¨å°å†Œçš„å¼€æºé¡¹ç›®ä¸­ä¼šå°†é€‰æ‹© **craft.js** æ¥æ·±å±‚æ¬¡çš„è‡ªå®šä¹‰ä¸€äº›ç¼–è¾‘å™¨çš„äº¤äº’å†…å®¹ã€‚

### å®‰è£…

é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…: 

```html
// -w ä¸ºå…¨å±€å®‰è£…æ¨¡å¼ï¼Œå®‰è£…ååœ¨æ‰€æœ‰çš„å­åŒ…å½“ä¸­éƒ½å¯ä»¥ç›´æ¥å¼•ç”¨åˆ°å®ƒï¼Œæ— éœ€é‡å¤è¿›è¡Œå®‰è£…ã€‚
pnpm add @craftjs/core -w
```

### åˆ›å»ºç‰©æ–™Node

ä½¿ç”¨ **craft.js** åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç»„ä»¶éå¸¸çš„ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ **useNode** è¿›è¡Œè¿æ¥å³å¯ã€‚

å¦‚ä¸‹ç®€å•çš„ä¾‹å­æ‰€ç¤ºï¼š

```tsx
import {useNode} from "@craftjs/core";

const TextComponent = ({text}) => {
  const { connectors: {drag} } = useNode();

  return (
    <div ref={drag}>
      <h2>{text}</h2>
    </div>
  )
}
```

ä½†æ˜¯è¿™æ ·çš„è¯æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œé‚£å°±æ˜¯ **craft.js** å’Œç»„ä»¶åº“æ— æ³•è§£è€¦ï¼Œç»„ä»¶åº“å•ç‹¬ä½¿ç”¨ä¸çº¯ç²¹ã€‚

åŸºäºè¿™ä¸ªé—®é¢˜è€ƒè™‘ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯éœ€è¦å¯¹å®ƒåšä¸€äº›å®šåˆ¶åŒ–çš„æ”¹é€ ï¼Œå› æ­¤åœ¨ **@lgnition-lowcode/core** ä¸­ä¼šå£°æ˜ä¸¤ä¸ªæ–¹æ³•ï¼š

- **withMaterialNode**ï¼šä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶åœ¨å…¶ä¸Šå±‚è¿›è¡Œä¸€äº›é€»è¾‘å¤„ç†ï¼Œæ¯”å¦‚å°†ä¸Šè¿°äº‹ä¾‹ä¸­çš„ **useNode** è¿æ¥æ”¾åˆ°å…¶ä¸­ï¼Œæˆ–è€…æ˜¯åé¢éœ€è¦æ³¨å†Œé€šç”¨å±æ€§å’Œå¤„ç†ç›¸å…³é€»è¾‘éƒ½å¯ä»¥æ”¾åˆ°è¿™ä¸€å±‚æ¥åšã€‚
- **createReactMaterial**ï¼šåˆ›å»º **React** ç‰©æ–™çš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯æ¥åˆ›å»ºç‰©æ–™ **config** å±æ€§é…ç½®ï¼Œå…¶ä¸­å®šä¹‰äº†ç‰©æ–™ç›¸å…³çš„æè¿°å’Œå±æ€§é¢æ¿çš„é…ç½®ä¸å®ç°ã€‚å…·ä½“å¯ä»¥å‚è€ƒç‰©æ–™ç»„ä»¶æ¨¡å—çš„è®¾è®¡ã€‚

å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```tsx
import * as React from 'react'
import type { UserComponent, UserComponentConfig } from '@craftjs/core';
import { useNode } from '@craftjs/core'

/** ç‰©æ–™ç±»å‹ */
export type MaterialComponent = UserComponent

/**
 * ç‰©æ–™ç»„ä»¶HOCï¼Œé€ä¼  useNode Ref
 * @param WrapComponent ç‰©æ–™ç»„ä»¶
 */
export function withMaterialNode<T = any> (WrapComponent: React.FunctionComponent<T>) {
  return React.forwardRef(function (props: any) {
    const { connectors: { connect, drag } } = useNode()

    return <WrapComponent ref={(dom: HTMLElement) => connect(drag(dom))} {...props} />
  })
}

/**
 * åˆ›å»ºReactç‰©æ–™ç»„ä»¶
 * @param component ç‰©æ–™ç»„ä»¶
 * @param options ç‰©æ–™é…ç½®
 */
export function createReactMaterial<T> (component: MaterialComponent, options: Partial<UserComponentConfig<T>>) {
  component.craft = options
  return component as MaterialComponent
}
```
> åœ¨åˆæœŸå®ç°ç¼–è¾‘å™¨å®ç°ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€é™‹çš„å®ç°ï¼Œåç»­éšç€ä»£ç å¢é‡ä¼šé€æ­¥æ‰©å±•ï¼Œä¸€æ­¥æ­¥çš„æ¥å®ç°æ›´å¤šçš„åŠŸèƒ½ã€‚

æœ€åï¼Œåœ¨ **@lgnition-lowcode/core** çš„ **index.ts** æ–‡ä»¶ä¸­å¯¼å‡ºåï¼Œå°±å¯ä»¥ç”¨å®ƒä»¬æ¥åˆ›å»ºç‰©æ–™ç»„ä»¶äº†ã€‚

### åˆ›å»ºç¤ºä¾‹

å®‰è£… **@lgnition-lowcode/core** åŒ…åï¼Œå¯ä»¥å¿«é€Ÿçš„å®ç°ä¸€ä¸ª **React** ç»„ä»¶ã€‚

å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```tsx
import * as React from 'react'
import { createReactMaterial, withMaterialNode } from '@lgnition-lowcode/core'

export interface TextProps {
  children?: React.ReactNode
}

const TextView =  React.forwardRef<HTMLDivElement, TextProps>((props, ref) => {
  return (
    <div ref={ref} >
      {props.children}
    </div>
  )
})

export const Text = createReactMaterial(withMaterialNode<TextProps>(TextView), {
  displayName: 'æ–‡æœ¬ç»„ä»¶'
})
```
**TextView** æ˜¯ä¸€ä¸ªç®€å•çš„ **React** ç»„ä»¶ï¼Œå¤§å¤šæ•°ç»„ä»¶éƒ½ä¼šä½¿ç”¨ **forwardRef** æ¥å‘å¤–éƒ¨æš´éœ² **ref** çš„å±æ€§ï¼Œç”¨äºåç»­æ·»åŠ ç›¸åº”çš„æ“ä½œï¼Œæä¾›ç»„ä»¶ç®¡ç†çš„æ”¯æŒã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•çš„è§†å›¾ç»„ä»¶ï¼Œå¯ä»¥æä¾›ç»™ä¸šåŠ¡ä¾§å•ç‹¬ä½¿ç”¨ï¼Œæä¾›ç»™æ­å»ºå¹³å°ä½¿ç”¨çš„è¯å°±éœ€è¦é€šè¿‡ **withMaterialNode** æ¥åŒ…è£¹ç»„ä»¶ï¼Œè®©å®ƒèƒ½å¤Ÿæ”¯æŒæ‹–æ‹½çš„è¿æ¥å’Œæ“ä½œã€‚æœ€ååœ¨ä½¿ç”¨ **createReactMaterial** æ·»åŠ ç›¸åº”çš„ç»„ä»¶ä¿¡æ¯ã€‚

æ­¤æ—¶ï¼Œ**Text** ç»„ä»¶å°±å·²ç»é›†æˆ **craft.js** ç›¸å…³çš„ç¼–è¾‘èƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨ç¼–è¾‘å™¨å½“ä¸­è‡ªç”±çš„è¿›è¡Œæ‹–æ‹½ã€‚åˆ°äº†è¿™ä¸€æ­¥ï¼Œæ•´ä¸ªä½ä»£ç çš„åŸºç¡€æ‹–æ‹½æˆ‘æƒ³è®¤çœŸè¯»ä¸‹æ¥çš„åŒå­¦åº”è¯¥é—®é¢˜ä¸æ˜¯å¤ªå¤§ï¼Œåç»­å¤æ‚çš„ä¹Ÿä¼šåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ã€‚

## iframe

**iframe** åœ¨æµè§ˆå™¨ä¸­æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ²™ç›’å®¹å™¨ï¼Œèƒ½å¤Ÿåœ¨ç½‘é¡µä¸­åµŒå…¥å¦ä¸€ä¸ªç½‘é¡µæˆ–æ–‡æ¡£ã€‚å¸¸å¸¸è¢«ä½œç”¨äºå¾®å‰ç«¯å®¹å™¨çš„éš”ç¦»æ–¹æ¡ˆå­˜åœ¨ã€‚

åœ¨ä½ä»£ç å¹³å°å½“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å€Ÿç”¨ **iframe** çš„èƒ½åŠ›æ¥ä¸ºç¼–è¾‘å™¨ç”»å¸ƒæä¾›å¯¹åº”çš„éš”ç¦»èƒ½åŠ›ï¼Œä»¥æ­¤æ¥å…¼å®¹éƒ¨åˆ†ç‰¹æ®Šå•ä½åœ¨ç”»å¸ƒä¸­çš„æ˜¾ç¤ºï¼Œå¦‚ `vw`ã€`vh` ç­‰é•¿åº¦çš„å•ä½çš„å…¼å®¹ï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç«¯ä¸Šè¢«å¹¿æ³›åº”ç”¨ã€‚

ä½¿ç”¨ **iframe** æœ‰å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ¡ˆï¼š

**ç¬¬ä¸€ç§æ–¹æ¡ˆ**: é€šè¿‡ **src** å±æ€§æ¥è¿æ¥ä¸€ä¸ªé¡µé¢ï¼Œå¦‚ä¸‹å›¾ä»£ç é¢„è§ˆç»“æœæ˜¾ç¤ºï¼Œå°† **preview** é¡µé¢ç›´æ¥åµŒå…¥ç¼–è¾‘å™¨ç”»å¸ƒå½“ä¸­ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä¸ **iframe** çš„äº¤äº’æ¥å®Œæˆä¸€äº›æ“ä½œã€‚

éœ€è¦æ³¨æ„çš„æ˜¯åœ¨æ­¤æ–¹æ¡ˆä¸­ï¼Œ**iframe** æ˜¯åŠ è½½äº†ä¸€ä¸ªæ–°çš„é¢„è§ˆé¡µé¢ï¼Œç”±äº **iframe** çš„é™åˆ¶åŸå› ï¼Œæ¯æ¬¡è¿›å…¥éƒ½æ˜¯ä¸€æ¬¡æµè§ˆå™¨ä¸Šä¸‹æ–‡é‡å»ºã€èµ„æºé‡æ–°åŠ è½½çš„è¿‡ç¨‹ï¼Œä¼šå­˜åœ¨éƒ¨åˆ†èµ„æºé‡å¤åŠ è½½å¼•ç”¨çš„é—®é¢˜ã€‚åœ¨å¾®å‰ç«¯æ¡†æ¶ **qiankun** ä¸­ï¼Œä¹Ÿæè¿°äº†ä¸€äº› **iframe** çš„ä¸€äº›å¼Šç«¯ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š[https://www.yuque.com/kuitos/gky7yw/gesexv](https://www.yuque.com/kuitos/gky7yw/gesexv) 

```tsx
<iframe width="100%" height="100%" src='./preview' className={css({
  overflow: 'hidden',
  border: 'none'
})}  />
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f02d13c6eb24261bebbf4e84125ddf0~tplv-k3u1fbpfcp-watermark.image?)

**ç¬¬äºŒç§æ–¹æ¡ˆ**: é€šè¿‡ **ReactDOM.createPortal** æ¥æŒ‚è½½å¯¹åº”çš„å†…å®¹æ˜¾ç¤ºçš„å†…å®¹ï¼Œè¿™ä¸ªæ–¹å¼å¯ä»¥ç›´æ¥å°† **React** çš„ç»„ä»¶è¿›è¡ŒæŒ‚è½½æ˜¾ç¤ºï¼Œå…·ä½“æ¥è¯´ï¼Œå¯ä»¥å°† **iframe** çš„ **contentWindow.document.body** ä½œä¸ºæ¸²æŸ“ç›®æ ‡æ¥æ¸²æŸ“ **React** çš„ç»„ä»¶ã€‚

å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```tsx
import * as React from 'react'
import { css } from '@emotion/css'
import { createPortal } from 'react-dom'

export interface FrameRenderProps {
  children?: React.ReactNode
}

export const FrameRender: React.FC<FrameRenderProps> = ({ children, ...props }) => {

  const ref = React.useRef<HTMLIFrameElement>(null)

  const mountNode =
    ref?.current?.contentWindow?.document.body

  return (
    <iframe {...props} ref={ref} width="100%" height="100%" className={css({
      border: 'none'
    })} >
      {mountNode ? createPortal(children, mountNode) : null}
    </iframe>
  )
}
```

é€šè¿‡ä¸º **iframe** ç»‘å®š **ref**ï¼Œä»è€Œè·å– **iframe** å®ä½“çš„ **body**ï¼Œè¿™ä¸ª **body** å°±æ˜¯ **createPortal** éœ€è¦æŒ‚è½½çš„èŠ‚ç‚¹ï¼Œè°ƒç”¨ **createPortal(children, mountNode)** æ–¹æ³•ï¼Œæ­¤æ—¶å°±ä¼šå°† **FrameRender** ç»„ä»¶çš„ **children** æ¸²æŸ“åˆ° **iframe** å½“ä¸­å»ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æ— éœ€æ–°åˆ›å»ºä¸€ä¸ª **route** æ¥ä¸“é—¨çš„ä½œä¸ºæ˜¾ç¤ºçš„å®¹å™¨ï¼Œçº¯ç²¹å½“æˆæ²™ç›’å®¹å™¨æ¥ä½¿ç”¨ã€‚

**FrameRender** ç»„ä»¶åˆ›å»ºå¥½åï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥åŒ…è£¹ä¸€ä¸ªç¼–è¾‘å™¨ç”»å¸ƒçš„å†…å®¹ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```tsx
<FrameRender>
        <Frame/>
      </FrameRender>
```

**Frame** ç»„ä»¶æ˜¯è¦æ˜¾ç¤ºçš„ä¸€ä¸ªå†…å®¹ï¼Œé€šè¿‡ **createPortal** æˆåŠŸçš„å°†å®ƒæŒ‚è½½åˆ°äº† **iframe** çš„ **body** ä¸­è¿›è¡Œæ¸²æŸ“æ˜¾ç¤ºã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68ce912b29a042a1824c51fbf3ddb8be~tplv-k3u1fbpfcp-watermark.image?)

éœ€è¦æ³¨æ„çš„å°±æ˜¯èµ„æºçš„åŠ è½½ï¼Œç”±äºæ˜¯ **iframe** æ²™ç›’åŠ è½½å†…å®¹ï¼Œå¦‚æœæ¸²æŸ“çš„ç»„ä»¶å¼•ç”¨äº†å·¥ç¨‹ä¸­çš„æ ·å¼çš„è¯ï¼Œé‚£å°±ä¼šå‡ºç°æ ·å¼ä¸¢å¤±çš„é—®é¢˜ï¼Œè§£å†³çš„åŠæ³•ä¹Ÿå®¹æ˜“ï¼Œå‚è€ƒäº†å¾®å‰ç«¯çš„å®ç°è¿‡ç¨‹ï¼Œåœ¨ **iframe** æŒ‚è½½æœŸé—´ï¼Œä¼šå°†ä¸»å·¥ç¨‹ç›¸å…³çš„ä¸€äº›å†…å®¹è¿›è¡Œæ‹·è´ï¼Œä»è€Œåœ¨ **iframe** ä¸­ç”Ÿæˆä¸€ä¸ªå½±å­ç¯å¢ƒï¼Œè¿™æ ·çš„è¯å°±èƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šä¿æŒä¸¤ä¸ªå®¹å™¨é—´çš„å†…å®¹ç›¸å¯¹è€Œè¨€æ¯”è¾ƒä¸€è‡´ã€‚

ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ï¼Œç¤¾åŒºä¸­ä¹Ÿæœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ **react-frame-component**ï¼Œå°±èƒ½å¤Ÿå¾ˆå¥½çš„å°†æ•´ä¸ª **React** åº”ç”¨ç¨‹åºæˆ–æ¯ä¸ªç»„ä»¶å°è£…åœ¨ä¸€ä¸ª **iframe** ä¸­ã€‚å¦‚æœæœ‰å…´è¶£çš„è¯ï¼Œä¹Ÿå¯ä»¥æŸ¥é˜…ç›¸å…³çš„ä¸€äº›å­¦ä¹ æ–‡ç« ï¼Œæ¯”å¦‚[https://blog.logrocket.com/best-practices-react-iframes/](https://blog.logrocket.com/best-practices-react-iframes/) å°±å¾ˆå¥½çš„è®²è¿°äº†å…¶ä¸­çš„ä¸€äº›æ¦‚å¿µçŸ¥è¯†ç‚¹ã€‚

## æ€»ç»“

æœ¬èŠ‚ä¸»é¢˜ä¸»è¦æ˜¯å¯¹ç¼–è¾‘å™¨ç›¸å…³çš„æ‹–æ‹½åšäº†ç›¸å…³çš„æŠ€æœ¯é€‰å‹å’Œç›¸å…³çš„å®è·µã€‚åœ¨åç»­çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šä¸»è¦ä½¿ç”¨ **craft.js** è¿™ä¸ªå¼€æºç»„ä»¶æ¥ä½œä¸ºä¸€ä¸ªä¸­é—´å±‚å®ç°ç¼–è¾‘å™¨ç›¸å…³çš„æ‹–æ‹½ä¸ç¼–æ’å…³è”ã€‚

ä½¿ç”¨ **craft.js** å¯ä»¥æœ€å°æˆæœ¬çš„å®ç°ä¸€ä¸ªä½ä»£ç å¹³å°çš„æ‹–æ‹½åŠŸèƒ½å®ç°ã€‚åœ¨è¿™ä¹‹ä¸Šï¼Œè¿˜æåˆ°äº†åˆ©ç”¨ **iframe** æ¥å®ç°ç¼–è¾‘å™¨ç”»å¸ƒé¢„è§ˆçš„å®¹å™¨æ²™ç›’æ–¹æ¡ˆï¼Œå…¶ç›®çš„å°±æ˜¯ä¸ºäº†å…¼å®¹æµè§ˆå™¨å½“ä¸­å­˜åœ¨çš„ä¸€äº›æ ·å¼æ±¡æŸ“æ–¹é¢çš„é—®é¢˜ï¼Œä»è€Œæ‰“é€ ä¸€ä¸ªåœºæ™¯çœŸå®è¿˜åŸçš„ä¸€ä¸ªé¢„è§ˆå®¹å™¨ã€‚

ç›®å‰å¸‚åœºä¸Šçš„äº§å“è€Œè¨€ï¼Œå¤§ä½“ä¸Šéƒ½åŒ…å«äº†ä¸¤è€…æ–¹æ¡ˆçš„å®ç°ï¼Œå…¶ç›®çš„æ˜¯ä¸€è‡´çš„ã€‚ä¹Ÿæœ‰éƒ¨åˆ†äº§å“å¹¶æ²¡æœ‰æ·»åŠ éš”ç¦»å®¹å™¨ï¼Œè€Œæ˜¯ç›´æ¥æ¸²æŸ“ **dom**ï¼Œä½†æ˜¯è¿™å°±éœ€è¦çº¦æŸç‰©æ–™å±‚çš„ä¸€äº›å®ç°äº†ï¼Œä¸ç®¡æ˜¯ä»ç¼–ç¨‹è§„èŒƒä¸Šé¿å…ç‰¹æ®Šçš„å®ç°ï¼Œè¿˜æ˜¯ä» **CLI** å±‚é¢æ„å»ºæ—¶è‡ªåŠ¨æ›¿æ¢æŠ¹å¹³çš„æ–¹æ¡ˆä¸Šï¼Œæœ€ç»ˆçš„ç»“æœéƒ½æ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·æ­å»ºåº”ç”¨é¢„è§ˆä¸äº§ç‰©çš„å¤šç«¯ä¸€è‡´æ€§ã€‚

åœ¨åç»­çš„è§„åˆ’ä¸­ï¼Œä¹Ÿä¼šåŸºäº **dnd-kit** ç­‰æ‹–æ‹½æ–¹æ¡ˆæ¥å®ç°ä¸€ä¸ªé›†æˆåŒ–çš„ **SDK** æ–¹æ¡ˆï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ›´åŠ é«˜å®šåˆ¶åŒ–çš„å®ç°ä½ä»£ç å¹³å°æ‰€éœ€æ±‚çš„ä¸€ç³»åˆ—æ“ä½œéœ€æ±‚ã€‚

## èµ„æºæ¨è

- [https://docs.dndkit.com/presets/sortable/usesortable](https://docs.dndkit.com/presets/sortable/usesortable)
- [https://craft.js.org/docs/guides/basic-tutorial](https://craft.js.org/docs/guides/basic-tutorial)
- [https://levelup.gitconnected.com/say-goodbye-to-react-dnd-hello-to-dnd-kit-the-future-of-drag-and-drop-is-here-6aa488f17a0](https://levelup.gitconnected.com/say-goodbye-to-react-dnd-hello-to-dnd-kit-the-future-of-drag-and-drop-is-here-6aa488f17a0)
- [https://medium.com/kustomerengineering/building-complex-nested-drag-and-drop-user-interfaces-with-react-dnd-87ae5b72c803](https://medium.com/kustomerengineering/building-complex-nested-drag-and-drop-user-interfaces-with-react-dnd-87ae5b72c803)
- [https://master--5fc05e08a4a65d0021ae0bf2.chromatic.com](https://master--5fc05e08a4a65d0021ae0bf2.chromatic.com/?path=/docs/presets-sortable-multiple-containers--vertical-grid)

## å†™åœ¨æœ€å

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘