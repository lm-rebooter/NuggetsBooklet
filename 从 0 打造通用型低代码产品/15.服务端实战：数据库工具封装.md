åœ¨äº†è§£å®Œ **NestJS** çš„åŸºç¡€é…ç½®ä¹‹åï¼ŒæœåŠ¡ç«¯çš„å†…å®¹å°†å¼•æ¥ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç¯èŠ‚ï¼š**æ•°æ®åº“**ã€‚

å› ä¸ºæ•°æ®åº“çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ç›¸å…³å†…å®¹å°†åˆ†ä¸ºä¸¤ä¸ªç« èŠ‚æ¥å±•å¼€è®¨è®ºï¼š
- **æ•°æ®åº“å·¥å…·å°è£…** - å°†å°è£…ç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œå·¥å…·ç±»ï¼Œæ–¹ä¾¿åæœŸå¼€å‘äºé›†æˆ
- **æ•°æ®åº“å®æ“** - ç»“åˆå®é™…é¡¹ç›®è®²è¿° **TypeORM** çš„ä½¿ç”¨ä»¥åŠ **MySQL** ä¸ **Mongoose** çš„ç¤ºä¾‹

## TypeORM

æ—¥å¸¸å¯¹æ•°æ®åº“çš„æ“ä½œéœ€è¦å€ŸåŠ©äº `SQL`ï¼Œè‡³å°‘éœ€è¦æŒæ¡åŸºç¡€çš„ `SQL` è¯­æ³•å°±æœ‰å»ºè¡¨ã€å¢åˆ æ”¹æŸ¥ç­‰ã€‚ä½†å¦‚æœæƒ³è¦åœ¨ä»£ç ä¸­ç›´æ¥å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œå°±éœ€è¦å»å†™å¤§é‡ `SQL` ï¼Œè¿™åœ¨**å¯è¯»æ€§ã€ç»´æŠ¤æ€§åŠå¼€å‘ä½“éªŒä¸Šéƒ½éå¸¸ç³Ÿç³•**ã€‚

äºæ˜¯ **ORM** æ¡†æ¶åº”è¿è€Œç”Ÿï¼Œè¿™ç±»çš„æ¡†æ¶æ˜¯ä¸ºäº†è§£å†³é¢å‘**å¯¹è±¡ä¸å…³ç³»æ•°æ®åº“å­˜åœ¨çš„äº’ä¸åŒ¹é…çš„ç°è±¡**ï¼ŒæŠŠé¢å‘ `SQL` å¼€å‘è½¬å˜ä¸ºé¢å‘å¯¹è±¡å¼€å‘ï¼Œå¼€å‘ä¸éœ€è¦å…³æ³¨åº•å±‚å®ç°ç»†èŠ‚ï¼Œè€Œæ˜¯ä»¥æ“ä½œå¯¹è±¡çš„æ¨¡å¼ä½¿ç”¨æ•°æ®åº“ã€‚

è™½ç„¶å¸‚é¢ä¸Šä¹Ÿæœ‰å…¶ä»–ä¸é”™çš„ `ORM` æ¡†æ¶ï¼Œæ¯”å¦‚ [Sequelize](https://sequelize.org/)ã€[Prisma](https://www.prisma.io/) ç­‰ï¼Œä½† `TypeORM` ä½¿ç”¨Â `TypeScript`Â ç¼–å†™ï¼Œåœ¨Â `NestJS`Â æ¡†æ¶ä¸‹è¿è¡Œå¾—éå¸¸å¥½ï¼Œä¹Ÿæ˜¯ `NestJS` é¦–æ¨çš„ `ORM` æ¡†æ¶ï¼Œæœ‰å¼€ç®±å³ç”¨çš„Â `@nestjs/typeorm`Â è½¯ä»¶åŒ…æ”¯æŒã€‚

> è¿™ä¸€ç« å¯¹äºå¾ˆå¤šåå‰ç«¯çš„åŒå­¦æ¥è¯´ï¼Œä¼šç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œä½†å€ŸåŠ©äº ORM æ¡†æ¶æ¥è¯´ï¼Œå¹¶éæ˜¯æ— ä»ä¸‹æ‰‹ã€‚

#### å°è£…

`NestJS` ä½¿ç”¨ `TypeORM` çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚ä¸€ç§æ˜¯ `NestJS` æä¾›çš„ `@nestjs/typeorm` é›†æˆåŒ…ï¼Œå¯ä»¥å¯¼å‡º `TypeOrmModule.forRoot` æ–¹æ³•æ¥è¿æ¥æ•°æ®åº“ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨ `ormconfig.json` å°†æ•°æ®åº“é“¾æ¥é…ç½®é¡¹å‰¥ç¦»ã€‚å¦å¤–ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨ `typeorm`ï¼Œè‡ªç”±å°è£… `Providers` å¯¼å…¥ä½¿ç”¨ã€‚

ä¸¤ç§æ–¹æ¡ˆå„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä½¿ç”¨ `@nestjs/typeorm` é›†æˆçš„æ–¹æ¡ˆè¾ƒä¸ºç®€ä¾¿ï¼Œä½†è‡ªå»ºçš„ä¸šåŠ¡è„šæ‰‹æ¶éœ€è¦ä¸¤ç§æ•°æ®åº“ä¿è¯åœ¨å¼€å‘ä¸­ä½“éªŒä¸€è‡´æ€§ï¼Œæ­¤å¤–ä¹‹å‰å·²ç»è‡ªå®šä¹‰äº†å…¨å±€ç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œæ²¡æœ‰å¿…è¦å†å¤šä¸€ä¸ª `ormconfig.json` çš„é…ç½®æ¥å¢åŠ é¢å¤–ç†è§£æˆæœ¬ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆæ¥è¿æ¥æ•°æ®åº“ã€‚

ç”±äºæˆ‘ä»¬å·²ç»é‡‡ç”¨äº† **Monorepo** çš„å¼€å‘æ¨¡å¼ä¸”å·²ç»ä½¿ç”¨äº† **Lib**ï¼Œæ‰€ä»¥å°†å°è£…å·¥å…·ç±»å…¨éƒ¨æ”¶æ•›è¿› `libs/comm`ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å¼€å§‹éƒ½æ˜¯åŸºäº `libs/comm` å·¥å…·åº“ã€‚

**ç¬¬ä¸€æ­¥**ï¼šè·Ÿä¹‹å‰ä¸€æ ·ï¼Œä¸ºäº†ä½¿ç”¨ `TypeORM`ï¼Œå…ˆå®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š

```shell
$ pnpm add typeorm mysql2 mongoose -w
```

**ç¬¬äºŒæ­¥**ï¼šåœ¨ `dev.yaml` ä¸­æ·»åŠ æ•°æ®åº“é…ç½®å‚æ•°ã€‚

```
MONGODB_CONFIG:
  name: "ignition_test"              # è‡ªå®šä¹‰æ¬¡æ•°æ®åº“é“¾æ¥åç§°
  type: mongodb                      # æ•°æ®åº“é“¾æ¥ç±»å‹
  url: "mongodb://localhost:27017"   # æ•°æ®åº“é“¾æ¥åœ°å€
  username: "root"                   # æ•°æ®åº“é“¾æ¥ç”¨æˆ·å
  password: "123456"                 # æ•°æ®åº“é“¾æ¥å¯†ç 
  database: "fast_gateway_test"      # æ•°æ®åº“å
  entities: "mongo"                  # è‡ªå®šä¹‰åŠ è½½ç±»å‹
  logging: false                     # æ•°æ®åº“æ‰“å°æ—¥å¿—
  synchronize: true                  # æ˜¯å¦å¼€å¯åŒæ­¥æ•°æ®è¡¨åŠŸèƒ½
MYSQL_CONFIG:
  name: "material_test"
  type: "mysql"
  host: "121.36.198.10"
  port: 3306
  username: "root"
  password: "123456"
  database: "material_test"
  entities: "mysql"
  logging: true
  synchronize: true
```

ä»¥ä¸Šæ˜¯æ•°æ®åº“è¿æ¥çš„å¿…è¦å‚æ•°ï¼Œå…¶ä»–çš„å‚æ•°å¯ä»¥[å‚è€ƒæ–‡æ¡£](https://typeorm.io/data-source-options)æ ¹æ®éœ€æ±‚æ·»åŠ ï¼Œä¾‹å¦‚ `retryAttempts`ï¼ˆé‡è¯•è¿æ¥æ•°æ®åº“çš„æ¬¡æ•°ï¼‰ã€`keepConnectionAlive`ï¼ˆåº”ç”¨ç¨‹åºå…³é—­åè¿æ¥æ˜¯å¦å…³é—­ï¼‰ ç­‰é…ç½®é¡¹ã€‚

> **MongoDB** æ˜¯æ— æ¨¡å¼çš„ï¼Œæ‰€ä»¥å³ä½¿åœ¨é…ç½®å‚æ•°å¼€å¯äº† `synchronize`ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™ä¹Ÿä¸ä¼šå»æ•°æ®åº“åˆ›å»ºå¯¹åº”çš„è¡¨ï¼Œæ‰€ä»¥ä¸ç”¨å¥‡æ€ªï¼Œå¹¶æ²¡æœ‰å‡ºé”™ï¼Œä½† `Mysql` åœ¨æ¯æ¬¡åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥è¡¨ç»“æ„ã€‚ä¸ºäº†é¿å…æ„å¤– **`synchronize` è¿™ä¸ªé…ç½®å‚æ•°ä¸€å®šä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯ï¼Œæ¯æ¬¡æœåŠ¡å¯åŠ¨çš„æ—¶å€™éƒ½ä¼šåŒæ­¥æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¦‚æœå‡ºç°ä¸»é”®ä¸åŒã€è¡¨ç»“æ„ä¸ç­‰çš„æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥è¿›è¡Œæ•°æ®åº“åˆ è¡¨æ“ä½œï¼Œç”Ÿäº§ç¯å¢ƒä¸€å®šè¦å…³é—­ï¼**

**ç¬¬ä¸‰æ­¥**ï¼šæ–°å»º `lib/comm/src/database/database.providers.ts`

```ts
import { DataSource } from 'typeorm';

import { getConfig } from '../utils/index';
import { NamingStrategy } from './naming.strategies';

const { MONGODB_CONFIG, MYSQL_CONFIG } = getConfig();

const MONGODB_DATABASE_CONFIG = {
  ...MONGODB_CONFIG,
  entities: [`dist/**/*.${MONGODB_CONFIG.entities}.entity.js`]
};

const MYSQL_DATABASE_CONFIG = {
  ...MYSQL_CONFIG,
  namingStrategy: new NamingStrategy(),
  entities: [`dist/**/*.${MYSQL_CONFIG.entities}.entity.js`]
};

const MONGODB_DATA_SOURCE = new DataSource(MONGODB_DATABASE_CONFIG);
const MYSQL_DATA_SOURCE = new DataSource(MYSQL_DATABASE_CONFIG);

// æ•°æ®åº“æ³¨å…¥
export const DatabaseProviders = [
  {
    provide: 'MONGODB_DATA_SOURCE',
    useFactory: async () => {
      if (!MONGODB_DATA_SOURCE.isInitialized) await MONGODB_DATA_SOURCE.initialize();
      return MONGODB_DATA_SOURCE;
    },
  },
  {
    provide: 'MYSQL_DATA_SOURCE',
    useFactory: async () => {
      if (!MYSQL_DATA_SOURCE.isInitialized) await MYSQL_DATA_SOURCE.initialize();
      return MYSQL_DATA_SOURCE;
    },
  },
];
```

å…¶ä¸­ `utils/index` ä¸ºä¸Šä¸€ç« æ’ä»¶çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç§»åŠ¨åˆ° `lib` é‡Œé¢ï¼Œæ–¹ä¾¿å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e46130660a0644d0874134e155ec0cb2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1987&h=993&s=243918&e=png&b=202020)

**æ³¨æ„**ï¼šåˆ›å»ºçš„å®ä½“ç±»æ–‡ä»¶å‘½ååç¼€ç»Ÿä¸€ä¸º `entity.ts`ï¼Œä½†ä¸ºäº†åŒºåˆ†ä¸åŒçš„æ•°æ®åº“æ‰«æï¼ŒåŠ äº† `MYSQL_CONFIG.entities` æ¥åŒºåˆ†ä¸åŒçš„æ•°æ®åº“ç±»å‹ï¼ŒåŒæ ·å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤šæ•°æ®åº“çš„æ—¶å€™ï¼Œå¯ä»¥ä¾ç…§è¿™ç§æ¨¡å¼æ¥æ–°å¢ä¸åŒçš„æ•°æ®åº“ã€‚

å…¶ä¸­é’ˆå¯¹äº **MySQL** ç†è®ºä¸Šéƒ½éœ€è¦éµå®ˆé©¼å³°å‘½åè§„èŒƒï¼Œéœ€è¦å¯¹ä¸€äº›ä¸å¤ªè§„èŒƒçš„å®ä½“ç±»åè¿›è¡Œè½¬æ¢ï¼Œæ‰€ä»¥ä¼šæ¯” **Mongoose** å¯¹ä¸€ä¸ªé…ç½® `naming.strategies.ts`ï¼š

```ts
/*
 * @Author: Cookie
 * @Description: æ·»åŠ æ•°æ®åº“è¡¨ä¸å­—æ®µé©¼å³°è½¬ä¸‹åˆ’çº¿åŠŸèƒ½
 */

import { DefaultNamingStrategy, NamingStrategyInterface } from 'typeorm';
import { snakeCase } from 'typeorm/util/StringUtils';

export class NamingStrategy
  extends DefaultNamingStrategy
  implements NamingStrategyInterface {

  tableName(className: string, customName: string): string {
    return customName ? customName : snakeCase(className);
  }

  columnName(
    propertyName: string,
    customName: string,
    embeddedPrefixes: string[],
  ): string {
    return (
      snakeCase(embeddedPrefixes.concat('').join('_')) +
      (customName ? customName : snakeCase(propertyName))
    );
  }

  relationName(propertyName: string): string {
    return snakeCase(propertyName);
  }

  joinColumnName(relationName: string, referencedColumnName: string): string {
    return snakeCase(relationName + '_' + referencedColumnName);
  }

  joinTableName(
    firstTableName: string,
    secondTableName: string,
    firstPropertyName: string,
    secondPropertyName: string,
  ): string {
    return snakeCase(
      `${firstTableName}_${firstPropertyName.replace(
        /\./gi,
        '_',
      )}_${secondTableName}`,
    );
  }

  joinTableColumnName(
    tableName: string,
    propertyName: string,
    columnName?: string,
  ): string {
    return snakeCase(
      tableName + '_' + (columnName ? columnName : propertyName),
    );
  }

  classTableInheritanceParentColumnName(
    parentTableName: any,
    parentTableIdPropertyName: any,
  ): string {
    return snakeCase(parentTableName + '_' + parentTableIdPropertyName);
  }

  eagerJoinRelationAlias(alias: string, propertyPath: string): string {
    return alias + '__' + propertyPath.replace('.', '_');
  }

}
```

**ç¬¬å››æ­¥**ï¼šæ–°å»º `database.module.ts`

```ts
import { Global, Module } from '@nestjs/common';
import { DatabaseProviders } from './database.providers';

@Global()
@Module({
  providers: [...DatabaseProviders],
  exports: [...DatabaseProviders],
})

export class DatabaseModule { }
```

è‡³æ­¤æˆ‘ä»¬å·²ç»å°è£…äº† `MongoDB` ä¸ `MySQL` çš„ `Provider`ï¼Œä½œä¸ºç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œç±»æä¾›ç»™å…¶ä»–çš„æœåŠ¡è°ƒç”¨ï¼Œä½†è¿™å…¶ä¸­ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ï¼Œä¾‹å¦‚å®ä½“ç±»çš„æ³¨å†Œæ˜¯ä¾èµ–äº**é™æ€è·¯å¾„**æ”¶é›†æ³¨å†Œï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨æ­¤æ–¹å¼çš„è¯ï¼Œä¸å¤ªé€‚ç”¨äº **Webpack** çƒ­æ›´æ–°ä¸ **Monorep** çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥æƒ³ä½¿ç”¨å…¶ä»–æ–¹æ¡ˆçš„è¯ï¼Œå°±ä¸è¦é‡‡å–è¿™ä¸ªæ¨¡å¼ã€‚

#### ä½¿ç”¨

**ä»è¿™ä¸€æ­¥å¼€å§‹éƒ½æ˜¯åŸºäº `app/low-code-test` å®é™…æœåŠ¡ç«¯é¡¹ç›®**ã€‚

**ç¬¬ä¸€æ­¥**ï¼šæ³¨å†Œå®ä½“ï¼Œåˆ›å»º `src/user/user.mongo.entity.ts`

```ts
import { Entity, Column,  ObjectIdColumn } from 'typeorm';

@Entity()
export class User {
  @ObjectIdColumn()
  id?: number;

  @Column({ default: null })
  name: string;
}
```

åœ¨ `MongoDB` é‡Œé¢ä½¿ç”¨çš„æ˜¯ `ObjectIdColumn` ä½œä¸ºç±»ä¼¼ `MySQL` çš„è‡ªå¢ä¸»é”®ï¼Œæ¥ä¿è¯æ•°æ®å”¯ä¸€æ€§ï¼Œåªæ˜¯ç±»ä¼¼ï¼Œå¹¶ä¸æ˜¯è·Ÿæ™®é€šè‡ªå¢ä¸»é”®ä¸€æ ·ä¼šé€’å¢ï¼ŒæŠŠå®ƒçœ‹æˆ `uuid` ç±»ä¼¼å³å¯ã€‚

**ç¬¬äºŒæ­¥**ï¼šåˆ›å»º `user.providers.ts`ï¼š

```ts
import { User } from './user.mongo.entity';

export const UserProviders = [
  {
    provide: 'USER_REPOSITORY',
    useFactory: async (AppDataSource) => await AppDataSource.getRepository(User),
    inject: ['MONGODB_DATA_SOURCE'],
  },
];
```

**ç¬¬ä¸‰æ­¥**ï¼šåˆ›å»º `user.service.ts`ï¼Œæ–°å¢æ·»åŠ ç”¨æˆ· `service`ï¼š

```ts
import { In, Like, Raw, MongoRepository } from 'typeorm';
import { Injectable, Inject } from '@nestjs/common';
import { User } from './user.mongo.entity';

@Injectable()
export class UserService {
  constructor(
    @Inject('USER_REPOSITORY')
    private userRepository: MongoRepository<User>
  ) { }

  createOrSave(user) {
   return this.userRepository.save(user)
  }
}
```

**ç¬¬å››æ­¥**ï¼šåˆ›å»º `user.dto.ts`ï¼Œæ’ä»¶
```ts
import { ApiProperty } from '@nestjs/swagger';
import { IsNotEmpty } from 'class-validator';
export class AddUserDto {
  @ApiProperty({ example: 123, })
  id?: string;

  @ApiProperty({ example: 'cookie' })
  @IsNotEmpty()
  name: string;

  @ApiProperty({ example: 'cookieboty@qq.com' })
  @IsNotEmpty()
  email: string;

  @ApiProperty({ example: 'cookieboty' })
  @IsNotEmpty()
  username: string;
}
```

æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œ**DTOï¼ˆData Transfer Objectï¼‰** ä¸ **Entities** çš„åŒºåˆ«ï¼Œæ¯•ç«Ÿä¸¤ä¸ªæ–‡ä»¶éƒ½å¾ˆç±»ä¼¼ã€‚

é¦–å…ˆå®ƒä»¬éƒ½ç”¨äºè¡¨ç¤ºæ•°æ®ï¼Œä½†åœ¨è®¾è®¡å’Œç”¨é€”æ–¹é¢æœ‰æ‰€ä¸åŒï¼š
- **DTO** æ˜¯ä¸€ç§æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œç”¨äºåœ¨ä¸åŒçš„å±‚ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚å®ƒé€šå¸¸ç”¨äºå°†æ•°æ®ä»æ•°æ®åº“å±‚ä¼ è¾“åˆ°åº”ç”¨ç¨‹åºå±‚ï¼Œæˆ–å°†æ•°æ®ä»åº”ç”¨ç¨‹åºå±‚ä¼ è¾“åˆ°å‰ç«¯å±‚ã€‚**DTO** çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ•°æ®ä¼ è¾“çš„å¼€é”€ï¼Œé€šå¸¸åªåŒ…å«å¿…è¦çš„æ•°æ®å­—æ®µï¼Œè€Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘æˆ–æ“ä½œæ–¹æ³•ã€‚

- **Entities** æ˜¯ä¸€ç§å®ä½“å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºä¸­çš„ä¸šåŠ¡å¯¹è±¡æˆ–é¢†åŸŸå¯¹è±¡ã€‚å®ƒé€šå¸¸ç”¨äºè¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨æˆ–æ–‡æ¡£ï¼Œæˆ–è€…è¡¨ç¤ºåº”ç”¨ç¨‹åºä¸­çš„ä¸šåŠ¡å¯¹è±¡ã€‚**Entities** çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†å°è£…ä¸šåŠ¡é€»è¾‘å’Œæ“ä½œæ–¹æ³•ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæ“ä½œå’Œå¤„ç†ã€‚

**ç¬¬äº”æ­¥**ï¼šåˆ›å»º `user.controller.ts`ï¼Œæ·»åŠ æ–°å¢ç”¨æˆ·çš„ `http` è¯·æ±‚æ–¹æ³•:

```ts
import { Controller, Post, Body, Query, Get } from '@nestjs/common';
import { UserService } from './user.service';
import { AddUserDto } from './user.dto';
import { ApiOperation, ApiTags } from '@nestjs/swagger';

@ApiTags('ç”¨æˆ·')
@Controller('user')
export class UserController {
  constructor(
    private readonly userService: UserService,
  ) { }

  @ApiOperation({
    summary: 'æ–°å¢ç”¨æˆ·',
  })
  @Post('/add')
  create(@Body() user: AddUserDto) {
    return this.userService.createOrSave(user);
  }
}
```

**ç¬¬å…­æ­¥**ï¼šåˆ›å»º `user.module.ts`ï¼Œå°† `controller`ã€`providers`ã€`service` ç­‰éƒ½å¼•å…¥åï¼Œ**åˆ‡è®°**å°† `user.module.ts` å¯¼å…¥ `app.module.ts` åæ‰ä¼šç”Ÿæ•ˆï¼Œè¿™ä¸€æ­¥åˆ«å¿˜è®°äº† :

```ts
import { Module } from '@nestjs/common';
import { DatabaseModule } from '@app/comm/database/database.module';
import { UserController } from './user.controller';
import { UserService } from './user.service';
import { UserProviders } from './user.providers';
import { FeishuController } from './feishu/feishu.controller';
import { FeishuService } from './feishu/feishu.service';

@Module({
  imports: [
    DatabaseModule
  ],
  controllers: [
    FeishuController,
    UserController
  ],
  providers: [...UserProviders, UserService, FeishuService],
  exports: [UserService],
})
export class UserModule { }
```

å®Œæˆä¸Šè¿°æ‰€æœ‰æ­¥éª¤ä¹‹åï¼Œæ­¤æ—¶æ‰“å¼€ `Swagger` æ–‡æ¡£å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»åˆ›å»ºå¥½äº† `/api/user/add` æ–°å¢ç”¨æˆ·çš„ `http` æ¥å£ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a2ab7e0c5f1468f93b1fe3a445b51eb~tplv-k3u1fbpfcp-watermark.image?)

ç‚¹å‡»æµ‹è¯•èƒ½æ­£å¸¸å¾—åˆ°å¦‚ä¸‹è¿”å›å€¼çš„è¯ï¼Œåˆ™ä»£è¡¨æ•°æ®æ’å…¥æˆåŠŸï¼ŒåŠŸèƒ½æ­£å¸¸ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f96c873a40a4c8da2c2a5570ae82945~tplv-k3u1fbpfcp-watermark.image?)

æŸ¥è¯¢æ•°æ®åº“æ‰€å¾—å¦‚ä¸‹æ‰€ç¤ºï¼š
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e76d5f54972a80440c0f61831a3~tplv-k3u1fbpfcp-watermark.image?)

## å†™åœ¨æœ€å

æœ¬ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•å°è£…ä¸€ä¸ªæ•°æ®åº“æ“ä½œç±»ï¼Œä¸ç›´æ¥ä½¿ç”¨ **NestJS** è‡ªå¸¦çš„ **TypeORM** å·¥å…·åº“ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬æ˜¯è‡ªå·±å°è£…äº†ä¸€å¥—ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯è‡ªå®šä¹‰ç¨‹åº¦ä¼šæ›´é«˜ï¼Œä½†ä¸ä¹‹è€Œæ¥å°±æ˜¯å¾ˆå¤šç‰¹æ€§æˆ‘ä»¬ä¹Ÿå°±æ— æ³•å†ä½¿ç”¨ï¼Œå¦‚æœæœ‰éœ€æ±‚çš„è¯å°±éœ€è¦è‡ªå·±é‡æ–°å¼€å‘ã€‚

å¦‚æœä¸å–œæ¬¢è‡ªå·±æŠ˜è…¾çš„è¯ï¼Œå¯ä»¥çœ‹ä¸‹ `@nestjs/typeorm` çš„ä½¿ç”¨ï¼Œç»“åˆ **NetsJS** çš„å®˜æ–¹æ–‡æ¡£ä¸Šæ‰‹ä¹Ÿä¸æ…¢ã€‚

ä½†å¯¹äºå°å†Œæ¥è¯´ï¼Œæˆ‘å¸Œæœ›å¸¦æ¥çš„æ˜¯ä¸ä¸€æ ·çš„è§†è§’ä¸å®æˆ˜çš„ç»éªŒè€Œä¸æ˜¯æ–‡æ¡£çš„è½¬è¿°ä¸è§£è¯»ï¼Œæœ‰ä¸€å®šè‡ªå­¦èƒ½åŠ›çš„åŒå­¦å…¶å®çœ‹æ–‡æ¡£ä¹Ÿå°±è¶³å¤Ÿäº†ã€‚

æ— è®ºé€‰æ‹©å“ªä¸€ç§æ–¹æ¡ˆï¼Œä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ•°æ®åº“å®æ“çš„ç›¸å…³å†…å®¹ã€‚

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘