ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸¤ç§è¯»å–å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼ï¼š`process.argv`å’Œç¬¬ä¸‰æ–¹åº“`command-line-args`ã€‚è¿™ä¸€èŠ‚è¯¾ï¼Œä¸ºäº†è®©ç¨‹åºå¯ä»¥å’Œç”¨æˆ·äº¤äº’ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä¸¤ç§å‘½ä»¤è¡Œäº¤äº’çš„æ–¹å¼ï¼š`process.stdin`å’Œ`readline`æ¨¡å—ã€‚

## ç”¨æˆ·çš„è¾“å…¥ä¸ç›‘å¬

åœ¨å‘½ä»¤è¡Œè¿è¡Œæ—¶ï¼Œé€šè¿‡ process æ¨¡å—çš„ stdin å¯¹è±¡å¯ä»¥è·å–ç”¨æˆ·è¾“å…¥ã€‚stdin æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¨¡å—ï¼Œå®ƒé€šè¿‡ç›‘å¬è¾“å…¥æ—¶é—´å¹¶æ‰§è¡Œå›è°ƒæ¥å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨æ–¹å¼å’Œä¹‹å‰é‚£äº›æ¨¡å—æœ‰äº›åŒºåˆ«ã€‚æˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ä½“ä¼šä¸‹å®ƒçš„ç”¨æ³•ã€‚

```js
console.log('è¯·è¾“å…¥ä¸€ä¸ªè¦æ±‚å’Œçš„æ•´æ•°ï¼Œä»¥0ç»“æŸè¾“å…¥');

process.stdin.setEncoding('utf8');

let sum = 0;
process.stdin.on('readable', () => {
  const chunk = process.stdin.read(); // è·å–å½“å‰è¾“å…¥çš„å­—ç¬¦ï¼ŒåŒ…å«å›è½¦
  const n = Number(chunk.slice(0, -1));
  sum += n;
  if(n === 0) process.stdin.emit('end');
  process.stdin.read(); // å†è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›çš„æ˜¯nullï¼Œå¹¶ç»§ç»­ç›‘å¬
});

process.stdin.on('end', () => {
  console.log(`æ±‚å’Œç»“æœæ˜¯ï¼š${sum}`);
});
```

ä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªç´¯åŠ æ±‚å’Œçš„äº¤äº’ç¨‹åºï¼Œä¾æ¬¡ç´¯åŠ ç”¨æˆ·è¾“å…¥çš„æ•°å€¼ï¼Œç›´åˆ°è¾“å…¥ 0 ä¸ºæ­¢ï¼Œç„¶åæ‰“å°ç´¯åŠ çš„ç»“æœã€‚å®ƒæ‰§è¡Œçš„æ•ˆæœå¦‚ä¸‹ï¼š

![](https://p4.ssl.qhimg.com/t01cd056009030ce833.jpg)

`process.stdin.setEncoding('utf8')`è¡¨ç¤ºå°†ç”¨æˆ·äº¤äº’çš„ç¼–ç è®¾å®šä¸º`utf-8`ï¼Œå¦‚æœä½ è¦è¾“å…¥ä¸­æ–‡ï¼Œè¿™ä¸ªå¿…é¡»è¦è®¾ç½®ã€‚

å½“ç”¨æˆ·è¾“å…¥å­—ç¬¦ä¸²å¹¶å›è½¦ï¼Œæ³¨å†Œåœ¨`process.stdin`å¯¹è±¡ä¸Šçš„`readable`äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚ç„¶åï¼Œåœ¨è¿™ä¸ªäº‹ä»¶å›è°ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`process.stdin.read()`è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°å­—ï¼ˆç”¨æˆ·çš„è¾“å…¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒè¿›è¡Œç±»å‹è½¬æ¢ï¼‰ã€‚æ³¨æ„ï¼Œåœ¨è¿™ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œå½“æˆ‘ä»¬å¯¹è¾“å…¥çš„æ•°å­—å®ŒæˆåŠ æ³•æ“ä½œåï¼Œæˆ‘ä»¬åˆè°ƒç”¨äº†ä¸€æ¬¡`process.stdin.read()`æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

è¿™æ˜¯å› ä¸º`process.stdin.read()`ä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–å†…å®¹ï¼Œå¦‚æœæœ‰å†…å®¹ï¼Œå°±ä¼šæŠŠè¯»åˆ°çš„å†…å®¹è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å†…å®¹ï¼Œåˆ™ä¼šè¿”å› nullï¼Œå¹¶ç»§ç»­å¤„äº`readable`çŠ¶æ€ï¼Œç›‘å¬ä¸‹ä¸€æ¬¡è¾“å…¥ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸åœ¨`readable`äº‹ä»¶å›è°ƒå‡½æ•°é‡Œå¤šè°ƒç”¨ä¸€æ¬¡`process.stdin.read()`ï¼Œå®ƒåªä¼šå°†è¯»åˆ°çš„å†…å®¹è¿”å›ï¼Œä¸ä¼šç»§ç»­ç›‘å¬ä¸‹ä¸€æ¬¡è¾“å…¥ã€‚

ç¬¬ä¸€æ¬¡è¯»å–å‡ºæ¥çš„å€¼æ˜¯ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²å’Œæœ«å°¾çš„å›è½¦ï¼Œæˆ‘ä»¬é€šè¿‡`chunk.slice(0, -1)`æŠŠæœ€åçš„å›è½¦ç¬¦æŠ›å¼ƒæ‰ï¼ŒæŠŠå‰é¢çš„å†…å®¹é€šè¿‡`Number`è½¬ä¸ºæ•°å€¼ï¼Œå°±æ‹¿åˆ°äº†æˆ‘ä»¬è¦çš„è¾“å…¥ç»“æœã€‚

å¦‚æœè¿™ä¸ªæ•°å€¼æ˜¯ 0ï¼Œæˆ‘ä»¬é€šè¿‡`process.stdin.emit('end')`æ´¾å‘ä¸€ä¸ªç»“æŸè¾“å…¥çš„äº‹ä»¶ï¼Œç„¶ååœ¨`process.stdin.on`ç›‘å¬`end`äº‹ä»¶ä¸­ï¼Œè¾“å‡ºæ±‚å’Œç»“æœã€‚`process.stdin`æ˜¯å¼‚æ­¥çš„ï¼Œå®ƒç»§æ‰¿`EventEmitter`å¯¹è±¡ï¼Œèƒ½å¤Ÿæ´¾å‘å’Œç›‘å¬äº‹ä»¶ã€‚å…³äºå¼‚æ­¥ç¼–ç¨‹å’ŒEventEmitterï¼Œåœ¨åç»­çš„è¯¾ç¨‹ä¸­ä¼šæœ‰è¯¦ç»†ä»‹ç»ã€‚

äº†è§£äº†`process.stdin`çš„ç”¨æ³•ä¹‹åï¼Œæˆ‘ä»¬å†ç”¨å®ƒæ¥å®ç°ç”¨æˆ·äº¤äº’è¿‡ç¨‹ã€‚

## å®ç°æ–‡ç« ç”Ÿæˆå™¨çš„äº¤äº’è¿‡ç¨‹

é¦–å…ˆï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªé—®é¢˜æ•°æ®ç»“æ„ï¼š

```js
[
  {text: 'è¯·è¾“å…¥æ–‡ç« ä¸»é¢˜', value: title},
  {text: 'è¯·è¾“å…¥æœ€å°å­—æ•°', value: 6000},
  {text: 'è¯·è¾“å…¥æœ€å¤§å­—æ•°', value: 10000},
]
```

å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº† 3 ä¸ªé—®é¢˜å¯¹è±¡ï¼Œå±æ€§ text æ˜¯é—®é¢˜çš„æ–‡å­—æè¿°ï¼Œvalue è¡¨ç¤ºé—®é¢˜çš„é»˜è®¤å€¼ã€‚ç„¶åæ ¹æ®é—®é¢˜ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ª interact.js çš„æ¨¡å—ï¼Œè®©å®ƒæ¥å—æˆ‘ä»¬å®šä¹‰å¥½çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·ä¸€ä¸€å›ç­”ï¼š

```js
// interact.js
export function interact(questions) {
  // questions æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå†…å®¹å¦‚ {text, value}
  process.stdin.setEncoding('utf8');

  return new Promise((resolve) => {
    const answers = [];
    let i = 0;
    let {text, value} = questions[i++];
    console.log(`${text}(${value})`);
    process.stdin.on('readable', () => {
      const chunk = process.stdin.read().slice(0, -1);
      answers.push(chunk || value); // ä¿å­˜ç”¨æˆ·çš„è¾“å…¥ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ç¼ºçœå€¼
      const nextQuestion = questions[i++];
      if(nextQuestion) { //å¦‚æœé—®é¢˜è¿˜æœªç»“æŸï¼Œç»§ç»­ç›‘å¬ç”¨æˆ·è¾“å…¥
        process.stdin.read();
        text = nextQuestion.text;
        value = nextQuestion.value;
        console.log(`${text}(${value})`);
      } else { // å¦‚æœé—®é¢˜ç»“æŸäº†ï¼Œç»“æŸreadableç›‘å¬äº‹ä»¶
        resolve(answers);
      }
    });
  });
}
```

å¦‚æœç”¨æˆ·å›ç­”äº†å½“å‰é—®é¢˜ï¼Œè¿˜æœ‰ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œå°±ç­‰å¾…ä¸‹ä¸€æ¬¡`readable`äº‹ä»¶ï¼Œå¦åˆ™å°±`resolve`å½“å‰çš„ promiseã€‚

ğŸ’¡æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨äº†å’Œä¸Šä¸€ä¸ªä¾‹å­ä¸ä¸€æ ·çš„ç»“æŸç›‘å¬æ–¹å¼ã€‚ä¸Šä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`process.stdin.emit('end')`å‘é€ä¸€ä¸ªç»“æŸäº‹ä»¶æ¥ç»“æŸ`readable`äº‹ä»¶çš„ç›‘å¬ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åˆ©ç”¨å¼‚æ­¥æœºåˆ¶â€”â€” Promise æ¥ç»“æŸç”¨æˆ·è¾“å…¥çš„ç›‘å¬äº‹ä»¶ã€‚

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`index.js`ä¸­ï¼Œé€šè¿‡`async/await`æ–¹å¼ï¼Œç­‰å¾…ç”¨æˆ·å›ç­”æ‰€æœ‰é—®é¢˜åï¼Œå†è¿›è¡Œæ–‡ç« ç”Ÿæˆçš„æ“ä½œï¼š

```js
const corpus = loadCorpus('corpus/data.json');
let title = options.title || createRandomPicker(corpus.title)();

(async function () {
  if(Object.keys(options).length <= 0) {
    const answers = await interact([
      {text: 'è¯·è¾“å…¥æ–‡ç« ä¸»é¢˜', value: title},
      {text: 'è¯·è¾“å…¥æœ€å°å­—æ•°', value: 6000},
      {text: 'è¯·è¾“å…¥æœ€å¤§å­—æ•°', value: 10000},
    ]);
    title = answers[0];
    options.min = answers[1];
    options.max = answers[2];
  }

  const article = generate(title, {corpus, ...options});
  const output = saveCorpus(title, article);

  console.log(`ç”ŸæˆæˆåŠŸï¼æ–‡ç« ä¿å­˜äºï¼š${output}`);
}());
```

![](https://p4.ssl.qhimg.com/t015e026b29951f7bba.jpg)

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ç”¨æˆ·äº’åŠ¨çš„æ–¹å¼å®Œæˆæ–‡ç« ç”Ÿæˆå™¨ã€‚

### process.stdout.write

é™¤äº†`process.stdin.read`ä¹‹å¤–ï¼Œå¯¹åº”çš„è¿˜æœ‰`process.stdout.write`å¯ä»¥å‘ç»ˆç«¯è¾“å‡ºå­—ç¬¦ï¼Œä¸è¿‡åœ¨è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç”¨åˆ°ã€‚è¿™æ˜¯å› ä¸ºï¼Œ`process.stdout.write`åœ¨å‘½ä»¤è¡Œç»ˆç«¯é‡Œæ•ˆæœåŸºæœ¬ä¸Šå’Œ`console.log`ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯`console.log`æ”¯æŒå¤šä¸ªå‚æ•°ï¼Œä¸”èƒ½å¤Ÿæ ¼å¼åŒ–å­—ç¬¦ä¸²å¹¶è‡ªåŠ¨è¾“å‡ºå›è½¦ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`console.log`åŸºæœ¬ä¸Šå¯ä»¥æ›¿ä»£`process.stdout.write`åŠŸèƒ½ä¸”æ›´å¼ºå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åŸºæœ¬ä¸Šä¸éœ€è¦ä½¿ç”¨`process.stdout.write`äº†ã€‚

ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›è¾“å‡ºå›è½¦æ¢è¡Œåˆ°ç»ˆç«¯ï¼Œé‚£è¿˜æ˜¯å¯ä»¥ä½¿ç”¨`process.stdout.write`çš„ã€‚

## ä½¿ç”¨ readline æ¨¡å—

ç”¨ process.stdin å®ç°å‘½ä»¤è¡Œäº¤äº’ï¼Œéœ€è¦åœ¨`readable`äº‹ä»¶ä¸­å¤šè°ƒä¸€æ¬¡`process.stdin.read()`æ–¹æ³•ï¼Œè¿™çœ‹èµ·æ¥ä¼¼ä¹å¾ˆå¥‡æ€ªï¼Œä»£ç çš„å¯è¯»æ€§ä¸é«˜ã€‚å¹¸å¥½ï¼Œnode.js ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¯” process.stdin æ›´å¥½ç”¨çš„å†…ç½®æ¨¡å—â€”â€” readlineï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨æ¥å®ç°å¯äº¤äº’å‘½ä»¤è¡Œçš„ã€‚

æˆ‘ä»¬ç”¨å®ƒæ¥æ”¹å†™ä¸€ä¸‹`interact.js`æ¨¡å—ï¼š

```js
import readline from 'readline';

function question(rl, {text, value}) {
  const q = `${text}(${value})\n`;
  return new Promise((resolve) => {
    rl.question(q, (answer) => {
      resolve(answer || value);
    });
  });
}

export async function interact(questions) {
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
  });
  const answers = [];
  for(let i = 0; i < questions.length; i++) {
    const q = questions[i];
    const answer = await question(rl, q); // ç­‰å¾…é—®é¢˜çš„è¾“å…¥
    answers.push(answer);
  }
  rl.close();
  return answers;
}
```

è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`readline.createInterface`åˆ›å»ºä¸€ä¸ªå¯äº¤äº’çš„å‘½ä»¤è¡Œå¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬éå†`questions`æ•°ç»„ï¼Œç­‰å¾…æ¯ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå¹¶å°†ç­”æ¡ˆå­˜æ”¾åœ¨`answers`æ•°ç»„ä¸­`readline.createInterface`è¿”å›çš„å¯¹è±¡æœ‰ä¸€ä¸ª`question`æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªé—®é¢˜æè¿°å’Œä¸€ä¸ªå›è°ƒå‡½æ•° â€”â€” ç”¨äºæ¥å—ç”¨æˆ·çš„è¾“å…¥ã€‚

æˆ‘ä»¬æ¯æ¬¡è¾“å‡ºä¸€ä¸ªæé—®å¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥ç­”æ¡ˆï¼Œæ‰€ä»¥å°†å®ƒå°è£…æˆä¸€ä¸ªè¿”å› Promise çš„å¼‚æ­¥æ–¹æ³•ï¼š

```js
function question(rl, {text, value}) {
  const q = `${text}(${value})\n`;
  return new Promise((resolve) => {
    rl.question(q, (answer) => {
      resolve(answer || value);
    });
  });
}
```

è¿™ä¹ˆå†™çš„è¯ï¼Œä»£ç é‡è™½ç„¶å’Œç›´æ¥ä½¿ç”¨`process.stdin`å·®ä¸å¤šï¼Œä½†å¯è¯»æ€§è¦å¥½å¾ˆå¤šã€‚

## æ€»ç»“

è¿™ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»‹ç»äº† process.stdin å’Œ readline æ¨¡å—çš„ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬çš„æ–‡ç« ç”Ÿæˆå™¨åº”ç”¨å®ç°äº†äº¤äº’å¼çš„å‘½ä»¤è¡ŒåŠŸèƒ½ã€‚

process æ¨¡å—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å†…ç½®æ¨¡å—ï¼Œæˆ‘ä»¬å­¦å®Œäº† process çš„ argvã€stdin å’Œ stdout çš„åŸºæœ¬ç”¨æ³•ã€‚åœ¨åç»­çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šç»§ç»­ç”¨åˆ°è¿™äº› APIï¼Œä»¥åŠ process æ¨¡å—çš„å…¶ä»– APIã€‚

readline æ¨¡å—æ˜¯ç”¨æ¥å®ç°äº¤äº’å¼å‘½ä»¤è¡Œçš„ï¼Œå¯¹äºç¼–å†™éœ€è¦åœ¨ç»ˆç«¯ä¸ç”¨æˆ·äº¤äº’çš„ JavaScript åº”ç”¨æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œåœ¨åç»­å·¥ç¨‹åŒ–ä¸»é¢˜é‡Œï¼Œæˆ‘ä»¬è¿˜ä¼šä½¿ç”¨å®ƒæ¥å®ç°ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„é¡¹ç›®è„šæ‰‹æ¶ã€‚

è‡³äº process å’Œ readline æ¨¡å—çš„å…¶ä»–å†…å®¹ï¼Œå¦‚æœä½ æœ‰å…´è¶£å¯ä»¥æŸ¥çœ‹ [Node.js å®˜æ–¹æ–‡æ¡£](https://nodejs.org/dist/latest-v13.x/docs/api)ã€‚

åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„æ–‡ç« ç”Ÿæˆå™¨åŠŸèƒ½å°±å…¨éƒ¨å®ç°äº†ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä½¿ç”¨äº†`ES Modules`ã€‚ä½¿ç”¨è¿™ä¸ªæ–°çš„è§„èŒƒæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­åŠ è½½å¹¶ä½¿ç”¨åŒæ ·çš„æ¨¡å—ï¼Œå› ä¸ºæœ€æ–°çš„Chromeæµè§ˆå™¨å·²ç»æ”¯æŒäº†`ES Modules`è§„èŒƒã€‚

åœ¨ä¸‹ä¸€èŠ‚è¯¾ä¸­ï¼ˆåŠ é¤éƒ¨åˆ†ï¼‰ï¼Œæˆ‘ä»¬å°†æš‚æ—¶åç¦»ä¸€ä¸‹ Node.js çš„ä¸»é¢˜ï¼Œæ¥çœ‹çœ‹å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­å¤ç”¨æˆ‘ä»¬å†™çš„ä»£ç ï¼Œç»™è¿™ä¸ªåº”ç”¨æ·»åŠ ä¸€ä¸ªç½‘é¡µç‰ˆã€‚
