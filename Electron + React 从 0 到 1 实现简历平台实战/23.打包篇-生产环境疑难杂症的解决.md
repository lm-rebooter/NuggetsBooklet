## å‰è¨€

ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºæ‰“åŒ…æ„å»ºæ•´å®Œäº†ï¼Œå¥½åƒçœ‹èµ·æ¥æ²¡å•¥é—®é¢˜äº†ï¼Œå¹¶éå¦‚æ­¤ï¼Œè¿˜æ˜¯å­˜åœ¨è®¸å¤šçš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç»§ç»­å¡«å‘äº†ã€‚å¦‚æœä½ å¯¹æœ¬ç« èŠ‚å†…å®¹å…´è¶£ä¸å¤§ï¼Œå¯ä»¥å¿«é€Ÿé˜…è¯»æˆ–è·³è¿‡ã€‚

## ğŸ”¨ å‘ä¸€ï¼šå¼€å‘ç¯å¢ƒå‡‰äº†

æˆ‘ä»¬ä»¥ [chapter-22-build](https://github.com/PDKSophia/visResumeMook/tree/chapter-22-build) åˆ†æ”¯ä»£ç ï¼Œç»§ç»­å¾€ä¸‹å¼€å‘ï¼Œè®©æˆ‘ä»¬å…ˆå»å¼€å‘ç¯å¢ƒè¯•è¯•å§

```js
// ğŸ‘‡ è®°ä½ï¼Œåœ¨è¿›å…¥å¼€å‘ç¯å¢ƒæ—¶ï¼Œå…ˆå°† dist ç›®å½•åˆ é™¤
// å› ä¸ºæˆ‘ä»¬å¸¸è§„å¼€å‘æ—¶ï¼Œæ˜¯ä¸ä¼šå» build dist ç›®å½•çš„
rm -rf dist
npm run start:main
npm run start:render
```

æ­¤æ—¶çœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆé—®é¢˜

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/373cf1fc661b4f3c85d26830c89e4751~tplv-k3u1fbpfcp-watermark.image)

ç›´æ¥æŠ¥é”™äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ `webpack-dev-server` èµ·äº†ä¸€ä¸ªæœ¬åœ°æœåŠ¡

```js
devServer: {
  contentBase: path.join(__dirname, '../dist'),
  compress: true,
  host: '127.0.0.1',
  port: 7001, // å¯åŠ¨ç«¯å£ä¸º 7001 çš„æœåŠ¡
  hot: true,
}
```

åœ¨ç»ˆç«¯ä¸­æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°è¾“å‡ºçš„ä¸€äº›ç›¸å…³ä¿¡æ¯

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ec6987979f44893b3201077056236ff~tplv-k3u1fbpfcp-watermark.image)

> `webpack-dev-server` ä¸»è¦æ˜¯å¯åŠ¨äº†ä¸€ä¸ª express çš„ HTTP æœåŠ¡å™¨ï¼Œå½“åŸå§‹æ–‡ä»¶å‘ç”Ÿæ”¹å˜ä¹‹åï¼Œ`webpack-dev-server` ä¼šå®æ—¶ç¼–è¯‘ï¼Œä½†è¯·æ³¨æ„ï¼Œâš ï¸ å¯åŠ¨äº† webpack-dev-server åï¼Œdist ç›®å½•æ˜¯çœ‹ä¸åˆ°ç¼–è¯‘åçš„æ–‡ä»¶,å®æ—¶ç¼–è¯‘åçš„æ–‡ä»¶éƒ½ä¿å­˜åˆ°äº†å†…å­˜å½“ä¸­ã€‚æ‰€ä»¥ä½ è·‘å» dist ç›®å½•ä¸‹æ‰¾ï¼Œæ˜¯æ‰¾ä¸åˆ°ç¼–è¯‘åçš„æ–‡ä»¶çš„ã€‚

æŒ‰é“ç†æ¥è®²ï¼Œæˆ‘ä»¬è®¿é—® `dist` ç›®å½•ä¸‹çš„ `assets/template`ã€`appConfig` éƒ½åº”è¯¥èƒ½è¯»åˆ°æ•°æ®çš„ã€‚é‚£ä¸ºä»€ä¹ˆä¼šè¯´æ‰¾ä¸åˆ°æ–‡ä»¶å¤¹å‘¢ï¼Ÿ

ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å°±æ˜¯æ–‡ä»¶å¤¹æ‹·è´é—®é¢˜ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ `webpack/webpack.render.base.js`ï¼Œè¯¥é…ç½®ä¸‹ï¼Œç”Ÿäº§æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†åœ¨å¼€å‘ç¯å¢ƒ `dev-server` ä¸­å­˜åœ¨é—®é¢˜ã€‚æœ‰æ²¡æœ‰å¯èƒ½æ˜¯è¯¥æ’ä»¶ï¼Œä¸æ”¯æŒ `dev-server`ï¼Œæˆ‘ä»¬å‰å¾€å®˜ç½‘æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰ç›¸å…³ issuesï¼Œè¿˜çœŸæ‰¾åˆ°ä¸€ä¸ª ğŸ‘‰ [Does not copy files to actual output folder when webpack-dev-server is used](https://github.com/webpack-contrib/copy-webpack-plugin/issues/29)

ä¸€åœˆæ‰«è¡ä¸‹æ¥ï¼Œå¤§éƒ¨åˆ†çš„å›ç­”æ˜¯ 2016 å¹´ã€2017 å¹´ï¼Œè¿˜æœ‰è¯´éœ€è¦é™ç‰ˆæœ¬çš„ã€‚è¿™æ–¹æ¡ˆè‚¯å®šä¸å¾—è¡Œï¼Œå›æƒ³ä¸€ä¸‹ï¼Œå¥½åƒæ²¡æ‰“åŒ…æ„å»ºä¹‹å‰ï¼Œéƒ½èƒ½æ­£å¸¸ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè·å–åº”ç”¨è·¯å¾„è¢«æˆ‘ä»¬ä¿®æ”¹ã€‚

```ts
// åŸæ¥å¼€å‘ç¯å¢ƒèƒ½æ­£å¸¸çš„åº”ç”¨è·¯å¾„
const ROOT_PATH = path.join(app.getAppPath(), '../');
ipcMain.on('get-root-path', (event, arg) => {
  event.reply('reply-root-path', ROOT_PATH);
});

// æ‰“åŒ…æ„å»ºæ—¶ï¼Œæˆ‘ä»¬å°†åº”ç”¨è·¯å¾„æ”¹æˆè¿™æ ·
ipcMain.on('get-root-path', (event, arg) => {
  event.reply('reply-root-path', __dirname);
});
```

ä¸Šé¢çš„è·¯å¾„æˆ‘ä»¬èƒ½åœ¨å¼€å‘ç¯å¢ƒä¸‹æ­£å¸¸ï¼Œç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜ã€‚ä¸‹é¢çš„è·¯å¾„åœ¨å¼€å‘ç¯å¢ƒä¸Šå‡ºç°é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹æ­£å¸¸ã€‚

é‚£å°±ä¸¤è€…ç»“åˆï¼Œå„è´Ÿè´£å„çš„ï¼Œæˆ‘ä»¬å°†ä»£ç æ”¹é€ ä¸€ä¸‹ï¼Œå‰å¾€ `app/main/electron.ts` è¿›è¡Œä¿®æ”¹

```ts
// app/main/electron.ts

const ROOT_PATH = path.join(app.getAppPath(), '../');
ipcMain.on('get-root-path', (event, arg) => {
  event.reply('reply-root-path', isDev() ? ROOT_PATH : __dirname);
});
```

è®©æˆ‘ä»¬é‡æ–°è·‘ä¸€ä¸‹å¼€å‘ç¯å¢ƒçš„å‘½ä»¤å§

```
rm -rf dist
npm run start:main
npm run start:render
```

è¿™æ—¶å€™æ˜¯æ­£å¸¸æ— é—®é¢˜çš„ã€‚é‚£ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ„å»ºä¼šä¸ä¼šæœ‰é—®é¢˜å‘¢ï¼Ÿèµ°ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
npm run dist
```

å®‰è£…ä¸€ä¸‹ï¼Œç»è¿‡éªŒè¯ï¼Œå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå‡æ— é—®é¢˜ï¼

## ğŸ”¨ å‘äºŒï¼šåˆ‡æ¢ä¸»é¢˜ï¼Œæ•°æ®æ— æ³•å†™å…¥ theme.config.json

ç»§ä¸Šè¿°æ‰“åŒ…æ„å»ºä¹‹åï¼Œå®‰è£…åº”ç”¨ï¼Œæ­¤æ—¶é€‰æ‹©åˆ‡æ¢ä¸»é¢˜ï¼ŒæŒ‰é“ç†æ¥è®²ï¼Œåº”å½“å­˜å…¥ `theme.config.json` æ–‡ä»¶ï¼Œå´å¾—åˆ°å¼‚å¸¸æŠ¥é”™ï¼Œå¦‚ä¸‹å›¾

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5802ae210c946e0b54e87d558a6f247~tplv-k3u1fbpfcp-watermark.image)

å¤§å®¶çŒœä¸€çŒœï¼Œæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿå¾ˆç®€å•ï¼Œelectron ä¸å…è®¸ä½ å¯¹æ‰“åŒ…ä¹‹åçš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œä»”ç»†æƒ³æƒ³ï¼Œè¿™ä¹Ÿæ­£å¸¸ï¼Œä½ è¯´åƒå¾®ä¿¡ã€QQ è¿™ç§åº”ç”¨å®‰è£…åŒ…ï¼Œå®ƒä¼šå…è®¸ä½ ä¿®æ”¹æºä»£ç æ–‡ä»¶ï¼ŸåŒæ ·çš„ï¼Œæˆ‘ä»¬å¯¹æ‰“åŒ…æ„å»ºä¹‹åçš„ `dist/appConfig` ç›®å½•è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œé‚£è‚¯å®šæ˜¯æ— æƒé™ã€ä¸è¢«å…è®¸çš„ã€‚

è¿™é‡Œæˆ‘ç»™å¤§å®¶æŒ–äº†ä¸€ä¸ªå‘ï¼Œè§£é“ƒè¿˜é¡»ç³»é“ƒäººï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥å¡«å¡«å‘ï½ æ—¢ç„¶å¯¹äºæ‰“åŒ…æ„å»ºä¹‹åçš„æ–‡ä»¶éƒ½ä¸èƒ½åšå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä½†æˆ‘ä»¬ç¡®å®æœ‰æ­¤éœ€æ±‚ï¼Œè¯¥å¦‚ä½•å®ç°ï¼Ÿåœ¨ Electron ä¸­ï¼Œå¯ä»¥é€šè¿‡ [app.getPath](https://www.electronjs.org/docs/api/app#appgetpathname) å»å­˜å‚¨æ•°æ®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ–‡æ¡£å¦‚ä½•è¯´çš„

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c966416892394673abe906b8918fcaae~tplv-k3u1fbpfcp-watermark.image)

ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ `app.getPath()` APIï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç”¨æˆ·åœ¨æœ¬è®¾å¤‡ä¸Šçš„ä¸€äº›è·¯å¾„ï¼Œæ¯”å¦‚ `userData` åº”ç”¨ç¨‹åºè®¾ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œä»è€Œè¿›è¡Œæ•°æ®çš„å­˜å‚¨ï¼Œè¿™æ˜¯ä¸€æ¬¡å¤§æ”¹åŠ¨ï¼Œé‰´äºæ­¤æ¬¡æ”¹åŠ¨é‡æœ‰ç‚¹å¤§ï¼Œä¸€å®šè¦è®¤çœŸçœ‹

- ç¬¬ä¸€æ­¥ï¼šåœ¨ `app/main` ç›®å½•ä¸‹æ·»åŠ  `userData`ï¼Œä¸‹é¢çœ‹ä»£ç æ³¨é‡Š

```ts
import { app, ipcMain } from 'electron';
import path from 'path';
import fileAction from '@common/utils/file';

// ğŸ‘‡ 1. å¾—åˆ°åº”ç”¨ç¨‹åºè®¾ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œç„¶åæŸ¥çœ‹ appConfig ç›®å½•
const appConfigPath = path.resolve(app.getPath('userData'), 'appConfig');

// ğŸ‘‡ 2 appConfig æ–‡ä»¶å¤¹æ˜¯å¦å¯è¯»
fileAction
  .canRead(appConfigPath)
  .then(() => {
    // ğŸ‘‡ 2.1 appConfig å¯è¯»æƒ…å†µä¸‹ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ theme.config.json
    fileAction.hasFile(`${appConfigPath}/theme.config.json`).catch(() => {
      // 2.1.1 ä¸å­˜åœ¨åˆ™é»˜è®¤åˆ›å»º
      createThemeConfigJson();
    });
    // ğŸ‘‡ 2.2  appConfig å¯è¯»æƒ…å†µä¸‹ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ global.config.json
    fileAction.hasFile(`${appConfigPath}/global.config.json`).catch(() => {
      // 2.2.1 ä¸å­˜åœ¨åˆ™é»˜è®¤åˆ›å»º
      createGlobalConfigJson();
    });
  })
  .catch(() => {
    // ğŸ‘‡ 2.3 appConfig æ–‡ä»¶å¤¹ä¸å¯è¯»ï¼Œè¯´æ˜ä¸å­˜åœ¨æ­¤æ–‡ä»¶å¤¹ï¼Œåˆ™æ–°å¢æ–‡ä»¶å¤¹
    fileAction.mkdirDir(appConfigPath).then(() => {
      // 2.3.1 å¹¶é»˜è®¤åˆ›å»ºæ–‡ä»¶
      createThemeConfigJson();
      createGlobalConfigJson();
    });
  });

// åˆ›å»ºé»˜è®¤ theme.config.json
const createThemeConfigJson = () => {
  fileAction?.write(
    `${appConfigPath}/theme.config.json`,
    {
      name: 'ä¸»é¢˜é…ç½®è¡¨',
      currentTheme: {
        id: 'green',
        fontColor: '#ffffff',
        backgroundColor: '#416f5b',
      },
      themeList: [
        { id: 'dark', fontColor: '#ffffff', backgroundColor: '#27292c' },
        { id: 'blue', fontColor: '#ffffff', backgroundColor: '#35495e' },
        { id: 'green', fontColor: '#ffffff', backgroundColor: '#416f5b' },
        { id: 'purple', fontColor: '#ffffff', backgroundColor: '#54546c' },
        { id: 'princess', fontColor: '#ffffff', backgroundColor: '#945454' },
      ],
    },
    'utf8'
  );
};

// åˆ›å»ºé»˜è®¤ global.config.json
const createGlobalConfigJson = () => {
  fileAction?.write(
    `${appConfigPath}/global.config.json`,
    { name: 'å…¨å±€é…ç½®è¡¨', resumeSavePath: '' },
    'utf8'
  );
};

// ğŸ‘‡ å“åº”æ¸²æŸ“è¿›ç¨‹æƒ³å¾—åˆ°çš„ userData è·¯å¾„ï¼Œå› ä¸º app æ¨¡å—åªèƒ½åœ¨ä¸»è¿›ç¨‹ä¸­ä½¿ç”¨
ipcMain.on('Electron:get-userData-path', (event, arg) => {
  event.reply('Electron:reply-userData-path', app.getPath('userData'));
});
```

ç”±äºæ­¤æ–‡ä»¶ä¸­æˆ‘ä»¬ç”¨åˆ°äº† `@common/utils/file` åˆ«åè·¯å¾„ï¼Œæ‰€æœ‰éœ€è¦åœ¨ä¸»è¿›ç¨‹çš„ webpack åšä¸€äº›åˆ«åé…ç½®ï¼Œæˆ‘ä»¬ä¿®æ”¹ `webpack/webpack.main.base.js`ï¼Œéƒ¨åˆ†ä»£ç çœç•¥

```js
module.exports = {
  resolve: {
    alias: {
      '@common': path.join(__dirname, '../', 'app/renderer/common'),
    },
  },
};
```

- ç¬¬äºŒæ­¥ï¼šå¼•å…¥ `userData` æ–‡ä»¶

æˆ‘ä»¬åœ¨ä¸»è¿›ç¨‹ä¸­å¼•å…¥æ­¤æ–‡ä»¶ï¼Œä¿®æ”¹ `app/main/electron.ts`

```ts
// å°†æ­¤æ–‡ä»¶å¼•å…¥
import './userData';
```

- ç¬¬ä¸‰æ­¥ï¼šå‰å¾€ `app/renderer/common/utils/appPath.ts` ä¸‹ï¼Œæ·»åŠ æ–°çš„æ–¹æ³•

æ·»åŠ æ–°çš„è·å– userData è·¯å¾„æ–¹æ³•

```ts
/**
 * @description è·å–åº”ç”¨ useData è·¯å¾„
 * @returns {Promise<string>}
 */
export function getUserStoreDataPath(): Promise<string> {
  return new Promise(
    (resolve: (value: string) => void, reject: (value: Error) => void) => {
      ipcRenderer.send('Electron:get-userData-path', '');
      ipcRenderer.on('Electron:reply-userData-path', (event, arg: string) => {
        if (arg) {
          resolve(arg);
        } else {
          reject(new Error('é¡¹ç›®è·¯å¾„é”™è¯¯'));
        }
      });
    }
  );
}
```

- ç¬¬å››æ­¥ï¼šå°†æ¶‰åŠåˆ° appConfig çš„æ–‡ä»¶éƒ½è¿›è¡Œä¿®æ”¹

æˆ‘ä»¬å» `app/renderer/hooks` ä¸‹ï¼Œæ‰¾åˆ° `useThemeActionHooks.ts` æ–‡ä»¶ä¿®æ”¹ï¼Œä¸‹è¾¹ä¸ºä¼ªä»£ç 

```ts
// app/renderer/hooks/useThemeActionHooks.ts

// ğŸ‘‡ ä¿®æ”¹æˆè·å– userData è·¯å¾„çš„æ–¹æ³•
import { getUserStoreDataPath } from '@common/utils/appPath';

/**
 * @description è¯»å–é…ç½®æ–‡ä»¶çš„å†…å®¹
 */
function useReadAppConfigThemeFile() {
  return () => {
    return new Promise((resolve: (values: { [key: string]: any }) => void, reject: (value: Error) => void) => {
      // ğŸ‘‡ è¿™é‡Œæ”¹ä¸€ä¸‹æ–¹æ³•å
      getUserStoreDataPath().then((appPath: string) => {
        // ...
      });
    });
  };
}

/**
 * @description æ›´æ–°é…ç½®è¡¨ä¸­çš„ç”¨æˆ·è®¾ç½®ä¿¡æ¯
 * @param {string} updateKey é”®
 * @param {any} updateValues å€¼
 * @param {function} callback å›è°ƒå‡½æ•°
 */
function useUpdateAppConfigThemeFile() {
  const readAppConfigThemeFile = useReadAppConfigThemeFile();
  return (updateKey: string, updateValues: any, callback?: () => void) => {
    // ğŸ‘‡ è¿™é‡Œæ”¹ä¸€ä¸‹æ–¹æ³•å
    getUserStoreDataPath().then((appPath: string) => {
      // ...
    });
  };
}
```

æˆ‘ä»¬å†å» `app/renderer/hooks` ä¸‹ï¼Œæ‰¾åˆ° `useGlobalConfigActionHooks.ts` æ–‡ä»¶ä¿®æ”¹ï¼Œä¸‹è¾¹ä¸ºä¼ªä»£ç 

```ts
// app/renderer/hooks/useGlobalConfigActionHooks.ts

// ğŸ‘‡ ä¿®æ”¹æˆè·å– userData è·¯å¾„çš„æ–¹æ³•
import { getUserStoreDataPath } from '@common/utils/appPath';

/**
 * @description è¯»å–å…¨å±€é…ç½®æ–‡ä»¶çš„å†…å®¹
 */
export function useReadGlobalConfigFile() {
  return () => {
    return new Promise((resolve: (values: { [key: string]: any }) => void, reject: (value: Error) => void) => {
      // ğŸ‘‡ è¿™é‡Œæ”¹ä¸€ä¸‹æ–¹æ³•å
      getUserStoreDataPath().then((appPath: string) => {
        // ...
      });
    });
  };
}

/**
 * @description è¯»å–é…ç½®æ–‡ä»¶çš„å†…å®¹
 * @param {string} updateKey é”®
 * @param {any} updateValues å€¼
 * @param {function} callback å›è°ƒå‡½æ•°
 */
export function useUpdateGlobalConfigFile() {
  const readGlobalConfigFile = useReadGlobalConfigFile();
  return (updateKey: string, updateValues: any, callback?: () => void) => {
    // ğŸ‘‡ è¿™é‡Œæ”¹ä¸€ä¸‹æ–¹æ³•å
    getUserStoreDataPath().then((appPath: string) => {
      // ...
    });
  };
}
```

è¿™è¾¹è¿˜éœ€è¦å¯¹åº”ç”¨è®¾ç½®çª—å£åˆå§‹åŒ–å­˜å‚¨è·¯å¾„åšä¸€ä¸‹ä¿®æ”¹ï¼Œå‰å¾€ `renderer/windowPages/setting`ï¼Œä¿®æ”¹ä¸€ä¸‹ index.tsx ä»£ç ï¼Œéƒ¨åˆ†ä»£ç çœç•¥

```ts
// app/renderer/windowPages/setting/index.tsx

// ğŸ‘‡ ä¿®æ”¹æˆè·å– userData è·¯å¾„çš„æ–¹æ³•
import { getUserStoreDataPath } from '@common/utils/appPath';

function Setting() {
  useEffect(() => {
    // ğŸ‘‡ è¯»å–é…ç½®æ–‡ä»¶å†…å®¹
    readGlobalConfigFile().then((value: { [key: string]: any }) => {
      // å¦‚æœå­˜åœ¨åº”ç”¨å­˜å‚¨è·¯å¾„ï¼Œåˆ™é‡‡ç”¨
      if (value?.resumeSavePath) {
        setResumeSavePath(value?.resumeSavePath);
      } else {
        // å¦åˆ™è·å– userData è·¯å¾„ï¼Œä»¥ userData è·¯å¾„ä¸ºå‡†
        // æ›´æ–° global.config.json ä¸­çš„åº”ç”¨å­˜å‚¨è·¯å¾„å­—æ®µ
        getUserStoreDataPath().then((appPath: string) => {
          setResumeSavePath(`${appPath}/resumeCache`);
          updateGlobalConfigFile('resumeSavePath', `${appPath}/resumeCache`);
        });
      }
    });
  }, []);
}
```

æˆ‘ä»¬å‰é¢è®²åˆ°ï¼Œåœ¨å¯¼å‡º PDF æ—¶ï¼Œæ˜¯é€šè¿‡è¯»å– `global.config.json` ä¸­çš„ `resumeSavePath` å­—æ®µï¼Œä»¥æ­¤è·¯å¾„ï¼Œå°†æˆ‘ä»¬çš„ç®€å†æ•°æ®æ–‡ä»¶å†™å…¥è¯¥è·¯å¾„ä¸‹çš„æ–‡ä»¶å¤¹ã€‚

é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹åº”åšä¸‹ä¿®æ”¹ï¼Œå‰å¾€ `renderer/container/resume/ResumeAction`ï¼Œä¿®æ”¹ä¸€ä¸‹ index.tsx ä»£ç ï¼Œéƒ¨åˆ†ä»£ç çœç•¥

```ts
// app/renderer/container/resume/ResumeAction/index.tsx

// ğŸ‘‡ ä¿®æ”¹æˆè·å– userData è·¯å¾„çš„æ–¹æ³•
import { getUserStoreDataPath } from '@common/utils/appPath';

// å¯¼å‡ºPDF
const exportPdf = () => {
  toPrintPdf(`${base?.username}+${base?.school}+${work?.job}`);
  setComponentVisible(false);
  readGlobalConfigFile().then((value: { [key: string]: any }) => {
    // å¦‚æœå­˜åœ¨ï¼Œä»¥æ­¤è·¯å¾„è¿›è¡Œç®€å†æ•°æ®æ–‡ä»¶çš„å†™å…¥
    if (value?.resumeSavePath) {
      saveResumeJson(value?.resumeSavePath);
    } else {
      // ä¸å­˜åœ¨é»˜è®¤è·¯å¾„ï¼ˆå¯èƒ½éƒ½æ²¡æ‰“å¼€è¿‡åº”ç”¨è®¾ç½®çª—å£ï¼‰
      // åˆ™è®¾ç½®é»˜è®¤è·¯å¾„å¹¶æ›´æ–°æ–‡ä»¶å†…å®¹
      getUserStoreDataPath().then((appPath: string) => {
        updateGlobalConfigFile('resumeSavePath', `${appPath}/resumeCache`);
        saveResumeJson(`${appPath}/resumeCache`);
      });
    }
  });
};

// å­˜å‚¨æ•°æ®json
const saveResumeJson = (resumeSavePath: string) => {
  const date = intToDateString(new Date().valueOf(), '_');
  const prefix = `${date}_${base?.username}_${base?.school}_${work?.job}_${createUID()}.json`;
  // å¦‚æœè·¯å¾„ä¸­ä¸å­˜åœ¨ resumeCache æ–‡ä»¶å¤¹ï¼Œåˆ™é»˜è®¤åˆ›å»ºæ­¤æ–‡ä»¶å¤¹
  if (resumeSavePath && resumeSavePath.search('resumeCache') > -1) {
    fileAction
      .canRead(resumeSavePath)
      .then(() => {
        fileAction?.write(`${resumeSavePath}/${prefix}`, resume, 'utf8');
      })
      .catch(() => {
        fileAction
          .mkdirDir(resumeSavePath)
          .then(() => {
            fileAction?.write(`${resumeSavePath}/${prefix}`, resume, 'utf8');
          })
          .catch(() => {
            console.log('åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥');
          });
      });
  } else {
    fileAction
      .mkdirDir(`${resumeSavePath}/resumeCache`)
      .then(() => {
        fileAction?.write(
          `${resumeSavePath}/resumeCache/${prefix}`,
          resume,
          'utf8'
        );
      })
      .catch(() => {
        console.log('åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥');
      });
  }
};
```

- ç¬¬äº”æ­¥ï¼šåˆ é™¤ `appConfig` æ–‡ä»¶å¤¹

å› ä¸ºæˆ‘ä»¬ç°åœ¨çš„ appConfig æ–‡ä»¶å¤¹æ˜¯å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºè®¾ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ é™¤ã€‚

- ç¬¬å…­æ­¥ï¼šä¿®æ”¹æ‹·è´æ–‡ä»¶å¤¹çš„ä»£ç 

å› ä¸ºæœ¬åœ°æ²¡æœ‰äº† appConfig æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥ `copy-webpack-plugin` é…ç½®ä¹Ÿéœ€è¦åšä¸‹ä¿®æ”¹ã€‚æˆ‘ä»¬å‰å¾€ `webpack/webpack.render.base.js` åšä¸‹æ›´æ”¹

```js
// webpack/webpack.render.base.js

const path = require('path');
const CopyWebpackPlugin = require('copy-webpack-plugin');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  plugins: [
    new CopyWebpackPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, '../assets'),
          to: path.resolve(__dirname, '../dist/assets'),
        },
        // ğŸ‘‡ æ–‡ä»¶å¤¹éƒ½ä¸å­˜åœ¨äº†ï¼Œè¿˜æ‹·è´å•¥å•Š
        // {
        //   from: path.resolve(__dirname, '../appConfig'),
        //   to: path.resolve(__dirname, '../dist/appConfig'),
        // },
      ],
    }),
  ],
};
```

æˆ‘ä»¬é‡æ–°è·‘ä¸€ä¸‹å¼€å‘ç¯å¢ƒçš„å‘½ä»¤ï¼Œç„¶åè¿›è¡Œåˆ°åˆ¶å®šçš„ userData æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰¾åˆ° `Electron` æ–‡ä»¶å¤¹ï¼Œçœ‹çœ‹åº”ç”¨å¯åŠ¨ä¹‹åï¼Œä¼šä¸ä¼šç”Ÿæˆå¯¹åº”çš„ `appConfig`ï¼Œå¹¶æºå¸¦ `theme.config.json` å’Œ `global.config.json` æ–‡ä»¶

```
rm -rf dist
npm run start:main
npm run start:render
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac337d29e1894416b2404e09ddb6e54e~tplv-k3u1fbpfcp-watermark.image)

ç»è¿‡éªŒè¯ï¼Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œå°ä¼™ä¼´ä»¬è®°ä½äº†ï¼Œè¿™æ˜¯ userData çš„è·¯å¾„ï¼Œæ ¹æ®ä½ çš„å¹³å°è®¾å¤‡ï¼Œè¿›å…¥å¯¹åº”çš„è·¯å¾„

- `appData`Â  æ¯ä¸ªç”¨æˆ·çš„åº”ç”¨ç¨‹åºæ•°æ®ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹æŒ‡å‘ï¼š
  - `%APPDATA%`Â Windows ä¸­
  - `$XDG_CONFIG_HOME`Â orÂ `~/.config`Â Linux ä¸­
  - `~/Library/Application Support`Â macOS ä¸­

ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ„å»ºä¼šä¸ä¼šæœ‰é—®é¢˜å‘¢ï¼Ÿèµ°ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
npm run dist
```

æ‰“åŒ…ä¹‹åï¼Œå®‰è£…ä¸€ä¸‹ï¼Œæ‰“å¼€åº”ç”¨ï¼Œåœ¨åº”ç”¨å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬è¿›å…¥åˆ° userData è·¯å¾„ï¼Œè¯·æ³¨æ„ï¼Œæ­¤æ—¶æ‰“åŒ…åçš„åº”ç”¨ç¨‹åºåç§°æ˜¯ `visResumeMook`ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d71bb5dcc9d4f2887a520cb21bae646~tplv-k3u1fbpfcp-watermark.image)

å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå‡æ— é—®é¢˜ï¼

> è¿™æ—¶å€™å‘ä¸€è‡ªç„¶è€Œç„¶ä¹Ÿå°±æ²¡äº†ï¼Œé¡¹ç›®ä¸­çš„ `appConfig` éƒ½åˆ äº†ï¼Œå“ªè¿˜ä¼šæœ‰æ‹·è´å¤±è´¥çš„é—®é¢˜å‘¢ï¼Ÿ

### ğŸ”¨ å‘ä¸‰ï¼šåˆ‡æ¢ä¸»é¢˜ï¼Œä¸‹æ¬¡è¿›å…¥å±…ç„¶ä¸æ˜¯ä¸Šä¸€è½®çš„

æ¯æ¬¡æ‰“å¼€åº”ç”¨ï¼Œä½ ä¼šå‘ç°ä¸»é¢˜è‰²éƒ½æ˜¯é»‘è‰²ï¼Œå¹¶ä¸æ˜¯æˆ‘æ‰€æœŸæœ›çš„ä¸Šä¸€è½®é…è‰²ã€‚é‚£ä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ `app/renderer/hooks` ä¸‹çš„ `/useThemeActionHooks.ts` æ–‡ä»¶ä»£ç ã€‚

```ts
function useSelectTheme() {
  const dispatch = useDispatch();
  return (themeConfigValues: any) => {
    // ğŸ‘‡ åœ¨ theme.config.json å­˜å‚¨åˆ°æ˜¯ currentTheme å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª idï¼Œéœ€è¦æ”¹æˆè¿™æ ·
    // const prevTheme: string = themeConfigValues?.currentTheme || '';
    const prevTheme: TSTheme.Item = themeConfigValues?.currentTheme;

    let nextTheme: TSTheme.Item;

    if (themeConfigValues?.themeList.length > 0) {
      // ğŸ‘‡ å¹¶ä¸æ˜¯é€šè¿‡ id å»æ‰¾ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å½“å‰ä¸»é¢˜ï¼Œéœ€è¦æ”¹æˆè¿™æ ·
      // if (prevTheme) nextTheme = _.find(themeConfigValues?.themeList, { id: prevTheme }) || initTheme;
      if (prevTheme) nextTheme = prevTheme || initTheme;
    } else {
      nextTheme = initTheme;
    }
  };
}
```

åœ¨å¼€å‘ç¯å¢ƒä¸‹éªŒè¯ä¸€æ³¢ï¼Œç¡®å®æ— è¯¯ï¼Œæ‰“ä¸ªåŒ…çœ‹çœ‹ï¼Œèµ°ä¸€ä¸ªæ„å»ºæµç¨‹

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
npm run dist
```

ğŸŒˆ æ— é—®é¢˜ï¼Œç¨³å¦¥

## ä¼˜åŒ– 4ï¼šç”Ÿäº§ç¯å¢ƒä¸‹ç¦æ­¢æ‹‰ä¼¸çª—å£ä¸è¿›å…¥å¼€å‘è€…æ¨¡å¼

æˆ‘ä»¬è¿›å…¥åˆ°ä¸»è¿›ç¨‹ `app/main/electron.ts` ä¸­ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç 

```ts
// ğŸ‘‡ å°†è¿™ä¸ªæ–¹æ³•å¯¼å‡ºï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ customMenu ç”¨åˆ°
export function isDev() {
  return process.env.NODE_ENV === 'development';
}

const mainWindow: MyBrowserWindow = new BrowserWindow({
  width: 1200,
  height: 800,
  resizable: isDev(), // æ ¹æ®ç¯å¢ƒè¿›è¡Œåˆ¤æ–­
  webPreferences: {
    devTools: isDev(), // æ ¹æ®ç¯å¢ƒè¿›è¡Œåˆ¤æ–­
    nodeIntegration: true,
  },
});

// åˆ›å»ºåº”ç”¨è®¾ç½®çª—å£
const settingWindow: MyBrowserWindow = new BrowserWindow({
  width: 720,
  height: 240,
  resizable: isDev(), // æ ¹æ®ç¯å¢ƒè¿›è¡Œåˆ¤æ–­
  show: false,
  frame: false,
  webPreferences: {
    devTools: isDev(), // æ ¹æ®ç¯å¢ƒè¿›è¡Œåˆ¤æ–­
    nodeIntegration: true,
  },
});
```

å¯¹åº”çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†èœå•æ ä¸­çš„åŠŸèƒ½æ ¹æ®ç¯å¢ƒä¸åŒè¿›è¡Œå¤„ç†ã€‚

```ts
import _ from 'lodash';
import { MyBrowserWindow, isDev } from './electron';
import { MenuItemConstructorOptions, shell, app, MenuItem, BrowserWindow } from 'electron';

const customMenu: (MenuItemConstructorOptions | MenuItem)[] = [
  // ...
  // ...
  {
    label: 'è§†å›¾',
    submenu: [
      // ...
      // è¿™é‡ŒæŠŠ `åˆ‡æ¢å¼€å‘è€…å·¥å…·` ä¸€æ ï¼Œé€šè¿‡ç¯å¢ƒåŠ¨æ€é…ç½®
    ],
  },
];

if (isDev()) {
  (customMenu[2]?.submenu as any).push({
    label: 'åˆ‡æ¢å¼€å‘è€…å·¥å…·',
    role: 'toggleDevTools',
    accelerator: (() => {
      if (process.platform === 'darwin') {
        return 'Alt+Command+I';
      } else {
        return 'Ctrl+Shift+I';
      }
    })(),
    click: (item: any, focusedWindow: MyBrowserWindow) => {
      if (focusedWindow) {
        focusedWindow.webContents.openDevTools();
      }
    },
  });
}

export default customMenu;
```

è¿™æ—¶å€™åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œæ•ˆæœæˆªç„¶ä¸åŒï½

## æœ€å

æ„å»ºæ‰“åŒ…å±å®ä¸æ˜“ï¼Œè¿™è¿‡ç¨‹å‡ºç°å¾ˆå¤šé—®é¢˜ï¼Œä½†è¦æ„Ÿè°¢é—®é¢˜çš„å‡ºç°ï¼Œé€šè¿‡è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬æ‰æœ‰è¿›æ­¥ã€‚è‡³æ­¤æˆ‘ä»¬çš„æ‰“åŒ…æ„å»ºå‘Šä¸€æ®µè½ï¼Œ [ğŸ‘‰ æ­¤ç« èŠ‚çš„ç›¸å…³ä»£ç åœ¨æ­¤](https://github.com/PDKSophia/visResumeMook/commits/chapter-23)ï¼Œå»ºè®®é…åˆçº¿ä¸Šä»£ç ï¼Œç»“åˆå°å†Œå†…å®¹ï¼ŒåŠ¨æ‰‹å®è·µã€‚
