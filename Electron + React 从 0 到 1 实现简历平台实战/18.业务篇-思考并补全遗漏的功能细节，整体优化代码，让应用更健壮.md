## å‰è¨€

å‰è¾¹æ–‡ç« ä»¥åŠŸèƒ½éœ€æ±‚å¼€å‘ä¸ºä¸»ï¼Œä½†å›è¿‡å¤´çœ‹ï¼Œè²Œä¼¼æ¯ä¸ªåŠŸèƒ½ç‚¹éƒ½ç›¸å¯¹â€œå‰²è£‚â€ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬è¡¥å…¨æ‰€é—æ¼çš„åŠŸèƒ½äº¤äº’ç‚¹ï¼Œè®©æ•´ä¸ªåº”ç”¨æ›´åŠ å¥å£®å¯ç”¨ã€‚å¦‚æœä½ å¯¹æœ¬ç« èŠ‚å†…å®¹å…´è¶£ä¸å¤§ï¼Œå¯ä»¥å¿«é€Ÿé˜…è¯»æˆ–è·³è¿‡ã€‚

## åŠŸèƒ½ä¸€ï¼šç©ºæ¨¡ç‰ˆ/æ¨¡ç‰ˆä¸å¯é¢„è§ˆå¼‚å¸¸å¤„ç†

åœ¨[ç¬¬åäº”ç« ](https://juejin.cn/book/6950646725295996940/section/6962940426999300109)æˆ‘ä»¬å®ç°äº†ç®€å†æ¨¡ç‰ˆåŠŸèƒ½ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¾§è¾¹æ çš„æ‹‰ä¼¸æ”¶èµ·æ•ˆæœï¼Œä½†å¯¹äºç©ºæ¨¡ç‰ˆæˆ–æ¨¡ç‰ˆä¸å¯é¢„è§ˆçš„å¼‚å¸¸å¹¶æœªè¿›è¡Œå¤„ç†ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œæ•´èµ·ï¼

### 1.1 ç‚¹å‡»æ¨¡ç‰ˆï¼Œå­˜å…¥ Redux

å‰å¾€ `/renderer/container/templateList/Navigation`ï¼Œæˆ‘ä»¬ä¿®æ”¹ `index.tsx` ä»£ç 

ä¸‹é¢æ˜¯ä¼ªä»£ç ï¼Œéƒ¨åˆ†ä»£ç è¿›è¡Œçœç•¥ï¼Œå»ºè®®å¤§å®¶ç›´æ¥çœ‹çº¿ä¸Šä»£ç 

```ts
// /renderer/container/templateList/Navigation/index.tsx

import { useDispatch, useSelector } from 'react-redux';

function Navigation() {
  const dispatch = useDispatch();

  // ğŸ‘‡ é€‰ä¸­æ¨¡ç‰ˆï¼Œå­˜å…¥Redux
  const onSelect = (template: TSTemplate.Item) => {
    dispatch({
      type: 'templateModel/setStore',
      payload: {
        key: 'selectTemplate',
        values: template,
      },
    });
  };

  return (
    <div styleName="navigation">
      <MyScrollBox maxHeight={height - HEADER_HEIGHT}>
        {templateList &&
          templateList.length > 0 &&
          templateList.map((template: TSTemplate.Item) => {
            return (
              <div styleName="template" key={template?.templateId}>
                {/* ğŸ‘‡ éƒ¨åˆ†ä»£ç å¿½ç•¥ï¼Œä¸ºé¢„è§ˆæ¨¡ç‰ˆæŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶ */}
                {selectTemplate?.templateId !== template?.templateId && (
                  <MyButton size="middle" className="view-btn" onClick={() =>  onSelect(template)}>
                    é¢„è§ˆæ¨¡ç‰ˆ
                  </MyButton>
                )}
              </div>
            );
          })}
      </MyScrollBox>
    </div>
  );
}

export default Navigation;
```

### 1.2 æ·»åŠ ç©ºç¼ºçœç»„ä»¶

æˆ‘ä»¬åˆ‡æ¢æ¨¡ç‰ˆï¼Œå°†å½“å‰æ¨¡ç‰ˆå­˜å…¥ Redux ä¸­ï¼Œæ¥ä¸‹æ¥éœ€è¦åœ¨â€œå†…å®¹â€åŒºåŸŸï¼Œæ ¹æ®é€‰ä¸­çš„æ¨¡ç‰ˆè¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå­˜åœ¨æ¨¡ç‰ˆåˆ™å±•ç¤ºå‡ºæ¥ï¼Œä¸å­˜åœ¨åˆ™æ˜¾ç¤ºç¼ºçœç»„ä»¶ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•å®ç°ä¸€ä¸‹ç©ºç¼ºçœç»„ä»¶ã€‚

å‰å¾€ `renderer/common/components`ï¼Œæˆ‘ä»¬åœ¨å…¬å…±ç»„ä»¶ä¸‹ï¼Œæ–°å¢ä¸€ä¸ªåä¸º `MyEmpty` çš„æ–‡ä»¶å¤¹ï¼Œä¸»è¦æ˜¯ç©ºæ•°æ®çŠ¶æ€æ—¶çš„è¯´æ˜ï¼Œæ•ˆæœä¸º`ä¸€å¼ å›¾ + ä¸€å¥è¯`ï¼Œè®©æˆ‘ä»¬æ¥å†™ä¸€ä¸‹ä»£ç 

```ts
// renderer/common/components/MyEmpty/index.tsx

import React from 'react';
import './index.less';
export type SizeType = 'small' | 'big';

interface IEmptyProps {
  imgSrc: string;
  size?: SizeType;
  label?: string;
  style?: React.CSSProperties;
}

function MyEmpty({ imgSrc, size = 'small', style, label }: IEmptyProps) {
  return (
    <div styleName="empty">
      <img src={imgSrc} style={style} styleName={`img-${size}`} />
      {label && <p styleName="label">{label}</p>}
    </div>
  );
}

export default MyEmpty;
```

### 1.3 é‡åˆ°é—®é¢˜

è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆè›‹ç–¼çš„é—®é¢˜ï¼š**å¦‚ä½•ä¿è¯æ¨¡ç‰ˆç»„ä»¶å’Œæ¨¡ç‰ˆå°é¢æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»**ï¼Ÿä¸¾ä¸ªä¾‹å­:

- åœ¨ `assets` é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰ä¸€ä¸ªæ¨¡ç‰ˆå°é¢ `template1.png`
- åœ¨ `renderer/container/templates` æ¨¡ç‰ˆä»“åº“ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¨¡ç‰ˆç»„ä»¶ `<TemplateOne />`

è¿™æ—¶å€™å¦‚ä½•ä¿è¯ `template1.png` å¯¹åº”çš„å°±æ˜¯ `<TemplateOne />` ï¼Ÿ æˆ‘ä»¬èƒ½åœ¨ä¸»è§‚æ„è¯†ä¸Šï¼Œæ¸…æ¥šçŸ¥é“ï¼Œæ¨¡ç‰ˆå°é¢ 1 å¯¹åº”æ¨¡ç‰ˆç»„ä»¶ 1ï¼Œä½†è®¡ç®—æœºå¹¶ä¸çŸ¥é“ï¼Œä»£ç è¯¥å¦‚ä½•å†™ï¼Ÿ

å‡è®¾æˆ‘å°† `template1.png` æ”¹æˆ `template2.png`ï¼Œæ˜¯å¦æ„å‘³ç€ï¼Œè¿™å¼ æ¨¡ç‰ˆå°é¢å¯¹åº”`<TemplateTwo />`å‘¢ï¼Ÿç­”æ¡ˆå¾ˆæ˜¾ç„¶ï¼šå¹¶ä¸æ˜¯ï¼

è¿™ä¸ªé—®é¢˜è²Œä¼¼å¾ˆéš¾è¢«è§£å†³ï¼Œä¸¾ä¸ªåœºæ™¯ï¼Œç°åœ¨å­˜åœ¨ 10 å¼ æ¨¡ç‰ˆå°é¢ï¼Œå¯¹åº” 10 ä¸ªæ¨¡ç‰ˆç»„ä»¶ï¼Œåœ¨åº”ç”¨åŠ è½½æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡è¯»å–é™æ€èµ„æºæ–‡ä»¶ï¼Œå‡è®¾ä»¥æœ‰åºçš„å½¢å¼å±•ç¤ºæˆ‘ä»¬çš„å°é¢ï¼Œä¼ªä»£ç ä¸ºï¼š

```js
fileAction.readDir(assetPath).then((files) => {
  console.log(files);
  // ['template1.png', 'template2.png', 'template3.png', 'template4.png', ...]
});
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡â€œæŠ•æœºå–å·§â€çš„æ–¹å¼ï¼Œå°†è¯»åˆ°çš„æ¨¡ç‰ˆå°é¢çš„æ–‡ä»¶ç´¢å¼•å­˜å…¥åˆ° redux ä¸­

```js
fileAction.readDir(assetPath).then((files) => {
  if (files.length > 0) {
    let templateList = files.map((fileName, index) => {
      const base64URL = await fileAction.read(`${appPath}assets/template/${fileName}`, 'base64');
      return {
        templateName: fileName,
        templateId: createUID(),
        // ğŸ‘‡ è¿™é‡Œè®°å½•ç´¢å¼•ï¼Œå°†å…¶é¡ºå¸¦å­˜å…¥åˆ° Redux ä¸­
        templateIndex: index + 1,
        templateCover: `data:image/png;base64,${base64URL}`,
      };
    });

    // ğŸ‘‡ å­˜å…¥ Redux çš„é€»è¾‘ï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†
  }
});
```

ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•å¯¹åº”åˆ°æ¨¡ç‰ˆç»„ä»¶

```ts
{selectTemplate?.templateIndex === 1 && <TemplateOne />}
{selectTemplate?.templateIndex === 2 && <TemplateTwo />}
{selectTemplate?.templateIndex === 3 && <TemplateThree />}
{selectTemplate?.templateIndex === 4 && <TemplateFour />}
```

> è¿™ç§æ–¹å¼çº¯å±äºæŠ•æœºå–å·§ï¼Œè¿™è¦æ±‚æˆ‘ä»¬çš„æ¨¡ç‰ˆå°é¢å¿…é¡»æ˜¯æŒ‰ç…§é¡ºåºè¿›è¡Œå‘½åï¼Œå¹¶ä¸”æ¯æ¬¡æ–°å¢ä¸€ä¸ªæ¨¡ç‰ˆå°é¢ï¼Œè¿˜éœ€è¦å»æ·»åŠ å¯¹åº”çš„æ¨¡ç‰ˆç»„ä»¶ï¼Œä»¥åŠæ¸²æŸ“çš„æ¡ä»¶è¯­å¥

> å¦‚æœä¸­é€”æˆ‘ä»¬å°†æ¨¡ç‰ˆå°é¢çš„å‘½åæ‰“ä¹±ï¼Œæ˜¾è€Œæ˜“è§çš„åæœå°±æ˜¯ï¼šæ¨¡ç‰ˆä¸å°é¢å¯¹åº”ä¸ä¸Šã€‚

**è€å®è¯´ï¼Œè¯¥é—®é¢˜æˆ‘è¿˜æœªæœ‰è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰æœ‰ä¸ªå°æ€è·¯ï¼Œä½†è¿˜éœ€è¦ç»è¿‡éªŒè¯å¯è¡Œæ€§ã€‚ä¸ºæ­¤æˆ‘ä»¬å…ˆå°†å…¶æ”¾ä¸€æ”¾ï¼Œç»§ç»­å¾€ä¸‹å¼€å‘ã€‚**

### 1.4 æš‚æ—¶ç¼“ç¼“ï¼Œç»§ç»­å¼€å‘

å¦‚ä½•å®ç°å°é¢ä¸æ¨¡ç‰ˆçš„å¯¹åº”å…³ç³»ï¼Ÿæš‚æ—¶ä»¥ä¸Šè¾¹æ‰€è¯´çš„ç´¢å¼•è¿›è¡Œç®€å•å®ç°ï¼Œå‰å¾€ `renderer/hooks` æ‰¾åˆ° `useReadDirAssetsTemplateHooks.ts` æ–‡ä»¶ï¼Œè¿›è¡Œä¿®æ”¹ï¼Œä¸è¦å¿˜è®°äº†ï¼Œå¯¹äºç±»å‹å£°æ˜ä¹Ÿéœ€è¦å¯¹åº”ä¿®æ”¹

```ts
// renderer/hooks/useReadDirAssetsTemplateHooks.ts

// æ‰¾åˆ°è¿™æ®µä»£ç 
if (files.length > 0) {
  let templateList: TSTemplate.Item[] = [];
  for (let idx = 0; idx < files.length; idx++) {
    const base64URL = await fileAction.read(`${appPath}assets/template/${files[idx]}`, 'base64');
    templateList.push({
      templateName: files[idx],
      // ğŸ‘‡ æ·»åŠ ç´¢å¼•
      templateIndex: idx,
      templateId: createUID(),
      templateCover: `data:image/png;base64,${base64URL}`,
    });
  }
}
```

```ts
// renderer/common/types/template.d.ts

declare namespace TSTemplate {
  export interface Item {
    // ğŸ‘‡ æ·»åŠ æ­¤ç±»å‹è¯´æ˜
    /**
     * @description æ¨¡ç‰ˆä¸‹æ ‡
     */
    templateIndex: number;
  }
}
```

ç´§æ¥ç€ï¼Œå‰å¾€ `renderer/container/templateList/StaticResume` ç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦åšæ¨¡ç‰ˆä¸å­˜åœ¨æˆ–æ— æ³•é¢„è§ˆæ—¶çš„å¼‚å¸¸å¤„ç†äº†ã€‚æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œå¤§å®¶è®°å¾—çœ‹æ³¨é‡Š

```ts
import React from 'react';
import './index.less';
import { shell } from 'electron';
import * as TemplateList from '@src/container/templates';
import Footer from '../Footer';
import MyScrollBox from '@common/components/MyScrollBox';
import { useSelector } from 'react-redux';
import MyEmpty from '@common/components/MyEmpty';
import EmptyPng from '@assets/icon/empty.png';
import MyButton from '@common/components/MyButton';

// ğŸ‘‡ 1. åˆæ³•ä¸”å­˜åœ¨çš„ç®€å†æ¨¡ç‰ˆï¼Œå› ä¸ºæˆ‘ä»¬å­˜åœ¨ä¸¤ä¸ªæ¨¡ç‰ˆå°é¢ï¼Œä½†åªæœ‰ä¸€ä¸ªæ¨¡ç‰ˆç»„ä»¶
const VALID_TEMPLATE = [0];

function StaticResume() {
  const HEADER_HEIGHT = 76; // è·ç¦»å¤´éƒ¨è·ç¦»
  const height = document.body.clientHeight;
  const selectTemplate: TSTemplate.Item = useSelector((state: any) => state.templateModel.selectTemplate);

  // ğŸ‘‡ 2. ä¸‹é¢åˆ¤æ–­è¯¥æ¨¡ç‰ˆæ˜¯å¦åˆæ³•ä¸”å­˜åœ¨ç»„ä»¶æ¨¡ç‰ˆ
  const isIncludeTemplate = VALID_TEMPLATE.includes(selectTemplate.templateIndex);
  const isValidTemplate = selectTemplate.templateId && selectTemplate.templateIndex !== -1;

  return (
    <div styleName="container">
      <MyScrollBox maxHeight={height - HEADER_HEIGHT}>
        {isValidTemplate && isIncludeTemplate && (
          <>
            {selectTemplate.templateIndex === 0 && <TemplateList.TemplateOne />}
            <Footer />
          </>
        )}
        {/* ğŸ‘‡ 3. ç¼ºçœé¡µè¯´æ˜ */}
        {isValidTemplate && !isIncludeTemplate && (
          <LackDesc label="æš‚æœªå¼€å‘æ­¤æ¨¡ç‰ˆï¼Œæ¬¢è¿ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿›è¡Œæ¨¡ç‰ˆè´¡çŒ®" />
        )}
        {!isValidTemplate && (
          <LackDesc label="æš‚æ— æ¨¡ç‰ˆæ•°æ®ï¼Œæ¬¢è¿ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿›è¡Œæ¨¡ç‰ˆè´¡çŒ®" />
        )}
      </MyScrollBox>
    </div>
  );
}

export default StaticResume;

const LackDesc = React.memo(({ label }: { label: string }) => {
  return (
    <div styleName="empty">
      <MyEmpty imgSrc={EmptyPng} label={label} />
      <div styleName="footer">
        <MyButton
          size="middle"
          className="use-btn"
          onClick={() => {
            shell.openExternal('https://github.com/PDKSophia/visResumeMook/issues/4');
          }}
        >
          è´¡çŒ®æ¨¡ç‰ˆ
        </MyButton>
      </div>
    </div>
  );
});
```

æœ€ç»ˆæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼ŒğŸ‘‰ [ç‚¹å‡»æŸ¥çœ‹åŠŸèƒ½ä¸€ commit ä»£ç ](https://github.com/PDKSophia/visResumeMook/commit/18a763e54be2b859147adcf7cc6e08147816aa8d)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1efdae3bb0c44255babb21256b236cbe~tplv-k3u1fbpfcp-watermark.image)

## åŠŸèƒ½äºŒï¼šä»æ¨¡ç‰ˆåˆ—è¡¨è·³è½¬è‡³ç®€å†åˆ¶ä½œ

ä¸Šè¾¹å®ç°äº†é¢„è§ˆæ¨¡ç‰ˆåŠŸèƒ½ï¼Œä½†ä¹Ÿä»…ä»…åªæ˜¯é¢„è§ˆè€Œå·²ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å®ç°ä»é¢„è§ˆæ¨¡ç‰ˆåˆ°ç®€å†åˆ¶ä½œã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œç®€å†åˆ¶ä½œçš„å…¥å£æœ‰å“ªäº›ï¼Ÿ

- ä»é¦–é¡µè¿›å…¥

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f8c2170cf0641bb8b3d66b781abe4c2~tplv-k3u1fbpfcp-watermark.image)

- ä»æ¨¡ç‰ˆåˆ—è¡¨é¡µé¢ç‚¹å‡»æ¨¡ç‰ˆåˆ¶ä½œè¿›å…¥

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7592f18a57b2487a95a59703e8b24a04~tplv-k3u1fbpfcp-watermark.image)

ä¼šæœ‰ä¸åŒçš„å…¥å£ï¼Œå¹¶ä¸”ä¼šä»¥ä¸åŒçš„æ¨¡ç‰ˆè¿›è¡Œåˆ¶ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç®€å†åˆ¶ä½œé¡µé¢ï¼Œå°±å¾—çŸ¥é“ï¼šå½“å‰çš„å…¥å£æ¥æºã€å½“å‰çš„æ¨¡ç‰ˆä¿¡æ¯

### 2.1 è·¯ç”±æ”¹å†™

å¦‚ä½•è®©ç®€å†åˆ¶ä½œé¡µé¢è·å–åˆ°ä¸Šè¿°çš„ä¸¤ä¸ªå…³é”®ä¿¡æ¯å‘¢ï¼Ÿ

- Redux å“åº”å¼

åœ¨è·³è½¬å‰ï¼Œå°†æ‰€éœ€è¦çš„ä¿¡æ¯å­˜åˆ° Redux ä¸­ï¼Œè¿›å…¥åˆ°æœ€ç»ˆé¡µé¢æ—¶å†å°†æ•°æ®å–å‡º

- Router è·¯ç”±å¼

æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å…³é”®ä¿¡æ¯æºå¸¦åˆ°è·¯ç”±ä¸­ï¼Œè¿›å…¥åˆ°æœ€ç»ˆé¡µé¢æ—¶è§£æè·¯ç”±ï¼Œè·å–æ•°æ®ã€‚

ç»è¿‡å¯¹æ¯”ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆä¸å¤ªæ¨èï¼Œå®ƒéœ€è¦æˆ‘ä»¬åœ¨ Redux ä¸­ç»´æŠ¤ä¸€äº›æ•°æ®ï¼Œä¸ºæ­¤æˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆè§£å†³ã€‚ä½†å†™è·¯ç”±åˆæ˜¯ä¸€é—¨å­¦é—®ï¼Œæ¯”å¦‚è¯´å†™æˆ `/resume?id=1&idx=1` è¿˜æ˜¯å†™æˆ `/resume/:id/:idx`

å‰è€…éœ€è¦æˆ‘ä»¬è‡ªè¡Œå®ç°è·¯ç”±å‚æ•°çš„æ‹¼æ¥ä¸è§£æï¼Œåè€…æœ‰ç°æˆçš„åº“ä½¿ç”¨ï¼Œæƒ³å¿…å¤§å®¶éƒ½å†™è¿‡è¿™æ ·çš„è·¯ç”± `/resume/:id/:idx`ï¼Œæœ¬è´¨æ˜¯é€šè¿‡ [path-to-regexp](https://www.npmjs.com/package/path-to-regexp) åº“å®ç°ï¼Œæ¥ä¸‹æ¥æˆ‘å°†åœ¨é¡¹ç›®ä¸­å¼•å…¥è¯¥åº“ï¼Œä¿®æ”¹æˆ‘ä»¬çš„è·¯ç”±ã€‚æˆ‘ä»¬å…ˆæ¥å®‰è£…

```
npm install path-to-regexp --save-dev
```

å‰å¾€ `renderer/common/utils` ä¸­ä¿®æ”¹ `router.ts` æ–‡ä»¶ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆå¹¶å‚æ•°

```ts
// renderer/common/utils/router.ts

import { compile } from 'path-to-regexp';

export function compilePath(route: string, params?: { [key: string]: any }) {
  const toPath = compile(route, { encode: encodeURIComponent });
  return toPath(params);
}
```

æ¥ç€æˆ‘ä»¬å°†æ‰€æœ‰çš„è·¯ç”±éƒ½è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ `renderer` æ–‡ä»¶å¤¹ä¸‹å…¨å±€æŸ¥æ‰¾æ‰€æœ‰é€šè¿‡ `history.push(route)` éƒ½æ”¹æˆ `history.push(compilePath(route))`

> æ‰€æœ‰çš„æ”¹å†™å°±ä¸ä¸€ä¸€å±•ç¤ºï¼Œå¤§å®¶å¯è‡ªè¡Œä¿®æ”¹ã€‚

### 2.2 é¦–é¡µè·³è½¬å¤„ä¿®æ”¹

å‰å¾€ `app/renderer/common/constants` ä¿®æ”¹è·¯ç”±å‚æ•°å®šä¹‰

```ts
// renderer/common/constants/router.ts

const ROUTER = {
  root: '/',
  // ğŸ‘‡ è¿™é‡Œæˆ‘ä»¬æ”¹ä¸€ä¸‹ç®€å†åˆ¶ä½œçš„è·¯ç”±ï¼Œè§„åˆ™ï¼š/æ¥æº/æ¨¡ç‰ˆID/æ¨¡ç‰ˆç´¢å¼•
  resume: '/resume/:fromPath/:templateId/:templateIndex',
  template: '/template',
};
```

æ¥ç€è¿›å…¥ `renderer/container/root` é¦–é¡µï¼Œæ‰¾åˆ°å…¥å£æ–‡ä»¶ `index.tsx`ï¼Œæˆ‘ä»¬ä¿®æ”¹è·³è½¬é€»è¾‘ä»£ç 

```ts
const onRouterToLink = (router: TSRouter.Item) => {
  if (isHttpOrHttpsUrl(router.url)) {
    shell.openExternal(router.url);
  } else {
    if (router.key !== ROUTER_KEY.resume) {
      history.push(compilePath(router.url));
    } else {
      // ğŸ‘‡ è·³è½¬è·¯ç”±çš„ä¿®æ”¹
      history.push(
        compilePath(router.url, {
          fromPath: ROUTER_KEY.root,
          templateId: selectTemplate?.templateId,
          templateIndex: selectTemplate?.templateIndex,
        })
      );
    }
  }
};
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcdad9606fa545058c23622c36e8d21e~tplv-k3u1fbpfcp-watermark.image)

### 2.3 ç®€å†æ¨¡ç‰ˆè·³è½¬å¤„ä¿®æ”¹

å‰å¾€ `renderer/container/templateList/Footer` é¦–é¡µæ¨¡å—ï¼Œæ‰¾åˆ°å…¥å£æ–‡ä»¶ `index.tsx`ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è·³è½¬é€»è¾‘ä»£ç 

```ts
// app/renderer/container/templateList/Footer/index.tsx

import React from 'react';
import './index.less';
import { useHistory } from 'react-router';
import { useSelector } from 'react-redux';
import { ROUTER_KEY } from '@common/constants/router';
import { compilePath } from '@common/utils/router';
import MyButton from '@common/components/MyButton';
import ROUTER from '@common/constants/router';

function Footer() {
  const history = useHistory();
  const selectTemplate = useSelector((state: any) => state.templateModel.selectTemplate);

  const onMadeResume = (router: TSRouter.Item) => {
    // ğŸ‘‡ è·³è½¬è·¯ç”±çš„ä¿®æ”¹
    history.push(
      compilePath(ROUTER.resume, {
        fromPath: ROUTER_KEY.templateList,
        templateId: selectTemplate?.templateId,
        templateIndex: selectTemplate?.templateIndex,
      })
    );
  };
  return (
    <div styleName="footer">
      <MyButton size="middle" className="use-btn" onClick={onMadeResume}>
        ä»¥æ­¤æ¨¡ç‰ˆå‰å¾€åˆ¶ä½œç®€å†
      </MyButton>
    </div>
  );
}

export default Footer;
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19690cbb612048869890e1967c7f911d~tplv-k3u1fbpfcp-watermark.image)

### 2.4 ç®€å†åˆ¶ä½œå¤„çš„è·¯ç”±å‚æ•°è·å–ï¼Œæ­£ç¡®è¿”å›

ç”±äºæˆ‘ä»¬çš„å…¥å£æ¥æºä¸åŒï¼Œæ‰€ä»¥åœ¨â€œè¿”å›â€æ—¶ï¼Œä¹Ÿéœ€åšå¯¹åº”çš„å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ `useParams` è¿™ä¸ª hooksï¼Œå¾—åˆ°è·¯ç”±ä¸­çš„æ•°æ®ï¼Œæ ¹æ®æ•°æ®çš„ `fromPath` ä¸åŒï¼Œè¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚

å‰å¾€ `/renderer/container/resume/components/ResumeActions` ï¼Œæ‰¾åˆ°å…¥å£æ–‡ä»¶ `index.tsx`ï¼Œè¿›è¡Œä¿®æ”¹ï¼Œä¸‹é¢æ˜¯ä¼ªä»£ç 

```ts
// renderer/container/resume/components/ResumeActions/index.tsx

import { useHistory, useParams } from 'react-router';
import { compilePath } from '@common/utils/router';
import ROUTER, { ROUTER_KEY } from '@common/constants/router';

function ResumeAction() {
  const history = useHistory();
  // ğŸ‘‡ å®šä¹‰å‚æ•°ç±»å‹
  const routerParams = useParams<{
    fromPath: string;
    templateId: string;
    templateIndex: string;
  }>();

  // è¿”å›é¦–é¡µ
  const onBack = () => {
    if (routerParams?.fromPath === ROUTER_KEY.root) {
      history.push(compilePath(ROUTER.root));
    } else if (routerParams?.fromPath === ROUTER_KEY.templateList) {
      history.push(compilePath(ROUTER.templateList));
    } else {
      console.log('here');
    }
  };

  return (
    <div styleName="actions">
      <div styleName="back" onClick={onBack}>è¿”å›</div>
    </div>
  );
}

export default ResumeAction;
```

### 2.5 ç®€å†åˆ¶ä½œå¤„çš„è·¯ç”±å‚æ•°è·å–ï¼Œæ­£ç¡®æ˜¾ç¤ºæ¨¡ç‰ˆ

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬ä» `useParams` è¿™ä¸ª hooksï¼Œå¾—åˆ°è·¯ç”±ä¸­çš„æ•°æ®ï¼Œæ ¹æ®æ¨¡ç‰ˆ ID å’Œæ¨¡ç‰ˆç´¢å¼•ï¼Œè¿›è€ŒåŠ è½½å±•ç¤ºæ­£ç¡®çš„æ¨¡ç‰ˆï¼Œå¦‚æœä½ è®¤çœŸçœ‹äº†ä¸Šè¾¹çš„åŠŸèƒ½ä¸€ï¼Œæƒ³å¿…æ­¤é—®é¢˜å¯¹ä½ æ¥è¯´ä¹Ÿå¹¶ééš¾äº‹ï¼Œè¿™é‡Œå°±ä¸è¿›è¡Œå¤šä½™è®²è§£ã€‚

ä¹Ÿç®—æ˜¯ä¸€ä¸ªå°æµ‹è¯•ï¼Œå°ä¼™ä¼´ä»¬å¯è‡ªè¡Œå®ç°ã€‚

ğŸ‘‰ [ç‚¹å‡»æŸ¥çœ‹åŠŸèƒ½äºŒ commit ä»£ç ](https://github.com/PDKSophia/visResumeMook/commit/3ef20a15f621bda325236c13c739cceb34bbce94)

## åŠŸèƒ½ä¸‰ï¼šå®ç° KeepAlive æ•ˆæœ

æƒ³å¿…å°ä¼™ä¼´ä»¬ç°åœ¨ä¼šæœ‰ä¸€ä¸ªå¾ˆè›‹ç–¼çš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯æ²¡æœ‰é¡µé¢ç¼“å­˜çš„æ•ˆæœï¼Œè®°å¾—ä»¥å‰å†™ Vue æ—¶ï¼Œé¡µé¢ç¼“å­˜å°±å¾ˆæ–¹ä¾¿ï¼Œåªéœ€è¦è¿™ä¹ˆå†™ï¼Œå°±èƒ½å®ç°æ•ˆæœ

```js
// è¿™é‡Œä»¥ vue2 ä¸ºä¾‹

<!-- å¤±æ´»çš„ç»„ä»¶å°†ä¼šè¢«ç¼“å­˜ï¼-->
<keep-alive>
  <component v-bind:is="currentTabComponent"></component>
</keep-alive>
```

> é¡µé¢ç¼“å­˜çš„åŸç†ï¼Œæˆ‘çŒœæƒ³åº”è¯¥æ˜¯é€šè¿‡ display:none çš„æ–¹å¼å®ç°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç§ä¸‹å»äº†è§£ï¼Œæˆ–è€…è¯„è®ºåŒºå‘è¡¨ä½ çš„è§‚ç‚¹

é‚£æˆ‘ä»¬åœ¨ React ä¸­ï¼Œå¦‚ä½•å®ç°é¡µé¢ç¼“å­˜å‘¢ï¼Ÿæœ‰ä¸€ä¸ª [react-router-cache-route](https://www.npmjs.com/package/react-router-cache-route) åº“ï¼Œå¯ä»¥æ›¿æˆ‘ä»¬å®ç°ï¼Œä½¿ç”¨ä¹Ÿæå…¶ç®€å•ï¼Œè®©æˆ‘ä»¬å…ˆæ¥å®‰è£…ä¸€ä¸‹

```
npm install react-router-cache-route --save-dev
```

å‰å¾€ `/renderer/router.tsx` ä¿®æ”¹ä¸€ä¸‹è·¯ç”±ç»„ä»¶

```ts
// renderer/router.tsx

import React, { useEffect } from 'react';
// ğŸ‘‡ å¼•å…¥ï¼Œå®ç°é¡µé¢ç¼“å­˜
import CacheRoute, { CacheSwitch } from 'react-router-cache-route';
import { HashRouter, Redirect } from 'react-router-dom';
import Root from '@src/container/root';
import Resume from '@src/container/resume';
import TemplateList from '@src/container/templateList';
import ROUTER from '@common/constants/router';
import useThemeActionHooks from './hooks/useThemeActionHooks';
import useReadDirAssetsTemplateHooks from './hooks/useReadDirAssetsTemplateHooks';

function Router() {
  const readDirAssetsTemplateHooks = useReadDirAssetsTemplateHooks();
  const initThemeConfig = useThemeActionHooks.useInitThemeConfig();
  useEffect(() => {
    initThemeConfig();
    readDirAssetsTemplateHooks();
  }, []);

  return (
    <HashRouter>
      <CacheSwitch>
        <CacheRoute path={ROUTER.root} exact component={Root} />
        <CacheRoute path={ROUTER.resume} exact component={Resume} />
        <CacheRoute path={ROUTER.templateList} exact component={TemplateList} />
        <Redirect from={ROUTER.root} exact to={ROUTER.root} />
      </CacheSwitch>
    </HashRouter>
  );
}
export default Router;
```

è¿™æ ·å°±å®ç°äº†é¡µé¢ç¼“å­˜ï¼Œä½ å¯ä»¥åšä¸ªå°è¯•ï¼Œä»»æ„è¿›å…¥ä¸€ä¸ªè·¯ç”±ï¼Œåœ¨è¯¥è·¯ç”±ä¸‹åˆ·æ–°é¡µé¢ï¼Œçœ‹çœ‹æ˜¯å¦ä¼šåœç•™åœ¨æ­¤é¡µé¢ä¸‹ï¼ˆä¹‹å‰æ˜¯ä¼šå›åˆ°é¦–é¡µï¼‰

ğŸ‘‰ [ç‚¹å‡»æŸ¥çœ‹åŠŸèƒ½ä¸‰ commit ä»£ç ](https://github.com/PDKSophia/visResumeMook/commit/43af928da7e467874705419c52202621f41602c0)

### åŠŸèƒ½å››ï¼šç®€å†åˆ¶ä½œå†…å®¹é«˜åº¦æœ‰è¯¯

å½“æˆ‘ä»¬å®ç°äº†ä¸Šè¿°çš„ä¸‰ä¸ªåŠŸèƒ½ä¹‹åï¼Œå°±ä¼šå¼•å‡ºæ­¤é—®é¢˜ï¼Œå¦‚ä½•å¤ç°å‘¢ï¼Ÿ

**å¤ç°æ­¥éª¤ï¼šé¦–é¡µ -> è¿›å…¥ç®€å†åˆ¶ä½œé¡µ -> åœ¨ç®€å†åˆ¶ä½œé¡µä¸‹åˆ·æ–° -> é«˜åº¦é”™è¯¯**ï¼Œä¸‹é¢æ˜¯ä¸€å¼ å¼‚å¸¸å›¾ç‰‡

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86525c11ad7a420982dbb1f1c439bfe7~tplv-k3u1fbpfcp-watermark.image)

ä¸å¯¹åŠ²ï¼Œä¸ºä»€ä¹ˆç®€å†çš„æ˜¾ç¤ºé«˜åº¦ä¼šå‡ºç°å¼‚å¸¸ï¼Œè¿™ä¸æˆ‘ä»¬æœŸæœ›ä¸ç¬¦ã€‚æˆ‘ä»¬æ¥æ’æŸ¥ä¸€ä¸‹ï¼Œè¿›å…¥åˆ° `renderer/container/resume/ResumeContent` ä¸­ï¼Œæ‰“å°ä¸€ä¸‹æˆ‘ä»¬çš„é«˜åº¦

```ts
// renderer/container/resume/ResumeContent/index.tsx

function ResumeContent() {
  const HEADER_ACTION_HEIGHT = 92;
  const height = document.body.clientHeight;

  // ğŸ‘‡ æ‰“å°ä¸€ä¸‹ï¼Œçœ‹çœ‹é«˜åº¦æ˜¯å¤šå°‘
  console.log('body: ', document.body);
  console.log('clientHeight: ', document.body.clientHeight);

  return (
    <MyScrollBox maxHeight={height - HEADER_ACTION_HEIGHT}>
      {/* ç»„ä»¶å†…å®¹ */}
    </MyScrollBox>
  );
}
```

ä»ä¸Šè¾¹ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç®€å†çš„æ˜¾ç¤ºé«˜åº¦æ˜¯ä¸ `document.body.clientHeight` å¯†åˆ‡ç›¸å…³ï¼Œæƒ³è¦ææ¸…æ¥šä¸ºä»€ä¹ˆé«˜åº¦é”™è¯¯ï¼Œå°±å¾—æ‰“å° `clientHeight`ï¼Œçœ‹çœ‹æ˜¯å¦ä¸æˆ‘ä»¬çš„æ‰€æœŸæœ›çš„ä¸€è‡´

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7c365bca7a045f8ac8121b1b96951da~tplv-k3u1fbpfcp-watermark.image)

`clientHeight` å±…ç„¶æ˜¯ 0 ï¼æˆ‘ä»¬å†çœ‹çœ‹ï¼Œæ‰“å°çš„ body å…ƒç´ çš„é«˜åº¦æ˜¯å¤šå°‘

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a01e64bf13b64aa3a91973f9e139cbe1~tplv-k3u1fbpfcp-watermark.image)

ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå°ä¼™ä¼´ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï½

é‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿæœ€ç®€å•ç²—æš´çš„æ–¹å¼ï¼ŒæŠŠ height æ”¾åœ¨ state ä¸­

```ts
function ResumeContent() {
  const HEADER_ACTION_HEIGHT = 92;
  const [height, setHeight] = useState(0);

  useEffect(() => {
    if (document.body && document.body.clientHeight > 0)
      setHeight(document.body.clientHeight);
  }, [document.body]);

  return (
    <MyScrollBox maxHeight={height - HEADER_ACTION_HEIGHT}>
      {/* ç»„ä»¶å†…å®¹ */}
    </MyScrollBox>
  );
}
```

æ­¤é—®é¢˜æœ€é‡è¦çš„ä¸åœ¨äºå¦‚ä½•è§£å†³ï¼Œæœ€é‡è¦çš„æ˜¯çŸ¥é“ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚è¿™é‡Œç•™ä¸ªå°æé—®ï¼Œå°ä¼™ä¼´ä»¬åŠ¨åŠ¨å°å¥¶è¢‹ç“œï¼Œæƒ³ä¸€æƒ³ï½ç„¶ååœ¨è¯„è®ºåŒºç•™è¨€ã€‚

ğŸ‘‰ [ç‚¹å‡»æŸ¥çœ‹åŠŸèƒ½å›› commit ä»£ç ](
https://github.com/PDKSophia/visResumeMook/commit/dd4aab6c6e0cdfe436eb08d7e7fadab04f282bbc)

## æ€»ç»“

æœ¬ç« ä¸»è¦æ˜¯å¯¹ç»†èŠ‚æ–¹é¢çš„åšäº†äº›å°å°ä¼˜åŒ–ï¼Œè™½è¯´ä½¿ç”¨çš„éƒ½æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æˆ‘å¸Œæœ›å°ä¼™ä¼´ä»¬èƒ½ä¸ç»™è‡ªå·±è®¾é™ï¼Œä¸è¦åœç•™åœ¨ä½¿ç”¨çŠ¶æ€ï¼Œè€Œæ˜¯èƒ½å»äº†è§£è¯¥åº“èƒŒåçš„å®ç°ï¼Œä¸è¦æ±‚ç²¾é€šè¯»å®Œæºç ï¼Œä½†èƒ½å¯¹èƒŒåçš„å®ç°åŸç†ç•¥çŸ¥ä¸€äºŒï¼Œæˆ‘æƒ³ï¼Œè¿™ä¸€å®šæ¯”æ­¤ç« èŠ‚æ›´é‡è¦ã€‚å¦‚æœæœ‰ç–‘é—®ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚
