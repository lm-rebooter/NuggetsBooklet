## å‰è¨€

æœ¬ç« èŠ‚å¹¶ä¸ä¼šæ•™ä½ å»å®ç°ä¸€ä»½å¯è§†åŒ–è‡ªå®šä¹‰çš„ç®€å†æ¨¡ç‰ˆï¼Œ`æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”`ï¼Œé˜¿å®½å¸Œæœ›ä½ é˜…è¯»å®Œæ­¤ç« èŠ‚ä¹‹åï¼Œèƒ½æ•£å‘æ€ç»´ï¼Œè‡ªå·±åŠ¨æ‰‹å®ç°ï¼Œ**ä¸¾ä¸€éš…ä¸ä»¥ä¸‰éš…åï¼Œåˆ™ä¸å¤ä¹Ÿ**ã€‚

æˆ‘ä»¬è¦åšä¸€ä¸ªä»€ä¹ˆæ ·çš„ä¸œè¥¿å‘¢ï¼Ÿçœ‹ä¸‹å›¾ä½ å¤§è‡´ä¹Ÿèƒ½çŒœåˆ°ï¼Œæ²¡é”™ï¼Œå¥½å¬ç‚¹å«åšå¯è§†åŒ–ä½ä»£ç å¹³å°ï¼Œä½†å®é™…ä¸Šï¼Œ**æ‡‚å¾—éƒ½æ‡‚**ã€‚æŠ›å¼€æ‰€æœ‰ä¸œè¥¿ä¸è¯´ï¼Œæˆ‘ä»¬ä»…ä¸ºäº†å­¦ä¹ ï¼Œæ¥äº†è§£ä¸€ä¸‹å…¶ä¸­æŸäº›åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d305cd043ec4a04b982df5688b19179~tplv-k3u1fbpfcp-watermark.image)

> âš ï¸ **æœ¬ç« èŠ‚ä¸ä¼šæ‰‹æŠŠæ‰‹å†å¸¦å¤§å®¶å»å®ç°è¿™ä¸ªå¹³å°äº†ï¼Œå·¥ä½œé‡ä¸é˜…è¯»é‡è¾ƒå¤šï¼Œä½†å¦‚æœä½ ç›¸ä¿¡é˜¿å®½ï¼Œä½ å¯ä»¥ç»“åˆæ–‡ç« çš„æ ¸å¿ƒå†…å®¹ï¼Œå†å» [dom-ui-toolbar](https://github.com/PDKSophia/dom-ui-toolbar) ç»“åˆä»£ç é˜…è¯»ï¼Œæœ€ååŠ¨æ‰‹å®æ“ã€‚çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œï¼**

> æœ¬é¡¹ç›®ä»£ç åœ¨ï¼šâœ¨ [dom-ui-toolbar](https://github.com/PDKSophia/dom-ui-toolbar)ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‰å¾€é˜…è¯»æºç 

**æœŸæœ›ä½ çœ‹å®Œæœ¬ç« èŠ‚ä¹‹åï¼Œèƒ½ç»“åˆçº¿ä¸Šä»£ç ï¼ŒåŠ¨æ‰‹å®æ“ï¼Œç”šè‡³äºèƒ½å®Œæˆå¯è§†åŒ–è‡ªå®šä¹‰ç‹¬ç‰¹çš„ç®€å†æ¨¡ç‰ˆï½**

## 00. å‰æœŸå‡†å¤‡

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„é¡µé¢å¸ƒå±€å…±åˆ†ä¸ºä¸‰å¤„ï¼š

- å·¦ä¾§ï¼šç‰©æ–™å¸‚åœº
- ä¸­é—´ï¼šå†…å®¹ç”»å¸ƒ
- å³ä¾§ï¼šæ“ä½œåŒº

ä¸€ä¸ªæ“ä½œæµç¨‹åˆ†ä¸ºï¼šä»å·¦ä¾§ç‰©æ–™å¸‚åœºæ‹–æ‹½ä¸€ä¸ªç»„ä»¶è‡³ç”»å¸ƒï¼Œæ¿€æ´»å½“å‰é€‰ä¸­çš„ç»„ä»¶ï¼Œå¯é€šè¿‡å³ä¾§ä¿®æ”¹æ•°å€¼ä»¥è¾¾åˆ°ç»„ä»¶æ ·å¼çš„å®æ—¶æ›´æ–°ã€‚

- åˆå§‹çŠ¶æ€

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d493f3df7474406d8db0025c143c0cb3~tplv-k3u1fbpfcp-watermark.image)

- ç»„ä»¶æ‹–æ‹½è¿›ç”»å¸ƒ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c34d436b8c743148d002d35e078ab73~tplv-k3u1fbpfcp-watermark.image)

- ç»„ä»¶è‡ªç”±ç§»åŠ¨ã€å±‚çº§è¦†ç›–

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/558d5078942f461a979491dc719e3eae~tplv-k3u1fbpfcp-watermark.image)

- ç»„ä»¶å†…å®¹æ›´æ–°ï¼Œæ ·å¼ä¿®æ”¹

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/909af9ad92734bf7b85b8d8ea7c2abe9~tplv-k3u1fbpfcp-watermark.image)

## 01. å¸ƒå±€å®ç°

æ¥ä¸‹æ¥å‡æ˜¯å®ç°è¿‡ç¨‹çš„ä¸€äº›æ€è€ƒï¼Œå…·ä½“åŠ¨æ‰‹å®æ“è¯·ç»“åˆ[github ä»“åº“](https://github.com/PDKSophia/dom-ui-toolbar)ã€‚æ¥ä¸‹æ¥éƒ½ä¸éœ€è¦å°ä¼™ä¼´ä»¬å†™ä»£ç ï¼Œå°ä¼™ä¼´ä»¬åªéœ€è¦ç†è§£å³å¯ï½

æˆ‘ä»¬å…ˆåœ¨ [dom-ui-toolbar](https://github.com/PDKSophia/dom-ui-toolbar) é¡¹ç›®çš„ `src/container` æ–‡ä»¶å¤¹ä¸‹ï¼Œå»ºå¥½ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå¯¹å¤–å¯¼å‡ºç›¸åº”ç»„ä»¶ã€‚

```ts
// å·¦ä¾§ç‰©æ–™å¸‚åœº
export default function Material() {
  return (
    <div styleName="material">
      <div styleName="logo">ç‰©æ–™å¸‚åœº</div>
    </div>
  );
}
```

```ts
// ä¸­é—´ç»„ä»¶ç”»å¸ƒ
export default function WinCenter() {
  return <div styleName="content">ä¸­é—´ç”»å¸ƒ</div>;
}
```

```ts
// å³ä¾§æ“ä½œåŒº
export default function Toolbar() {
  return <div styleName="toolbar">æ“ä½œåŒº</div>;
}
```

ç°åœ¨å…±æœ‰ `Material ç‰©æ–™å¸‚åœº`ã€`Toolbar æ“ä½œåŒº`ã€`WinCenter ä¸­å¿ƒç”»å¸ƒ` ä¸‰å¤§ç»„ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¸ƒå±€ç»„ä»¶æ˜¯è¿™æ ·çš„ã€‚[æºä»£ç ç‚¹å‡»è¿™é‡Œ](https://github.com/PDKSophia/dom-ui-toolbar/blob/master/example/src/index.tsx)

```ts
// https://github.com/PDKSophia/dom-ui-toolbar/blob/master/example/src/index.tsx

import Material from './container/Material';
import Toolbar from './container/Toolbar';
import WinCenter from './container/WinCenter';

function Main() {
  const toolbarRef = useRef(null);
  const materialRef = useRef(null);
  return (
    <React.Fragment>
      <div ref={materialRef} styleName="material">
        <Material />
      </div>
      <div styleName="content">
        <WinCenter />
      </div>
      <div ref={toolbarRef} styleName="action">
        <Toolbar />
      </div>
    </React.Fragment>
  );
}
```

ç°åœ¨æˆ‘ä»¬å®Œæˆäº†å¸ƒå±€ï¼Œå·¦ä¾§ç‰©æ–™å¸‚åœºï¼Œä¸­é—´ç”»å¸ƒï¼Œå³ä¾§æ“ä½œåŒºï¼Œé—­ä¸Šçœ¼ç›ï¼Œè„‘è¡¥ä¸€ä¸‹ï¼Œæ­¤æ—¶é¡µé¢ä¸Šåˆ†ä¸‰å¤§å—ï¼Œä½†éƒ½è¿˜æ˜¯ç©ºç™½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€æ­¥æ­¥è®²è§£å…¶ä¸­çš„åŠŸèƒ½ç‚¹ã€‚

**åœ¨è¿™ä¹‹å‰ï¼Œè¯·å…è®¸æˆ‘ç»™å¤§å®¶çœ‹ä¸€ä¸ªå¤§è‡´çš„æµç¨‹å›¾**

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0d6fd2063e84f6ab0f44f8f8d0058f9~tplv-k3u1fbpfcp-watermark.image)

## 02. ç‰©æ–™å¸‚åœºçš„è®¾è®¡

ææ¸…æ¥šäº†æµç¨‹ä¹‹åï¼Œæ¥ä¸‹æ¥çš„å¼€å‘å°±æ¯”è¾ƒç®€å•äº†ã€‚

æˆ‘ä»¬åœ¨ Material æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å¢äº†ä¸¤ä¸ªç‰©æ–™ç»„ä»¶ï¼š`Button` ä¸ `Text`ï¼Œ

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b84e3851f9f547d29b7e1d2a7f33b058~tplv-k3u1fbpfcp-watermark.image)

å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼Œåœ¨ `Material/index.tsx` ä¸­ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å†™è¿™æ®µä»£ç å‘¢ï¼Ÿç¬¬ä¸€æ—¶é—´æ’¸ä¸‹äº†è¿™æ®µä»£ç 

```js
import Button from './components/Button';
import Text from './components/Text';

function Material() {
  return (
    <div styleName="material">
      <div styleName="logo">ç‰©æ–™å¸‚åœº</div>
      <div styleName="flex">
        <Button />
        <Text />
      </div>
    </div>
  );
}
```

ä½†è¿™æ ·å†™ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿç¬¬ä¸€ï¼Œå¦‚æœä½ æƒ³åšæ‹–æ‹½ç»„ä»¶æ•ˆæœï¼Œé‚£ä¹ˆä½ éœ€è¦åœ¨æ¯ä¸€ä¸ªç»„ä»¶çš„ä»£ç å®ç°ä¸­ï¼Œå†™ä¸€æ®µé‡å¤çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼Œä»¥ `Button` ç»„ä»¶ä¸ºä¾‹

```ts
function Button() {
  return (
    <div
      styleName="btn"
      draggable={true}
      onDragStart={(e) => e.dataTransfer.setData('componentName', 'Button')}
    >
      åŸºç¡€æŒ‰é’®
    </div>
  );
}

export default Button;
```

ç¬¬äºŒï¼Œå½“ä½ å¾€ `Material/components` æ–°å¢ç‰©æ–™ç»„ä»¶æ—¶ï¼Œä½ è¿˜éœ€è¦åˆ°æ ¹ç»„ä»¶å°†æ–°å¢çš„ç»„ä»¶å¼•å…¥ã€‚æ„å‘³ç€ï¼Œæ–°å¢/åˆ é™¤ä¸€ä¸ªç‰©æ–™ï¼Œä½ éƒ½éœ€è¦ä¿®æ”¹ `Material/index.tsx` å…¥å£æ–‡ä»¶ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•è§£å†³ï¼Ÿ

æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼Œå°†æ‰€æœ‰ç‰©æ–™ç»Ÿä¸€ç»è¿‡ `index.ts` ç®¡ç†ï¼Œå¯¹å¤–å¯¼å‡º

```ts
export { default as Button } from './Button';
export { default as Text } from './Text';
```

ç„¶åæˆ‘ä»¬åœ¨ç‰©æ–™å¸‚åœºçš„`Material/index.tsx`å…¥å£æ–‡ä»¶ç¨å¾®ä¿®æ”¹

```ts
import React from 'react';
import './index.less';
import * as ComponentsList from './components';
import MyScrollBox from '@components/Base/MyScrollBox';

function Material() {
  const height = document.body.clientHeight;

  return (
    <div styleName="material">
      <MyScrollBox maxHeight={height}>
        <div styleName="logo">ç‰©æ–™å¸‚åœº</div>
        <div styleName="flex">
          {Object.keys(ComponentsList).map(
            (componentName: string, index: number) => {
              // ğŸ‘‡ è¿™ä¸ªæ˜¯éœ€è¦æ¸²æŸ“çš„ç»„ä»¶å®ä¾‹
              const RenderComponent = ComponentsList[componentName];
              return (
                <div styleName="item" key={`${componentName}_${index}`}>
                  <RenderComponent
                    key={`${componentName}_${index}`}
                    draggable={true}
                    onDragStart={(e: React.DragEvent<HTMLDivElement>, componentRefs?: HTMLDivElement) => {}}
                  />
                </div>
              );
            }
          )}
        </div>
      </MyScrollBox>
    </div>
  );
}

export default Material;
```

ä»¥ä¸Šæ˜¯ç‰©æ–™å¸‚åœºçš„å®ç°ï¼ˆè¿˜æ²¡æœ‰å®ç° `onDragStart()` æ–¹æ³•ï¼‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ä¸­é—´ç”»å¸ƒã€‚

## 03. ç»„ä»¶ç”»å¸ƒè®¾è®¡å®ç°

ä¸­é—´åŒºåŸŸå°±æ˜¯ä¸€ä¸ªâ€œç”»å¸ƒâ€ï¼Œå®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€ç†è§£çš„ `canvas`**ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤§çš„ `div` å…ƒç´ ï¼Œç›¸å¯¹å®šä½ï¼Œæ‰€æœ‰æ‹–æ‹½è¿›æ¥çš„ç»„ä»¶åœ¨è¯¥ç”»å¸ƒä¸Šï¼Œéƒ½æ˜¯ç»å¯¹å®šä½**ã€‚

ç”»å¸ƒç»´æŠ¤ä¸€å¥— `editorComponentList` æ•°ç»„ï¼Œæ¯æ¬¡ä»ç‰©æ–™å¸‚åœºæ‹–æ‹½ç»„ä»¶è¿‡æ¥ï¼Œéƒ½ä¼š push è¿›è¯¥æ•°ç»„ã€‚ç”»å¸ƒè¿›è¡Œæ•°ç»„éå†ï¼Œä»è€Œå±•ç¤ºã€‚ä¸‹é¢çœ‹ä¸€ä¸‹åŸºæœ¬ä»£ç 

```ts
function WinCenter() {
  const { editorComponentList, dispatchAddComponentAction } = useEditorStoreModel();

  return (
    <div styleName="winCenter">
      <div
        styleName="editor-canvas"
        onDrop={(e: React.DragEvent<HTMLDivElement>) => {}}
        onDragOver={(e: React.DragEvent<HTMLDivElement>) => {
          e.preventDefault();
        }}
      >
        <Editor />
      </div>
    </div>
  );
}
```

æˆ‘ä»¬æ¥çœ‹çœ‹ `<Editor />` ç»„ä»¶ä¸»è¦åšäº†ä»€ä¹ˆäº‹æƒ…

```
function Editor() {
  const { editorComponentList } = useEditorStoreModel();

  // ç»„ä»¶éšä¾¿ç§»åŠ¨
  function handleOnMouseDown(e: React.MouseEvent, componentIndex: number) {}

  // ç‚¹å‡»é€‰ä¸­ä¸€ä¸ªç»„ä»¶
  function handleOnComponentClick(e: React.MouseEvent, componentIndex: number) {}

  // ç‚¹å‡»ç”»å¸ƒç©ºç™½åŒºåŸŸ
  function handleUnComponentAreaClick(e: React.MouseEvent) {}
  
  return (
    <div styleName="editor" onMouseDown={handleUnComponentAreaClick}>
      // step1. éå†æ‰€æœ‰åŠ å…¥çš„ç»„ä»¶æ•°ç»„
      {editorComponentList.length > 0 &&
        editorComponentList.map((EditComponent: Types.IStoreComponentProps, componentIndex: number) => {
          return (
            <div
              styleName="wrapper-component"
              key={EditComponent.componentId}
              style={pickStyle(EditComponent.style, ['left', 'top', 'zIndex', 'cursor'])}

              // step2. å…ƒç´ æ‹–æ‹½ï¼Œé¼ æ ‡æŒ‰ä¸‹ä¹‹åçš„å›è°ƒäº‹ä»¶
              onMouseDown={(e: React.MouseEvent) => {
                handleOnMouseDown(e, componentIndex);
              }}

              // step3. ç‚¹å‡»é€‰ä¸­å½“å‰éœ€è¦æ“ä½œçš„ç»„ä»¶
              onClick={(e: React.MouseEvent) => {
                handleOnComponentClick(e, componentIndex);
              }}
            >
              {EditComponent.componentInstance && (
                <EditComponent.componentInstance
                  componentKey={EditComponent.componentId}
                  componentInnerText={EditComponent.componentInnerText}
                  componentStyles={omitStyle(EditComponent.style, ['left', 'top', 'zIndex', 'cursor'])}
                />
              )}
            </div>
          );
        })}
    </div>
  );
}

export default Editor;
```

å¯èƒ½å°ä¼™ä¼´ä»¬è¿˜æ˜¯æœ‰äº›æ‡µï¼Œæˆ‘ä»¬æ¥æ‹ä¸€æ‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ Redux ä¸­å­˜å‚¨ç€ä¸€ä¸ªç»„ä»¶æ•°ç»„ï¼Œå–åä¸º `editorComponentList`ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹å‡ç¬¦åˆ `IStoreComponentProps` ç±»å‹å£°æ˜

```ts
export interface IStoreComponentProps {
  componentId: string; // ç»„ä»¶id
  componentInstance: any; // ç»„ä»¶å®ä¾‹
  style: React.CSSProperties; // ç»„ä»¶æ ·å¼
}
```

ç„¶åæˆ‘ä»¬åœ¨ç‰©æ–™å¸‚åœºæ‹–æ‹½è‡³ç”»å¸ƒæ—¶ï¼Œæˆ‘ä»¬æ‰§è¡Œ `onDragStart()` ä¸­ï¼Œå†™ä¸‹äº†è¿™æ®µä»£ç 

```ts
onDragStart={(e: React.DragEvent<HTMLDivElement>, componentRefs?: HTMLDivElement) => {
  // ğŸ‘‰ step1. ä¼ é€’æ‹–æ‹½ç»„ä»¶å
  e.dataTransfer.setData('componentName', componentName);
  if (componentRefs) {
    const componentStore = {
      ...initComponentStyleStore.Base,
      ...initComponentStyleStore[componentName]
    };
    // ğŸ‘‰ step2. å¾—åˆ°æ‹–æ‹½ç»„ä»¶çš„ style
    const styles = getDomStyle(componentRefs, componentStore);

    // ğŸ‘‰ step3. ä¼ é€’æ‹–æ‹½ç»„ä»¶çš„æ–‡æœ¬å†…å®¹
    e.dataTransfer.setData('componentInnerText', componentRefs.innerText);

    // ğŸ‘‰ step4. ä¼ é€’æ‹–æ‹½ç»„ä»¶çš„æ ·å¼
    e.dataTransfer.setData('componentDomStyle', JSON.stringify(styles));
  }
}}
```

å½“ç»„ä»¶è¿›å…¥åˆ°ç”»å¸ƒï¼Œé¼ æ ‡æ¾å¼€çš„é‚£ä¸€ç¬é—´ï¼Œæˆ‘ä»¬æ‰§è¡Œäº† `onDrop()` æ–¹æ³•ï¼Œæ¥çœ‹çœ‹åšäº†ä»€ä¹ˆ

```ts
onDrop={(e: React.DragEvent<HTMLDivElement>) => {
  // ğŸ‘‰ step1. é˜»æ­¢å†’æ³¡
  e.preventDefault();
  e.stopPropagation();

  // ğŸ‘‰ step2. å¾—åˆ°æ‹–æ‹½ç»„ä»¶å
  const componentName = e.dataTransfer.getData('componentName');

  // ğŸ‘‰ step3. å¾—åˆ°æ‹–æ‹½ç»„ä»¶çš„æ–‡æœ¬å†…å®¹
  const componentInnerText = e.dataTransfer.getData('componentInnerText');

  // ğŸ‘‰ step4. å¾—åˆ°æ‹–æ‹½ç»„ä»¶çš„æ ·å¼
  let componentDomStyle: React.CSSProperties = {};
  try {
    componentDomStyle = JSON.parse(e.dataTransfer.getData('componentDomStyle'));
  } catch (err) {
    componentDomStyle = {};
  }

  // ğŸ’¥ ğŸ‘‰ step5. é€šè¿‡ dispatch action çš„æ–¹å¼ï¼Œå°†æ‹–æ‹½ç»„ä»¶å­˜åˆ° redux ä¸­
  dispatchAddComponentAction(componentName, componentInnerText, {
    ...componentDomStyle,
    left: e.nativeEvent.offsetX,
    top: e.nativeEvent.offsetY,
    // ğŸ‘‡ æ³¨æ„è¿™é‡Œï¼Œå› ä¸ºç»„ä»¶éƒ½æ˜¯ç»å¯¹å®šä½ï¼Œæ‰€ä»¥ç»„ä»¶é—´çš„å±‚çº§å…³ç³»
    // ğŸ‘‡ é€šè¿‡z-indexè¿›è¡Œä¿®æ”¹ï¼Œå…ˆåŠ å…¥çš„ z-index ä½ï¼ŒååŠ å…¥çš„ z-index é«˜
    zIndex: editorComponentList.length
  });
}
```

ä¸Šé¢æ³¨é‡Šå†™çš„éå¸¸æ¸…æ¥šï¼Œè¿™æ—¶å€™æˆ‘ä»¬é€šè¿‡ dispatch äº†ä¸€ä¸ª actionï¼Œå°†æ‹–æ‹½ç»„ä»¶è¿½åŠ åˆ° redux çš„ `editorComponentList`ï¼Œæ¥çœ‹çœ‹è¿™ä¸ª `dispatchAddComponentAction()` åšäº†ä»€ä¹ˆã€‚

```ts
// ğŸ‘‰ step1.å¯¼å…¥æ‰€æœ‰çš„ç‰©æ–™ï¼Œç›®çš„æ˜¯æ‹¿åˆ°å®ä¾‹
import * as ComponentsList from '@container/Material/components';

/**
 * æ·»åŠ ä¸€ä¸ªç»„ä»¶
 * @param componentName ç»„ä»¶å
 * @param componentInnerText ç»„ä»¶æ–‡æœ¬å†…å®¹
 * @param componentStyles ç»„ä»¶è‡ªå®šä¹‰æ ·å¼
 */
const dispatchAddComponentAction = (
  componentName: string,
  componentInnerText?: string,
  componentStyles?: React.CSSProperties
) => {
  // ğŸ‘‰ step2. å¾—åˆ°ç»„ä»¶å®ä¾‹ï¼Œç›®çš„æ˜¯ä¸ºäº†æ¸²æŸ“
  const componentInstance = ComponentsList[componentName];

  // ğŸ‘‰ step3. æ‹·è´ä¸€ä»½ä¹‹å‰çš„ editorComponentList
  let nextStore = cloneDeep(editorComponentList);

  // ğŸ‘‰ step4. è¿½åŠ ä¸€æ¡æ•°æ®
  nextStore.push({
    componentId: createUUid(),
    componentName,
    componentInstance,
    componentInnerText,
    style: componentStyles,
  });
  setEditorComponentList(nextStore);
};
```

æ­¤æ—¶æˆ‘ä»¬åªéœ€è¦åœ¨ç”»å¸ƒä¸­å°† `editorComponentList` å–å‡ºæ¥æ¸²æŸ“å³å¯ã€‚

```ts
{
  editorComponentList.length > 0 &&
    editorComponentList.map(
      (EditComponent: Types.IStoreComponentProps, componentIndex: number) => {
        return (
          <div
            styleName="wrapper-component"
            key={EditComponent.componentId}
            style={pickStyle(EditComponent.style, ['left', 'top', 'zIndex', 'cursor'])}
            onMouseDown={(e: React.MouseEvent) => {
              handleOnMouseDown(e, componentIndex);
            }}
            onClick={(e: React.MouseEvent) => {
              handleOnComponentClick(e, componentIndex);
            }}
          >
            {EditComponent.componentInstance && (
              <EditComponent.componentInstance
                componentKey={EditComponent.componentId}
                componentInnerText={EditComponent.componentInnerText}
                componentStyles={omitStyle(EditComponent.style, ['left', 'top', 'zIndex', 'cursor'])}
              />
            )}
          </div>
        );
      }
    );
}
```

ä»¥ä¸Šæˆ‘ä»¬å°±å®Œæˆäº†ä»ç‰©æ–™å¸‚åœºæ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒæ¸²æŸ“çš„ä¸»æµç¨‹ä¹‹ä¸€ã€‚è¯·æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç”»å¸ƒå®šä½æ˜¯ `relative`ï¼Œç»„ä»¶åœ¨ç”»å¸ƒä¸‹çš„å®šä½æ˜¯ `absolute`ï¼Œé€šè¿‡ `leftã€top` è¿›è¡Œä½ç½®çš„åç§»ï¼Œé€šè¿‡ `z-index` å®ç°åæ‹–æ‹½çš„ç»„ä»¶èƒ½è¦†ç›–åœ¨ä¹‹å‰æ‹–æ‹½çš„ç»„ä»¶ã€‚

## 04. æ“ä½œåŒºçš„å®ç°

ä¸Šé¢æ˜¯å®Œæˆäº† `ç‰©æ–™å¸‚åœº -> ç”»å¸ƒ` çš„å®ç°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å®Œæˆä¸€ä¸‹æ“ä½œåŒºçš„å®ç°ã€‚æ“ä½œåŒºæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…±åˆ†ä¸ºäº”å¤§å—ã€‚

- å¸ƒå±€
- å¡«å……
- æ–‡å­—
- å†…å®¹
- ä»£ç 

```ts
const ToolbarMemo = useMemo(() => {
  if (currentEditorComponent) {
    return (
      <MyScrollBox maxHeight={height}>
        <Layout styles={currentEditorComponent?.style || {}} onUpdateStyles={onUpdateStyles} />
        <Fill styles={currentEditorComponent?.style || {}} onUpdateStyles={onUpdateStyles} />
        {ResourceContentList.includes(currentEditorComponent.componentName) && (
          <Font styles={currentEditorComponent?.style || {}} onUpdateStyles={onUpdateStyles} />
        )}
        {ResourceContentList.includes(currentEditorComponent.componentName) && (
          <Content
            componentInnerText={currentEditorComponent?.componentInnerText || ''}
            onUpdateInnerText={onUpdateInnerText}
          />
        )}
        {currentEditorComponent?.style && (
          <Code styles={currentEditorComponent?.style} />
        )}
      </MyScrollBox>
    );
  } else {
    return <MyEmpty full={false} description="æš‚æ— é€‰ä¸­ç»„ä»¶" />;
  }
}, [currentEditorComponent]);
```

ä¸Šé¢çš„ä»£ç æƒ³å¿…å°ä¼™ä¼´ä»¬éƒ½èƒ½ç†è§£ï¼Œé‚£ä¹ˆ `currentEditorComponent` æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡ŒæŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨ç”»å¸ƒä¸­é¼ æ ‡ç‚¹å‡»é€‰ä¸­çš„ç»„ä»¶ã€‚æˆ‘ä»¬å‰é¢è¯´äº†ï¼Œç”»å¸ƒä¸­çš„ç»„ä»¶æ¸²æŸ“æ˜¯éå† `editorComponentList`ï¼Œè€Œ `editorComponentList` æ•°ç»„æ˜¯åœ¨æˆ‘ä»¬ä»ç‰©æ–™å¸‚åœºæ‹–æ‹½è¿›ç”»å¸ƒæ—¶ï¼Œpush åˆ°æ•°ç»„ä¸­çš„ã€‚

å½“æˆ‘ä»¬é€‰ä¸­ä¸€ä¸ªç»„ä»¶ `currentEditorComponent` åï¼Œå°†å…¶æ•°æ®å­˜è‡³ redux ä¸­ï¼Œç„¶å `<Toolbar />` ç»„ä»¶ç›´æ¥ä» redux ä¸­å–æ•°æ®ï¼Œåšå¯¹åº”çš„æ¸²æŸ“ã€‚

```ts
/**
 * editorComponentList åœ¨éå†æ—¶ï¼Œæ³¨å†Œ onClick äº‹ä»¶
 * è§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œè¡¨ç¤ºé€‰ä¸­å½“å‰ç»„ä»¶ï¼Œè®°å½•å½“å‰ç»„ä»¶
 */
const dispatchSetCurrentEditorComponentAction = (componentIndex: number) => {
  setCurrentEditorComponentIndex(componentIndex);
  setCurrentEditorComponent(editorComponentList[componentIndex]);
};
```

## 05. é€‰ä¸­ç»„ä»¶åŠ¨æ€ä¿®æ”¹ style

å¦‚æœä½ ä»”ç»†çœ‹ä»£ç ï¼Œä¸Šé¢çš„ä»£ç ä½ ä¼šå‘ç°ä¸€ä¸ªå«åš `onUpdateStyles()` çš„æ–¹æ³•ã€‚è®©æˆ‘ä»¬å†æ¥æ‹ä¸€æ‹ã€‚

é¦–å…ˆæˆ‘ä»¬åœ¨ç”»å¸ƒä¼—å¤šç»„ä»¶ä¸­ï¼Œç‚¹å‡»é€‰ä¸­äº†ä¸€ä¸ªç»„ä»¶ï¼Œå°†å…¶å­˜åˆ° reduxï¼Œæ­¤æ—¶æ­¤åˆ»çš„ `currentEditorComponent` æ˜¯å­˜åœ¨æ•°æ®çš„ã€‚åœ¨æ“ä½œç»„ä»¶é‡Œï¼Œæˆ‘ä»¬ä» redux ä¸­å–å‡º `currentEditorComponent` æ•°æ®ï¼Œè¿›è¡Œå±•ç¤ºã€‚

ç”±äºæˆ‘ä»¬çš„æ“ä½œåŒºå‡æ˜¯ç”± `Input` è¾“å…¥æ¡†ç»„æˆï¼Œå½“è¾“å…¥æ¡†å†…å®¹ `onChange` ä¹‹åï¼Œæˆ‘ä»¬å°†ä¿®æ”¹åçš„æ•°æ®è¦†ç›–åŸæœ‰çš„æ•°å€¼ï¼Œä»è€Œè¾¾åˆ°åŠ¨æ€ä¿®æ”¹ style çš„åŠŸèƒ½ã€‚

```ts
const dispatchUpdateComponentStylesAction = (componentStyles: React.CSSProperties) => {
  const nextStore = cloneDeep(editorComponentList);
  const updateComponent = {
    ...nextStore[currentEditorComponentIndex],
    style: { ...componentStyles },
  };
  nextStore[currentEditorComponentIndex] = updateComponent;
  setEditorComponentList(nextStore);
  setCurrentEditorComponent(updateComponent);
};
```

## 06. ç»„ä»¶åœ¨ç”»å¸ƒä¸­éšæ„ç§»åŠ¨

ä¸Šè¾¹æˆ‘ä»¬å®ç°äº† `ç‰©æ–™å¸‚åœº -> æ‹–æ‹½ç»„ä»¶ -> ç”»å¸ƒ -> é€‰ä¸­ç»„ä»¶ -> æ“ä½œåŒºä¿®æ”¹` çš„ä¸»é€»è¾‘ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ç»„ä»¶çš„éšæ„ç§»åŠ¨ã€‚

è¯•æƒ³ä¸€å“ˆï¼Œä½ æ‹–æ‹½ç»„ä»¶æ—¶ï¼Œæ‰‹ä¸€æŠ–ï¼Œå¿ƒä¸€æ…Œï¼Œä¸å°å¿ƒæ¾å¼€äº†é¼ æ ‡ï¼Œç»„ä»¶åœ¨ç”»å¸ƒä¸Šå‡ºç°äº†ä½ç½®åå·®ï¼Œæœ¬æ¥ä½ æƒ³æ‹–åˆ°å³è¾¹çš„ï¼Œä¸å°å¿ƒæ‹–åˆ°äº†å·¦è¾¹ã€‚å’‹æ•´ï¼Ÿ

æ‰€ä»¥æ”¯æŒç»„ä»¶åœ¨ç”»å¸ƒä¸­éšæ„ç§»åŠ¨æ˜¯é‡ä¸­ä¹‹é‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹æ­¤åŠŸèƒ½ã€‚ä¸ºäº†æ›´å¥½çš„ç›´è§‚è¡¨è¾¾ï¼Œé˜¿å®½èŠ±äº†ä¸€å¼ å›¾

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd62677e1a7d484c9d0a8649a66507dd~tplv-k3u1fbpfcp-watermark.image)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç»„ä»¶ä»ä½ç½® A ç§»åŠ¨åˆ° A'

æˆ‘ä»¬åªéœ€è¦çŸ¥é“ç§»åŠ¨ä¹‹åï¼Œ `left'` å’Œ `top'` çš„å€¼ï¼Œç„¶åä¿®æ”¹è¯¥ç»„ä»¶çš„ style å³å¯

è¿™æ˜¯ä¸€é“æ•°å­¦é¢˜ï¼Œå·²çŸ¥ A çš„ clientX å’Œ clientYï¼Œä»¥åŠ left å’Œ topï¼Œå¹¶ä¸”ç°åœ¨æˆ‘ä»¬è¿˜èƒ½çŸ¥é“ A' çš„ clientX' ä¸ clientY'ï¼Œæ±‚ A' çš„ left' å’Œ top'ï¼Œæ€è€ƒä¸€ä¸‹ï¼Œè¯¥å¦‚ä½•è®¡ç®—ï¼Ÿ

```ts
// ç»„ä»¶
<div styleName="editor" onMouseDown={handleUnComponentAreaClick}>
  {editorComponentList.length > 0 &&
    editorComponentList.map(
      (EditComponent: Types.IStoreComponentProps, componentIndex: number) => {
        return (
          <div
            styleName="wrapper-component"
            key={EditComponent.componentId}
            onMouseDown={(e: React.MouseEvent) => {
              handleOnMouseDown(e, componentIndex);
            }}
          >
            // ...
          </div>
        );
      }
    )}
</div>
```

ä¸Šé¢çš„ä¼ªä»£ç åº”è¯¥çœ‹å¾—æ‡‚ï¼Œé‡ç‚¹åœ¨äº `onMouseDown` åšäº†ä»€ä¹ˆäº‹ï¼Œæ¥çœ‹çœ‹ `handleOnMouseDown` å…·ä½“å¹²äº†å•¥ï¼Ÿ

```ts
export default function () {
  const { editorComponentList, dispatchUpdateComponentPositionAction } = useEditorStoreModel();

  return (componentIndex: number, e: React.MouseEvent) => {
    const currentEditComponent: Types.IStoreComponentProps = editorComponentList[componentIndex];

    if (e.button != 0) {
      // å±è”½å·¦é”®ä»¥å¤–çš„æŒ‰é”®
      return;
    }

    // è·å¾—æœ€å¼€å§‹ï¼Œé¼ æ ‡æŒ‰ä¸‹æ—¶çš„å®¢æˆ·ç«¯åŒºåŸŸçš„åæ ‡
    const x = e.clientX;
    const y = e.clientY;

    // è·å¾—å…ƒç´ ä¹‹å‰çš„å®šä½åç§»é‡
    const top = Number(currentEditComponent?.style?.top) || 0;
    const left = Number(currentEditComponent?.style?.left) || 0;

    // æ˜¯å¦é¼ æ ‡æŒ‰ä¸‹
    let isMouseDown = false;

    // è®¾ç½®æ‰‹åŠ¿
    const cursor = 'move';

    const mouseMove = (moveEvent: MouseEvent) => {
      isMouseDown = true;

      // è·å¾—å…ƒç´ ç§»åŠ¨è¿‡ç¨‹ä¸­çš„å®¢æˆ·ç«¯åŒºåŸŸåæ ‡
      const currentX = moveEvent.clientX;
      const currentY = moveEvent.clientY;

      const repaintStyle = {
        ...currentEditComponent.style,
        top: currentY - y + top,
        left: currentX - x + left,
        cursor,
      };

      dispatchUpdateComponentPositionAction(componentIndex, repaintStyle);
    };

    const mouseUp = () => {
      isMouseDown = false;
      document.removeEventListener('mousemove', mouseMove);
      document.removeEventListener('mouseup', mouseUp);
    };
    document.addEventListener('mousemove', mouseMove);
    document.addEventListener('mouseup', mouseUp);
  };
}
```

ä»£ç å‡ ä¹éƒ½æœ‰æ³¨é‡Šï¼Œæˆ‘å°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚

## 07. æ¸…é™¤ç”»å¸ƒ

è¿™å¾ˆç®€å•ï¼Œç‚¹ä¸ªæŒ‰é’®ï¼Œå°† redux ä¸­çš„ `editorComponentList` æ•°æ®æ¸…ç©ºå³å¯ã€‚

```ts
/**
 * æ¸…ç©ºç”»å¸ƒï¼Œæ¸…é™¤æ‰€æœ‰ç»„ä»¶
 */
const dispatchClearTotalComponentAction = () => {
  setEditorComponentList([]);
  setCurrentEditorComponentIndex(-1);
  setCurrentEditorComponent(null);
};
```

## 08. åˆ é™¤æŸä¸€ç»„ä»¶

ç›®å‰åªæ”¯æŒé€‰ä¸­ä¸€ä¸ªç»„ä»¶ï¼Œç‚¹å‡»åˆ é™¤æŒ‰é’®è¿›è¡Œåˆ é™¤ã€‚

```ts
/**
 * ä»æ•°ç»„ä¸­åˆ é™¤ç»„ä»¶
 */
const dispatchDeleteComponentAction = (componentIndex: number) => {
  let nextStore = cloneDeep(editorComponentList);
  nextStore.splice(componentIndex, 1);
  setEditorComponentList(nextStore);
};
```

å¦‚æœä½ æœ‰å…´è¶£ï¼Œä½ å¯ä»¥åšå¤šä¸ªç»„ä»¶çš„åˆ é™¤ï¼Œæ¯”å¦‚å½“æˆ‘æ‘ä½ `commandOrControl` é”®ï¼Œå†ç‚¹å‡»é¼ æ ‡ï¼Œè¿™æ—¶å€™å¯ä»¥é€‰ä¸­å¤šä¸ªè¿›è¡Œåˆ é™¤ã€‚

å†æˆ–è€…ä½ å¯ä»¥é¼ æ ‡å³é”®è¿›è¡Œå¿«æ·åˆ é™¤ã€‚æ²¡æœ‰åšä¸åˆ°çš„ï¼Œåªæœ‰æƒ³ä¸åˆ°çš„ã€‚

## 09. æ’¤é”€

æ’¤é”€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¯´ç™½äº†ä½ åæ‚”äº†ã€‚é‚£å¦‚ä½•å®ç°å‘¢ï¼Ÿä¸å¥½æ„æ€ï¼Œé˜¿å®½è¿˜æ²¡å®ç°æ­¤åŠŸèƒ½ï¼Œä½†æœ‰è¿‡ä¸€äº›æ–¹æ¡ˆçš„å¯¹æ¯”ã€‚æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š

1. å¿«ç…§æ–¹å¼
2. åŠ¨ä½œè®°å½•æ–¹å¼

### å¿«ç…§æ–¹å¼

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88696888b7044ab38120617cc2c7a092~tplv-k3u1fbpfcp-watermark.image)

ä»¥å¿«ç…§æ–¹å¼ï¼Œå­˜å‚¨å½“å‰ç”»å¸ƒçš„å®Œæ•´ä¿¡æ¯ï¼Œè®°å½•æ¯æ¬¡æ“ä½œåçš„å¿«ç…§ï¼Œæ’¤é”€åˆ™ä»¥ä¸Šä¸€æ¬¡å¿«ç…§ä¸ºå‡†è¿›è¡Œæ¢å¤ï¼Œç‰¹ç‚¹æ˜¯ï¼š

- æ•°æ®å­˜å‚¨çš„æ˜¯æ‰€æœ‰ç”»å¸ƒæ•°æ®
- **åœ¨ä¹çš„æ˜¯æœ€ç»ˆçš„ç»“æœ**ï¼Œä»¥ç»“æœè¿›è¡Œçš„å¿«ç…§å­˜å‚¨

é‚£æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå­˜å‚¨çš„å¿«ç…§åªæœ‰ ABC ä¸‰ä¸ªæ•°æ®ï¼ŒæœŸé—´æˆ‘åšäº†æ·»åŠ  DEF æ•°æ®çš„æ“ä½œï¼Œæ­¤æ—¶æ’¤é”€ï¼Œæ¢å¤å¿«ç…§ï¼Œåˆ™åªä¼šæ¢å¤ ABCï¼Œä½†æˆ‘çš„é¢„æœŸæ˜¯æ¢å¤åˆ° ABCDEã€‚å¯èƒ½å°ä¼™ä¼´ä¼šè§‰å¾—ï¼Œä¸ºä»€ä¹ˆåªèƒ½æ¢å¤åˆ° ABC å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬éœ€è¦è€ƒè™‘å¿«ç…§çš„å­˜å‚¨æ—¶é•¿ã€‚ç©¶ç«Ÿæ˜¯ `n/ms` è¿˜æ˜¯ `n/s` éƒ½éœ€è¦ç»è¿‡è€ƒè™‘ã€‚

å®ƒçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç›¸å¯¹ç®€å•ï¼Œé€‚ç”¨æœ¬åœ°ï¼Œä¸é€‚ç”¨äºå¤šäººåä½œï¼ˆè™½ç„¶è¿™é‡Œæˆ‘ä»¬ä¸è€ƒè™‘å¤šäººååŒï¼‰

### åŠ¨ä½œè®°å½•æ–¹å¼

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2eee57f8bdb34894b2b7214ddc23b785~tplv-k3u1fbpfcp-watermark.image)

ä»¥åŠ¨ä½œè®°å½•æ–¹å¼ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰çš„æ¯ä¸€æ¬¡åŠ¨ä½œï¼Œå®šä¹‰ä¸€ä¸ªæ ˆï¼Œæ¯æ¬¡çš„åŠ¨ä½œå‡å…¥æ ˆã€‚åœ¨æˆ‘ä»¬æ‰§è¡Œæ’¤é”€æ“ä½œæ—¶ï¼Œå‡ºæ ˆï¼Œæ‰§è¡Œå¯¹åº”çš„æ’¤é”€äº‹ä»¶å“åº”ï¼Œå¦‚ï¼š

- æˆ‘ä»¬åˆ é™¤äº†ä¸€ä¸ªç»„ä»¶ï¼Œå¯¹åº”çš„ï¼Œåœ¨æ’¤é”€æ—¶ï¼Œæˆ‘ä»¬æ‰§è¡Œæ·»åŠ ç»„ä»¶äº‹ä»¶ï¼ŒæŠŠåˆ é™¤çš„åŠ å›æ¥ï¼Œä»¥è¾¾åˆ°æ¢å¤åŸçŠ¶æ€
- å†æ¯”å¦‚æˆ‘ä»¬æŠŠç»„ä»¶å®½åº¦å˜å¤§ï¼Œå¯¹åº”çš„ï¼Œåœ¨æ’¤é”€æ—¶ï¼Œæˆ‘ä»¬æ‰§è¡Œç¼©å°ç»„ä»¶å®½åº¦ï¼ŒæŠŠå®½åº¦æ”¹å›åŸæ¥çš„å¤§å°ï¼Œä»¥è¾¾åˆ°æ¢å¤åŸçŠ¶æ€
- ......

è¿™ç§æ–¹å¼çš„ç‰¹ç‚¹ä¸»è¦æ˜¯:

1. å­˜å‚¨çš„æ˜¯åŠ¨ä½œï¼Œå¯ä»¥ç»†åŒ–åˆ°ä½ åšäº†ä»€ä¹ˆï¼Œ**åœ¨ä¹çš„æ˜¯è¿‡ç¨‹**ï¼Œç›¸å¯¹å¿«ç…§æ–¹å¼æ›´åŠ é¢—ç²’åŒ–
2. æ¯”è¾ƒå¤æ‚ï¼Œä½†å¯ä»¥åšåˆ°ååŒç¼–è¾‘ï¼Œå¯ä»¥å¤šäººåä½œ(ä½†è¿˜éœ€è¦è€ƒè™‘æ›´å¤šï¼Œæ¯”è¾ƒæ˜¯å¦ä¼šå†²çªç­‰)

ä»¥ä¸Šå°±æ˜¯æ’¤é”€å®ç°çš„ä¸¤ç§æ–¹å¼ï¼Œè™½ç„¶æˆ‘è¿˜æ²¡å®ç°ï¼Œä½†è¿™ä¸¤ç§æ€è·¯ï¼Œå¸Œæœ›èƒ½ç»™å°ä¼™ä¼´ä»¬å¸¦æ¥ä¸€äº›å¸®åŠ©ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»¶ä¼¸ä¸€æ³¢ï¼Œæ‰©å®½ä¸€ä¸‹æ€è·¯ï¼Œæ¯”å¦‚é¢å¤–æŸ¥é˜…èµ„æ–™çœ‹çœ‹å¦‚ä½•å®ç°ååŒç¼–è¾‘ï¼Œå¤šäººåä½œã€‚

## 10. è°ƒæ•´ç»„ä»¶å±‚çº§

æˆ‘ä»¬çš„ç”»å¸ƒæ˜¯ `position: relative`ï¼Œè€Œç»„ä»¶æ˜¯ `position: absolute`ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç»„ä»¶å¯ä»¥åœ¨ç”»å¸ƒä¸­ä»»ä½•å¸ƒå±€å®šä½ï¼Œä½†ç»„ä»¶ä¹‹é—´çš„å±‚çº§å…³ç³»æ˜¯é€šè¿‡ `z-index` æ¥å®ç°çš„ã€‚

ç¬¬ä¸€ä¸ªç»„ä»¶è¢«æ‹–å…¥ç”»å¸ƒï¼Œæ­¤æ—¶ `editorComponentList` é•¿åº¦ä¸º 1ï¼Œè¯¥ç»„ä»¶çš„ `z-index` ä¸º 1ï¼›ç¬¬äºŒä¸ªç»„ä»¶è¢«æ‹–å…¥ï¼Œ`editorComponentList` é•¿åº¦ä¸º 2ï¼Œè¯¥ç»„ä»¶çš„ `z-index` ä¸º 2ï¼›ä»¥æ­¤ç±»æ¨ï¼Œä½†**äººæ€»æ˜¯ä¸æ»¡è¶³äºç°çŠ¶**ã€‚è¯´ç™½äº†å°±æ˜¯ jianï¼Œæˆ‘å°±æƒ³æŠŠç¬¬ä¸€ä¸ªç»„ä»¶çš„ `z-index` å±‚çº§æå‡ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

å¾ˆç®€å•ï¼Œåªéœ€è¦å¤„ç† `z-index` å³å¯ï¼Œé‚£ä¹ˆå¦‚ä½•æå‡ï¼Ÿè¿™å°±å¾—ä½ è‡ªå·±å®ç°äº†ã€‚

> æ¯”å¦‚ editorComponentList = [a, b, c]ï¼Œå¯¹åº”çš„å±‚çº§å…³ç³»å°±æ˜¯ zIndex = [a, b, c]ï¼Œä½ æƒ³æŠŠ a çš„å±‚çº§æå‡ï¼Œä½ å¯ä»¥æŠŠæ•°ç»„é¡ºåºæ”¹å˜ä¸€ä¸‹ï¼Œå˜æˆ [b, c, a]ï¼Œå½“ç„¶è¿™åªæ˜¯å…¶ä¸­çš„ä¸€ç§æ–¹æ¡ˆã€‚

## 11. æ ‡çº¿

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d38a07c9572444c794afec4d354f1806~tplv-k3u1fbpfcp-watermark.image)

ç±»ä¼¼ä¸Šè¿°æ•ˆæœï¼Œå°±æ˜¯ A ç»„ä»¶ä¸åŠ¨ï¼Œæˆ‘ä»¬æ‹–æ‹½ B ç»„ä»¶ï¼Œå½“ B ç»„ä»¶è·Ÿ A ç»„ä»¶å·¦å¯¹é½ã€å³å¯¹é½ã€ä¸Šå¯¹é½ã€ä¸‹å¯¹é½ç­‰ï¼Œæˆ‘ä»¬å°±ä¼šå‡ºç°ä¸€æ¡è¾…åŠ©çº¿ã€‚

é‚£ä¹ˆå¦‚ä½•å®ç°å‘¢ï¼Ÿ

å¾ˆç®€å•ï¼Œå½“ A ç»„ä»¶å›ºå®šï¼ŒB ç»„ä»¶æ‹–æ‹½è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…¶å®éƒ½èƒ½çŸ¥é“æ¯ä¸ªç»„ä»¶çš„ xã€yï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªåˆ¤æ–­ã€‚åˆ¤æ–­å®ƒä»¬æ˜¯å¦å­˜åœ¨å¯¹é½ã€‚

```js
// å·¦å¯¹é½
A.x = B.x

// å³å¯¹é½
A.x + A.width = B.x + B.width

// ä¸Šå¯¹é½
A.y = B.Y

// ä¸‹å¯¹é½
A.y + A.height = B.y + B.height
```

å¦‚æœå¤åˆæ¡ä»¶ï¼Œé‚£ä¹ˆå°±ç°å®ä¸€æ¡è¾…åŠ©çº¿åœ¨è¯¥ (x, y) ä¸Šå³å¯ã€‚

å¦‚æœä½ è¿˜æœ‰ç–‘é—®ï¼Œé‚£ä¹ˆå†çœ‹çœ‹ï¼Œå†æƒ³æƒ³ï¼Œæ‹ä¸€æ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆä¸ªæ„æ€ã€‚

## 12. å¸é™„

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94331b906a314bc68d08f37bf8b2e562~tplv-k3u1fbpfcp-watermark.image)

å¦‚å›¾ï¼Œæ­¤æ—¶æˆ‘ B ç»„ä»¶ç»§ç»­å¾€å·¦è¾¹æ‹–ï¼ˆå›¾ä¸€ï¼‰ï¼Œé‚£ä¹ˆä¼šå‡ºç° B ç»„ä»¶ç´§å¸é™„åœ¨ A ç»„ä»¶ä¸Šï¼ˆå›¾äºŒï¼‰ï¼Œé‚£è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ

æˆ‘ä»¬é¢„å…ˆå®šå¥½ä¸€ä¸ªå€¼ `distance = 5`ï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªç»„ä»¶åœ¨è·ç¦»å°äº `distance` æ—¶ï¼Œå°±éœ€è¦è‡ªåŠ¨å¸é™„ã€‚

å‡è®¾æˆ‘ä»¬ç°åœ¨ A å’Œ B çš„ xã€y å‡ä¸º 0ï¼Œå®½åº¦å‡ä¸º 50ï¼Œæ­¤æ—¶å®ƒä»¬é‡å åœ¨äº†ä¸€å—ã€‚

```ts
// A ç»„ä»¶
A = (0, 0);

// B ç»„ä»¶
B = (0, 0);
```

å½“æˆ‘ä»¬æ‹–æ‹½ç»„ä»¶ B æ—¶ï¼ŒB çš„åæ ‡å˜ä¸º `(54, 0)`ã€‚

```ts
// A ç»„ä»¶
A = (0, 0);

// B ç»„ä»¶
B = (54, 0);
```

è¿™æ—¶å€™æŒ‰é“ç†æ¥è®²ï¼ŒA å’Œ B çš„ä½ç½®åº”è¯¥å¦‚ä¸Šå›¾çš„å·¦è¾¹å›¾ä¸€æ‰€ç¤ºï¼Œä¸­é—´ç•™æœ‰ 4 åƒç´ çš„è·ç¦»ï¼Œä½†æ­¤æ—¶ï¼Œç”±äº `B.x - A.width <= distance`ï¼Œä¹Ÿå°±æ˜¯ `54 - 50 <= 5`ï¼Œæˆ‘ä»¬å°±èƒ½è®¤ä¸ºè¿™ä¸¤ä¸ªç»„ä»¶é çš„å¾ˆè¿‘äº†ï¼Œåº”å½“å®ç°å¸é™„æ•ˆæœã€‚æ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨å°† B ç»„ä»¶çš„åæ ‡æ”¹ä¸º `B = (50, 0)`ï¼Œè¿™æ ·å°±å°† AB ç»„ä»¶å¸é™„åœ¨ä¸€å—ï¼Œä¸åˆ†ç¦»äº†ã€‚

## æœ€å

è¿˜æœ‰å¾ˆå¤šåŠŸèƒ½ç‚¹å€¼å¾—å»è®²ï¼Œæ¯”å¦‚ `ç»„ä»¶æ‹‰ä¼¸æ”¾å¤§ç¼©å°`ã€`ç»„ä»¶æ—‹è½¬` ç­‰ï¼Œå†æ›´å¤šçš„å¯ä»¥æ‰©å±•ï¼Œå»åšç¦»çº¿ç¼“å­˜ï¼ŒååŒç¼–è¾‘ã€‚

> ç¦»çº¿ç¼“å­˜ï¼šæ¯”å¦‚ä½ åšçš„æ˜¯ä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼ˆæˆ–è€…æ˜¯ä¸€äº›ç¬”è®°ç­‰ï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾è®¡å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ä¸­ï¼Œä½ å¯èƒ½é‡‡ç”¨æœ¬åœ°æ–‡ä»¶è¯»å†™å­˜å‚¨ã€FIleSystem APIã€IndexDB ç­‰æ–¹æ¡ˆï¼Œå¦‚ä½•æ‹©é€‰å¦‚ä½•è®¾è®¡ï¼Ÿæ•°æ®ç»“æ„å¦‚ä½•å®šä¹‰ï¼Ÿè¿å…¥ç½‘ç»œä¹‹åçš„æœ¬åœ°æ•°æ®åŒæ­¥åˆ°äº‘ç«¯ï¼Ÿäº‘å‚¨å­˜åŒæ­¥æ–¹æ¡ˆå¦‚ä½•å®ç°ï¼ŸåŒæ­¥è¿‡ç¨‹å‡ºç°å†²çªï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

> ååŒç¼–è¾‘ï¼šä¸¤ä¸ªäººåŒæ—¶æ“ä½œå¦‚ä½•å¤„ç†ï¼Œæ¯”å¦‚ A åœ¨å¤„ç†å›¾è°±æ—¶ï¼ŒB çš„æ•´ä¸ªç”»å¸ƒè¢«ç¦æ­¢ä¸å…è®¸æ“ä½œè¿˜æ˜¯è¯´ B ä¹Ÿèƒ½åŒæ—¶å¤„ç†å›¾è°±ï¼Ÿå¦‚æœç¦æ­¢ B æ“ä½œåˆ™ä½“éªŒä¸ä½³ï¼Œå…è®¸ B æ“ä½œé‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†æ“ä½œèŒƒå›´ï¼Ÿæ¯”å¦‚å›¾è°±ä¸¤ä¸ªåŒçº§èŠ‚ç‚¹ï¼ŒA å¤„ç† Node1ï¼Œé‚£ä¹ˆ B æ˜¯ä¹Ÿèƒ½å¤„ç† Node1 è¿˜æ˜¯ Node1 è¢«é”ç½®ç°ï¼Œåªèƒ½å¤„ç† Node2ï¼ŸåŒæ­¥è¿œç«¯æ•°æ®å‡ºç°å†²çªå¦‚ä½•å¤„ç†ï¼Ÿ

æˆ‘è®¤ä¸ºè¿™äº›éƒ½æ˜¯å€¼å¾—å»æ¢ç´¢å»ç ”ç©¶çš„ï¼Œå³ä½¿æœ€åæˆ‘ä»¬æ²¡èƒ½åšå‡ºæ¥ï¼Œæˆ–è€…åšäº†ä¸€ä¸ª bug å¾ˆå¤šåŠæˆå“ï¼Œä½†åœ¨è¿‡ç¨‹ä¸­æˆ‘ä»¬å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚

æœ€åï¼Œæˆ‘æ²¡æœ‰è®²è§£å¦‚ä½•å»å®ç°ä¸€ä»½å¯è§†åŒ–è‡ªå®šä¹‰çš„ç®€å†æ¨¡ç‰ˆï¼Œæˆ‘è®¤ä¸ºæœ€æ ¸å¿ƒé‡è¦çš„æ˜¯å¦‚ä½•å®ç°æœ€åŸºç¡€çš„æµç¨‹ï¼Œä¸‡å˜ä¸ç¦»å…¶å®—ã€‚

å¸Œæœ›å°ä¼™ä¼´ä»¬çœ‹å®Œè¿™ç« èŠ‚ä¹‹åï¼Œèƒ½ç»“åˆ âœ¨ [dom-ui-toolbar](https://github.com/PDKSophia/dom-ui-toolbar) æ­ä¸€ä¸ªç®€å•çš„å°å¹³å°ï¼Œå»æŠ˜è…¾ï¼Œå»ç©ä¸€ä¸‹ã€‚
