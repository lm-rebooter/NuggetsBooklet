## å‰è¨€

æˆ‘ä»¬æ¥çœ‹çœ‹ç”Ÿäº§æ„å»ºæ‰“åŒ…æ—¶ï¼ŒèŠ±è´¹äº†å¤šé•¿æ—¶é—´ï¼Ÿ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1cd0d5415034b6fbd0887920c027dfe~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e021fa76834a4278ba79bcc9f8be645e~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ca2c16ede134088bd59caf82f0ce784~tplv-k3u1fbpfcp-watermark.image)

ä»¥ä¸Šæ˜¯å…¶ä¸­ä¸€æ¬¡çš„æˆªå›¾ï¼Œç»è¿‡æˆ‘å¤šæ¬¡çš„éªŒè¯ï¼ˆä¹Ÿå°±ä¸‰äº”æ¬¡ï¼‰ï¼Œæ€»ç»“å‡ºå¹³å‡ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæ‰“åŒ…æ—¶é•¿ä¸ºï¼š`18s ~ 23s`ï¼Œè¿™æ—¶é—´å¾ˆé•¿äº†ï¼Œä½ æƒ³æƒ³ï¼Œä½ æ‰“åŒ…æ„å»ºä¸€æ¬¡ `npm run build:render`ï¼Œè¦ç­‰ 20sï¼Œè¿™è°é¡¶å¾—ä½å•Šã€‚ä¸ºæ­¤ï¼Œæœ¬ç« èŠ‚å°†ä¼šåšä¸€äº› `webpack` æ‰“åŒ…æ–¹é¢çš„ä¼˜åŒ–ã€‚å¦‚æœä½ å¯¹æœ¬ç« èŠ‚å†…å®¹å…´è¶£ä¸å¤§ï¼Œå¯ä»¥å¿«é€Ÿé˜…è¯»æˆ–è·³è¿‡ã€‚

## ä¼˜åŒ–æ–¹æ¡ˆ

### ğŸ”¨ ä¼˜åŒ–ä¸€ï¼šå¼€å‘/ç”Ÿäº§åŒºåˆ†å¼€

æˆ‘ä»¬è¦åŒºåˆ†å‡ºä¸¤å¥—ä¸åŒé…ç½®ï¼Œå› ä¸ºä¸€äº›é…ç½®åœ¨å¼€å‘é˜¶æ®µæ˜¯ä¸éœ€è¦å»åšçš„ï¼Œä½ éœ€è¦åˆ†è¾¨å¥½å“ªäº›å·¥ä½œä»…åœ¨å¼€å‘æ—¶è¦åšï¼Œå“ªäº›å·¥ä½œæ˜¯ç”Ÿäº§æ—¶è¦åšã€‚æ¯”å¦‚å¼€å‘ç¯å¢ƒä¸‹ï¼Œä»£ç å‹ç¼©ã€ æå– CSS ç­‰å·¥ä½œå°±æ²¡å¿…è¦äº†ã€‚

å¾ˆåº†å¹¸ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±åŒºåˆ†äº†ç¯å¢ƒï¼Œå¦‚ `webpack.xxx.dev.js`ã€`webpack.xxx.prod.js` ç­‰ï¼Œä¸åŒç¯å¢ƒåšä¸åŒçš„äº‹æƒ…ã€‚æ‰€ä»¥å°ä¼™ä¼´ä»¬è®°ä½äº†ï¼Œä¹‹ååœ¨ä½ å†™ä»£ç åšéœ€æ±‚æ—¶ï¼Œè¦æœ‰åŒºåˆ†ä¸åŒç¯å¢ƒçš„æ„è¯†ã€‚

### ğŸ”¨ ä¼˜åŒ–äºŒï¼šé€‚å½“é…ç½® loaderï¼ˆé™ä½ loader çš„ä½¿ç”¨é¢‘ç‡ï¼‰

æˆ‘ä»¬æ‘˜ä¸€å°æ®µ `webpack.render.base.js` çš„ä»£ç å‡ºæ¥çœ‹çœ‹

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
        },
      },
    ],
  },
};
```

è¿™æ®µé…ç½®æ˜¯åˆç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬é…ç½®äº† `exclude`ï¼Œå®ƒè¡¨ç¤ºæˆ‘ä»¬å¯¹äº `js|jsx|ts|tsx` ç±»å‹æ–‡ä»¶çš„å¤„ç†ï¼Œæ˜¯æ’é™¤æ‰ `node_modules` ç›®å½•æ–‡ä»¶å¤¹çš„ã€‚

å¯èƒ½å°ä¼™ä¼´ä¸å¤ªæ˜ç™½ï¼Œæˆ‘æ¢ç§è¯´æ³•ï¼Œåœ¨ `node_modules` ä¸­è‚¯å®šä¼šå­˜åœ¨è®¸å¤š `jsã€jsxã€tsã€tsx` æ–‡ä»¶ï¼Œå‡è®¾æˆ‘ä»¬è¿™æ—¶å€™ä¸é…ç½® `exclude` å±æ€§ï¼Œä¸å°† `node_modules` æ’é™¤å‡ºå»ï¼Œé‚£ä¹ˆä¸‹é¢è¿™æ®µä»£ç ï¼Œä½ çŒœåœ¨å¼€å‘æ—¶ï¼Œwebpack ä¼šä¸ä¼šå°†å…¶å†æ¬¡ç¼–è¯‘å‘¢ï¼Ÿ

```js
import RcReduxModel from '../node_module/dist/index.js';
// åˆæˆ–è€…æ˜¯
import lodash from 'lodash/index.js';
```

ç­”æ¡ˆæ˜¯ä¼šçš„ï¼è™½ç„¶è¯´ä¸ä¼šæŠ¥é”™ï¼Œä½†æ²¡å¿…è¦ï¼Œè¦çŸ¥é“ `node_modules` ä¸­çš„åŒ…éƒ½å·²ç»è¿‡æ‰“åŒ…ç¼–è¯‘ï¼Œæ­¤æ—¶å†è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ï¼Œæ²¡ä»»ä½•æ„ä¹‰ï¼Œåè€Œä¼šé™ä½é€Ÿåº¦ã€‚

å¦‚æœä½ ä¸ä¿¡ï¼Œä½ å¯ä»¥å°† `webpack.render.base.js` ä¸­å¸¦æœ‰ `exclude` çš„ loader éƒ½æ³¨é‡Šæ‰ï¼Œç„¶åè·‘ä¸€ä¸‹ `npm run start:render`ï¼Œä½ ä¼šå‘ç°é€Ÿåº¦å˜æ…¢ï¼

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/071809bce9ea4c719fca6026de4d7c06~tplv-k3u1fbpfcp-watermark.image)

ä¸ `exclude` ç›¸åçš„æ˜¯ `include`ï¼Œä½ å¯é€šè¿‡è¿™ä¸¤ä¸ªå±æ€§ `exclude + include` çš„å®Œç¾ç»“åˆï¼Œä»è€Œé™ä½ loader æ‰§è¡Œçš„é¢‘ç‡ï¼Œæ¯•ç«Ÿ loader åšè½¬æ¢ä¹Ÿéœ€è¦æ¶ˆè€—ä¸€å®šæ—¶é—´ã€‚é€šè¿‡è¿™ç§æ–¹å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½æé«˜ js æ¨¡å—çš„æ‰“åŒ…é€Ÿåº¦ã€‚

è¿™æ—¶å€™å°ä¼™ä¼´å°±è¯´äº†ï¼Œæˆ‘çœ‹ `webpack.render.base.js` ä¸­ï¼Œè¿™ä¸ª `file-loader` æ²¡æœ‰æ·»åŠ è¿™ä¸ª `exclude` å±æ€§ï¼Œæˆ‘è¦ä¸ä¹Ÿæ·»åŠ ä¸€ä¸‹å§ï¼Ÿ

```js
// webpack/webpack.render.base.js

module.exports = {
  module: {
    rules: [
      {
        test: /\.(jpg|png|jpeg|gif)$/,
        use: [
          {
            loader: 'file-loader',
            options: {
              name: '[name]_[hash].[ext]',
              outputPath: 'images/',
            },
          },
        ],
      },
    ],
  },
};
```

è¿™ä¸ªå°±ä¸éœ€è¦æ·»åŠ äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆå®ƒä¸åƒ js é‚£æ ·æœ‰äº‹å…ˆæ‰“åŒ…ç¼–è¯‘è¿‡çš„æ–‡ä»¶ï¼ˆå¯ä»¥ä¸ç”¨åšäºŒæ¬¡ç¼–è¯‘ï¼‰ï¼Œå®é™…ä¸Šï¼Œä½ æ‰€æœ‰çš„å›¾ç‰‡èµ„æºæ–‡ä»¶ï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œéƒ½éœ€è¦ç»è¿‡ `file-loader` å»è¿›è¡Œè½¬æ¢ï¼Œå°†å…¶æ‰“åŒ…åˆ° dist ç›®å½•ä¸‹ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚è¿™æ—¶å€™ä½ åŠ ä¸åŠ æ„ä¹‰ä¸å¤§ã€‚

> è¿™æ—¶å°±ä¼šæœ‰å°ä¼™ä¼´æé—®äº†ï¼Œé‚£æˆ‘å¦‚æœç”¨äº†ä¸€å¼ ç¬¬ä¸‰æ–¹åŒ…å†…éƒ¨çš„å›¾ç‰‡æ–‡ä»¶å‘¢ï¼Ÿæ¯”å¦‚æˆ‘å°±æ˜¯ `import Avatar from 'node_module/a/dist/images/avatar.[hash].png'`ï¼Œé‚£è¿™æ—¶å€™ä¼šæœ‰é—®é¢˜å—ï¼Ÿå¯¹äºæ­¤é—®é¢˜ï¼Œæˆ‘æƒ³ï¼Œä½ åŠ¨æ‰‹å®è·µåï¼Œæ–¹å¯è‡ªå·±è§£ç­”ã€‚

**æ€»ä¹‹ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ª loader éƒ½éœ€è¦æ·»åŠ  `exclude/include`ï¼Œå…·ä½“è¦çœ‹åœºæ™¯å’Œå“ªç§èµ„æºç±»å‹ï¼Œè®°ä½ä¸€ç‚¹ï¼Œåˆç†ä½¿ç”¨ loaderï¼Œç¡®å®èƒ½é™ä½ webpack ç¼–è¯‘çš„é€Ÿåº¦ã€‚**

### ğŸ”¨ ä¼˜åŒ–ä¸‰ï¼šå¯»æ‰¾å¹³è¡¡ï¼Œä»¥ url-loader æ›¿ä»£ file-loader

é€šè¿‡å®˜æ–¹æ–‡æ¡£å¾—çŸ¥ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ [file-loader](https://www.webpackjs.com/loaders/file-loader/) ä¸ [url-loader](https://www.webpackjs.com/loaders/url-loader/) å®Œæˆå¯¹ Webpack ç¼–è¯‘å›¾ç‰‡èµ„æºçš„é…ç½®ã€‚

> Webpack å®˜ç½‘æ˜ç¡®è¯´æ˜ï¼š`url-loader`Â  åŠŸèƒ½ç±»ä¼¼äº Â [`file-loader`](https://github.com/webpack-contrib/file-loader)ï¼Œä½†æ˜¯åœ¨æ–‡ä»¶å¤§å°ï¼ˆå•ä½ byteï¼‰ä½äºæŒ‡å®šçš„é™åˆ¶æ—¶ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ª DataURLã€‚

ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ`url-loader` åŠŸèƒ½æ˜¯åŸºäº `file-loader` ä¹‹ä¸Šï¼Œåªæ˜¯åœ¨ options é…ç½®å¤„ï¼Œå¤šäº†ä¸€ä¸ª `limit` å±æ€§ï¼Œè¿™å°±å¾ˆæœ‰æ„æ€äº†ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡åŠ¨æ‰‹å®è·µï¼Œæ”¹å†™ä¸€ä¸‹æˆ‘ä»¬çš„å°å†Œé…ç½®ã€‚

å…ˆå»å®‰è£… `url-loader`

```bash
npm install --save-dev url-loader
```

ç„¶åå°† `webpack/webpack.render.base.js` æ”¹æˆä¸‹é¢è¿™æ ·

```js
// webpack/webpack.render.base.js

module.exports = {
  module: {
    rules: [
      {
        test: /\.(jpg|png|jpeg|gif)$/,
        use: [
          {
            // ğŸ‘‡ æ¢æˆ url-loader
            loader: 'url-loader',
            options: {
              limit: 2048,
              name: '[name]_[hash].[ext]',
              outputPath: 'images/',
            },
          },
        ],
      },
    ],
  },
};
```

è¿™é‡Œæˆ‘ä»¬è®¾ç½® `limit = 2048`ï¼Œæ„å‘³ç€å½“å›¾ç‰‡å°äº 2kb æ—¶ï¼Œå›¾ç‰‡ä¼šè‡ªåŠ¨è½¬æˆ base64 æ ¼å¼ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼ä¸€èµ·æ‰“åŒ…åˆ° js æ–‡ä»¶ä¸­ï¼Œä»è€Œå‡å°‘å›¾ç‰‡è¯·æ±‚çš„æ•°é‡ï¼Œè¿›è€Œæå‡æ€§èƒ½ã€‚è€Œå¤§äº 2kb çš„å›¾ç‰‡ï¼Œ`url-loader` å¤„ç†ä¸äº†ï¼Œè½¬æ‰‹ç”©ç»™ `file-loader` å»å¤„ç†ã€‚ï¼ˆæ‰€ä»¥è¯´ url-loader æ˜¯åŸºäº file-loader ä¹‹ä¸Šï¼‰

æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œå°† `file-loader` æ”¹æˆ `url-loader` ä¹‹åçš„ä¸€äº›å˜åŒ–ï¼Œç”±äºæˆ‘ä»¬æœ¬åœ°æ˜¯é‡‡ç”¨ `webpack-dev-server` èµ·çš„æœåŠ¡ï¼Œæ‰€ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸‹çš„ dist ç›®å½•æ˜¯çœ‹ä¸åˆ°ç¼–è¯‘åçš„æ–‡ä»¶ï¼Œå› ä¸ºç¼–è¯‘åçš„æ–‡ä»¶éƒ½ä¿å­˜åˆ°äº†å†…å­˜å½“ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬è·‘ `npm run build:render` æ¥çœ‹çœ‹å¯¹æ¯”

- **é‡‡ç”¨ file-loader**

æ­¤æ—¶ä¼šæœ‰å¾ˆå¤šå›¾ç‰‡èµ„æºè¢«æ‰“åŒ…åˆ° `dist/images` æ–‡ä»¶å¤¹ä¸‹ï¼Œå…± 12 å¼ å›¾ç‰‡

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dde539f31cb643208a13bbee6e837726~tplv-k3u1fbpfcp-watermark.image)

æˆ‘ä»¬å» `index.[hash].js` æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ä¸€ä¸‹ `base64` å…³é”®å­—ï¼Œåªèƒ½æ‰¾åˆ° 20 æ¡è®°å½•

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7dafbf4555f842d6ab6c354a52b071e4~tplv-k3u1fbpfcp-watermark.image)

- **url-loader**

å¾ˆæ˜æ˜¾ï¼Œdist ç›®å½•ä¸‹çš„ `dist/images` æ–‡ä»¶å¤¹ï¼Œä¸€ä¸‹å­å°‘äº†å¥½å¤šå›¾ç‰‡ï¼Œç°åœ¨åªæœ‰ 4 å¼ å›¾ç‰‡

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db31f0ba81b044848d277df0687ea339~tplv-k3u1fbpfcp-watermark.image)

æˆ‘ä»¬å» `index.[hash].js` æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ä¸€ä¸‹ `base64` å…³é”®å­—ï¼Œæ‰¾åˆ° 28 æ¡è®°å½•

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffea1733fb3f492fbed86ef5291d12d8~tplv-k3u1fbpfcp-watermark.image)

å½“ç„¶ä¹Ÿä¸æ˜¯ä¸€å®šè¯´ `url-loader` ç‰›é€¼è¿‡ `file-loader`ï¼Œè¿™æ›´æ˜¯ä¸€ä¸ªå–èˆè¿‡ç¨‹ã€‚

- æ¯”å¦‚ä½ è®¾ç½® limit è¿‡å¤§ï¼Œå°±ä¼šå¯¼è‡´å›¾ç‰‡è½¬æˆ base64 åï¼ŒåŠ å…¥åˆ°æ‰“åŒ…å¥½åˆ° js æ–‡ä»¶ä¸­ï¼Œè¿™æ— å¼‚å¢å¤§ js çš„ä½“ç§¯ã€‚
- æ¯”å¦‚ä½ é€šè¿‡ url-loader ä¸€æ¬¡æ€§å°†å›¾ç‰‡éƒ½è½¬æˆ base64 æ‰“åŒ…è¿› js æ–‡ä»¶ï¼Œè¿™äº›å›¾ç‰‡æ— æ³•åšåˆ°æŒ‰éœ€åŠ è½½

**æ€»ä¹‹ï¼Œå†³å®šæƒåœ¨ä½ æ‰‹ä¸­ï¼Œä½ éœ€è¦æ‰¾åˆ°èµ„æºå¤§å°ä¸è¯·æ±‚æ•°é‡ä¹‹é—´çš„ä¸€ä¸ªå¹³è¡¡ã€‚**

### ğŸ”¨ ä¼˜åŒ–å››ï¼šresolve æŸ¥æ‰¾æ–‡ä»¶åç¼€çš„é…ç½®

ä»¥ `webpack/webpack.render.base.js` ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ‘˜æŠ„ä¸€ä¸‹ resolve çš„ä»£ç ç‰‡æ®µ

```js
// webpack/webpack.render.base.js

module.exports = {
  resolve: {
    extensions: ['.js', '.jsx', '.ts', '.tsx'],
  },
};
```

è§£è¯»ä¸€ä¸‹è¿™æ®µä»£ç ï¼Œ`resolve` é…ç½® Webpack å¦‚ä½•å¯»æ‰¾æ¨¡å—æ‰€å¯¹åº”çš„æ–‡ä»¶ã€‚æˆ‘ä»¬é…ç½®äº† [extensions](https://webpack.js.org/configuration/resolve/#resolveextensions)ï¼Œè¡¨ç¤ºåœ¨å¯¼å…¥è¯­å¥ä¸­æ²¡å¸¦æ–‡ä»¶åç¼€æ—¶ï¼ŒWebpack ä¼šè‡ªåŠ¨å¸¦ä¸Šåç¼€å»å°è¯•è®¿é—®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚

æˆ‘ä»¬é…ç½®ä¸­ï¼Œé…ç½®äº† `extensions: ['.js', '.jsx', '.ts', '.tsx']`ï¼Œæ„å‘³ç€å½“é‡åˆ° `import A from './A'` æ—¶ï¼Œä¼šå…ˆå¯»æ‰¾ `A.js`ã€æ‰¾ä¸åˆ°å°±å»æ‰¾ `A.jsx`ï¼Œä¹‹åä¾æ¬¡æ‰¾ `A.ts`ã€å†åˆ° `A.tsx`ï¼Œæœ€åè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°±ä¼šæŠ¥é”™ã€‚

è¿™æ˜¯åˆç†çš„ï¼Œä½†æ˜¯æ€»ä¼šæœ‰ä¸€äº›å°ä¼™ä¼´å¿ƒç”Ÿæ­¹å¿µï¼Œçœ‹åˆ°å¯ä»¥è¿™ä¹ˆå†™ï¼Œç„¶åå°±æƒ³ï¼Œæˆ‘èƒ½ä¸èƒ½è¿™ä¹ˆé…å‘¢ï¼Ÿ

```js
// webpack/webpack.render.base.js

module.exports = {
  resolve: {
    extensions: ['.less', '.png', '.jpg', '.gif', '.js', '.jsx', '.ts', '.tsx'],
  },
};
```

è¿™æ ·åœ¨å¼•å…¥æ–‡ä»¶æ—¶ï¼Œæˆ‘éƒ½ä¸ç”¨å†™åç¼€äº†ï¼Œå¤šçˆ½å•Šï¼Œä½†ä½ æƒ³æƒ³ï¼Œä½ è¦å†™æˆè¿™é¬¼æ ·ï¼Œæ¯æ¬¡ä½ å¼•å…¥æ–‡ä»¶æ—¶ï¼Œä½ éƒ½éœ€è¦é€šè¿‡ fs æ–‡ä»¶ç³»ç»Ÿå»ä¸€æ¬¡æ¬¡çš„æŸ¥æ‰¾åŒ¹é…ï¼ŒæŸ¥æ‰¾ `.less` æ—¶ï¼Œè°ƒç”¨ Node åº•å±‚çš„èƒ½åŠ›ï¼ŒæŸ¥æ‰¾ä¹Ÿè€—æ—¶ï¼Œå‘ç°æ‰¾ä¸åˆ° `.less` åç¼€çš„æ–‡ä»¶ï¼Œå†å»æ‰¾ `.png` åç¼€çš„æ–‡ä»¶ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå†™çš„è¶Šå¤šï¼Œè°ƒç”¨åº•å±‚æ¬¡æ•°è¶Šå¤šï¼ŒæŸ¥æ‰¾æ›´è€—æ—¶ï¼Œå¯¼è‡´ Webpack çš„ç¼–è¯‘é€Ÿåº¦æ›´æ…¢ã€‚

è¿™é‡Œå°±ä¸è´´å›¾æ¼”ç¤ºäº†ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥ç§ä¸‹ä¿®æ”¹ `extensions` çš„é…ç½®ï¼Œå¯¹æ¯”ä¸€ä¸‹æ—¶é•¿ã€‚

### ğŸ”¨ ä¼˜åŒ–äº”ï¼šåˆç†åˆ©ç”¨ Plugins è¿›è¡Œä»£ç å‹ç¼©

å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒPlugins ç›¸å½“äº Webpack çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œé€šè¿‡ Plugins ï¼Œæˆ‘ä»¬èƒ½åœ¨ Webpack æ‰§è¡Œåˆ°æŸä¸ªå‘¨æœŸçš„æ—¶å€™ï¼Œå»åšä¸€äº›äº‹æƒ…ã€‚åœ¨æ„å»ºç”Ÿæˆçº¿ä¸Šä»£ç æ—¶ï¼Œä¸ºäº†ä¿è¯æ–‡ä»¶ä½“ç§¯å°ï¼Œç”¨æˆ·åŠ è½½é€Ÿåº¦èƒ½å¿«ä¸€äº›ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»£ç è¿›è¡Œå‹ç¼©ã€‚

- **CSS éƒ¨åˆ†çš„ä»£ç å‹ç¼©**

æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ [optimize-css-assets-webpack-plugin](https://www.npmjs.com/package/optimize-css-assets-webpack-plugin) æ’ä»¶å¯¹ CSS ä»£ç è¿›è¡Œå‹ç¼©ã€‚è®©æˆ‘ä»¬å…ˆæ¥å®‰è£…ï¼Œè®°ä½äº†ï¼Œè¿™é‡Œéœ€è¦å®‰è£… 4.0.0 ç‰ˆæœ¬

> âš  æ¥è‡ªå®˜æ–¹è¯´æ˜ï¼šFor webpack v3 or below please useÂ `optimize-css-assets-webpack-plugin@3.2.0`. TheÂ `optimize-css-assets-webpack-plugin@4.0.0`Â version and above supports webpack v4.

```bash
npm install optimize-css-assets-webpack-plugin@4.0.0 --save-dev
```

æ ¹æ®å®˜æ–¹æä¾›çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ `webpack/webpack.render.prod.js` é…ç½®

```js
// webpack/webpack.render.prod.js

const webpackMerge = require('webpack-merge');
const renderBaseConfig = require('./webpack.render.base.js');
const OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin');

const prodConfig = {
  mode: 'production',
  plugins: [new OptimizeCssAssetsPlugin({})],
};

module.exports = webpackMerge.merge(renderBaseConfig, prodConfig);
```

åŒæ—¶æˆ‘ä»¬è¿˜èƒ½é‡‡ç”¨ [mini-css-extract-plugin](https://v4.webpack.docschina.org/plugins/mini-css-extract-plugin/) æ’ä»¶å°† CSS æå–åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚å®ƒä¸ºæ¯ä¸ªåŒ…å« CSS çš„ JS æ–‡ä»¶åˆ›å»ºä¸€ä¸ª CSS æ–‡ä»¶ã€‚è®©æˆ‘ä»¬æ¥å®‰è£…å®ƒ

```bash
npm install mini-css-extract-plugin@^1.0.0 --save-dev
```

è¯·æ³¨æ„å•Šï¼Œè¿™é‡Œä¸è¦æˆ @2.x ç‰ˆæœ¬ï¼Œä¸ç„¶å°±ä¼šæŠ¥è¿™ä¸ªé—®é¢˜: [TypeError: Invalid value used in weak set](https://github.com/webpack-contrib/mini-css-extract-plugin/issues/779)

ç„¶åæ ¹æ®å®˜æ–¹æ–‡æ¡£é…ç½®ï¼Œæ¥ä¿®æ”¹ä¸€ä¸‹ `webpack/webpack.render.prod.js` é…ç½®

```js
// webpack/webpack.render.prod.js

const webpackMerge = require('webpack-merge');
const renderBaseConfig = require('./webpack.render.base.js');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin');

const prodConfig = {
  mode: 'production',
  plugins: [
    new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css',
      chunkFilename: '[id].[contenthash].css',
    }),
    new OptimizeCssAssetsPlugin({}),
  ],
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader'],
      },
    ],
  },
};

module.exports = webpackMerge.merge(renderBaseConfig, prodConfig);
```

- **JS éƒ¨åˆ†çš„ä»£ç å‹ç¼©**

`webpack.UglifyjsWebpackPlugin` æ˜¯å®˜æ–¹ç»´æŠ¤çš„æ’ä»¶ï¼Œä½†å®ƒæ˜¯å•çº¿ç¨‹å‹ç¼©ä»£ç ï¼Œæ„å‘³ç€æ¯ä¸ª js æ–‡ä»¶éœ€è¦æ’é˜Ÿï¼Œä¾æ¬¡è¿›è¡Œå‹ç¼©ã€‚ä½†å‹ç¼©ä»£ç çš„æ—¶å€™å®ƒåˆå¾ˆè€—æ—¶ï¼Œå®ƒå¾—å…ˆå°†ä»£ç è½¬æˆ AST æŠ½è±¡è¯­æ³•æ ‘ï¼Œå†ç”¨ä¸€äº›è§„åˆ™å»åˆ†æå¤„ç† ASTï¼Œå·´æ‹‰å·´æ‹‰ä¸€é¡¿æ“ä½œä¹‹åå†è¿›è¡Œå‹ç¼©ã€‚

æ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦è¿™ä¹ˆæ•´ï¼Œè¿™è°é¡¶å¾—ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¢å¯»ä¸€æ¡æ–°çš„é“è·¯ï¼Œé€šè¿‡æŸ¥è¯¢ï¼Œæœ‰ä¸¤ä¸ªæ–°çš„æ’ä»¶èƒ½å»å®ç°

- [ âœ¨ terser-webpack-plugin](https://www.npmjs.com/package/terser-webpack-plugin)
- [webpack-parallel-uglify-plugin](https://www.npmjs.com/package/webpack-parallel-uglify-plugin)

åˆ°åº•ç”¨å“ªä¸ªå‘¢ï¼Ÿé€šè¿‡å¯¹æ¯”ä¸‹è½½é‡ï¼Œå¹¶ä¸”çœ‹å®˜æ–¹è¯´æ˜ï¼Œ`terser-webpack-plugin` ä¸º Webpack æ˜åª’æ­£å¨¶ï¼Œä¸“é—¨ç»´æŠ¤çš„æ’ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç”¨æ­¤æ’ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œå…ˆæ¥å®‰è£…ä¸‹

```bash
npm install terser-webpack-plugin --save-dev
```

è€è§„çŸ©ï¼Œçœ‹æ–‡æ¡£ï¼Œä¿®æ”¹ `webpack/webpack.render.prod.js`ï¼Œéƒ¨åˆ†ä»£ç çœç•¥

```js
/* eslint-disable @typescript-eslint/no-require-imports */
const webpackMerge = require('webpack-merge');
const renderBaseConfig = require('./webpack.render.base.js');
const TerserPlugin = require('terser-webpack-plugin');

const prodConfig = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        cache: true,
        parallel: true,
        sourceMap: false,
      }),
    ],
  },
};

module.exports = webpackMerge.merge(renderBaseConfig, prodConfig);
```

è®©æˆ‘ä»¬æ¥å¯¹ä¸å¯¹æ¯”ï¼Œä¸‹é¢è¿™å¼ å›¾æ˜¯ä¸ºä½¿ç”¨è‡ªå¸¦çš„ `UglifyJsPlugin`ï¼Œæ‰“åŒ…æ—¶é•¿åœ¨ 16s å·¦å³

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/177b58d419ea4bd78e33e90395e6e4ab~tplv-k3u1fbpfcp-watermark.image)

é€šè¿‡ `terser-webpack-plugin` ä¹‹åï¼Œåœ¨ç¬¬ä¸€æ¬¡æ„å»ºæ‰“åŒ…ç›¸å¯¹è¾ƒä¹…ï¼Œä½†ä¹‹åçš„æ„å»ºæ‰“åŒ…ï¼Œç”±äºæˆ‘ä»¬è®¾ç½®äº† `cache` ä»¥åŠ `parallel` å±æ€§ï¼Œæ—¶é—´å˜å¾—æ›´å¿«ï¼Œç»è¿‡ä¸‰æ¬¡æ„å»ºï¼Œæ—¶é•¿å‡åœ¨ 10s å·¦å³

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5e03354902c46b7b99c3914f38f8d57~tplv-k3u1fbpfcp-watermark.image)

é‚£ä¹ˆå°±ä¼šæœ‰å°ä¼™ä¼´ç–‘æƒ‘äº†ï¼Œä¸ºå•¥ä½ ä¸åœ¨ `webpack.render.dev.js` ä¸­ä¹Ÿåšä»£ç å‹ç¼©å‘¢ï¼Ÿä½ è¦çŸ¥é“ï¼Œ**åšä»»ä½•äº‹éƒ½éœ€è¦æˆæœ¬çš„**ï¼Œä½ å‹ç¼©ä»£ç ä¹Ÿéœ€è¦è€—è´¹æ—¶é—´ï¼Œæˆ‘ä»¬ä¹‹æ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒåšä»£ç å‹ç¼©æ˜¯å› ä¸ºæˆ‘ä»¬æœŸæœ›ç”¨æˆ·åŠ è½½é€Ÿåº¦èƒ½å¿«ä¸€äº›ï¼Œ`æœ‰èˆæ‰æœ‰çš„`ï¼Œæˆ‘ä»¬å¼€å‘äººå‘˜å¿ä½æ„å»ºæ—¶å‹ç¼©ä»£ç çš„ç­‰å¾…æ—¶é—´ï¼Œå°±èƒ½è®©ç”¨äºåŠ è½½èµ„æºé€Ÿåº¦èƒ½æ›´å¿«ä¸€äº›ã€‚

### ğŸ”¨ ä¼˜åŒ–å…­ï¼šHappyPack åŠ é€Ÿæ„å»º

è¿è¡Œåœ¨ NodeJS ä¸Šçš„ Webpack æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå¯¹äºå•çº¿ç¨‹æ¥è¯´ï¼Œæ¯ä¸€ä»¶äº‹æƒ…éƒ½éœ€è¦æŒ¨ä¸ªå¤„ç†ï¼Œè¦çŸ¥é“ Webpack æ„å»ºå¯æ˜¯å¯¹å¤§é‡æ–‡ä»¶åšè§£æå¤„ç†çš„ï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ¥ï¼Œå²‚ä¸æ˜¯è¦æŠŠäººé€¼ç–¯ï¼Ÿ

é‚£ä¹ˆèƒ½å¦è®© Webpack åŒä¸€æ—¶åˆ»å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œå‘æŒ¥å¤šæ ¸ CPU ç”µè„‘ä¼˜åŠ¿ï¼Œä»è€Œæé«˜æˆ‘ä»¬çš„æ„å»ºé€Ÿåº¦ï¼Ÿè‚¯å®šæœ‰äººç ”ç©¶è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆå°±æ˜¯ï¼š[happypack](https://www.npmjs.com/package/happypack)

å…ˆæ¥å®‰è£…ä¸€ä¸‹

```bash
npm install happypack --save-dev
```

ç„¶åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ `webpack/webpack.render.base.js` æ–‡ä»¶

```js
// webpack/webpack.render.base.js

const path = require('path');
const CopyWebpackPlugin = require('copy-webpack-plugin');
const HtmlWebpackPlugin = require('html-webpack-plugin');
// ğŸ‘‡ å¼•å…¥ happypack
const HappyPack = require('happypack');

module.exports = {
  module: {
    rules: [
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        // use: {
        //   loader: 'babel-loader',
        // },
        loader: 'HappyPack/loader?id=visResumeMookHappyPack',
      },
    ],
  },
  plugins: [
    new HappyPack({
      id: 'visResumeMookHappyPack',
      threads: 8,
      loaders: [
        {
          loader: 'babel-loader',
        },
      ],
    }),
  ],
};
```

ç„¶åæˆ‘ä»¬æ¥è¯•è¯•ï¼Œçœ‹çœ‹æ‰“åŒ…çš„æ—¶é•¿

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d321de9ef6747789f9e45e4bb905653~tplv-k3u1fbpfcp-watermark.image)

giao ï¼ åå€’æ˜¯æ—¶é—´è¢«æ‹‰é•¿äº†ï¼Ÿè¿™...äºæ˜¯æˆ‘å°±å»æœç´¢ï¼Œçœ‹çœ‹ç½‘ä¸Šæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ¡ˆï¼Œæ— æ„ä¸­å‘ç°æœ‰äººé‡åˆ°è¿‡ç€ç´¯é—®é¢˜ï¼Œæˆ‘ä¸¢ï¼Œè¿™å‘çˆ¹äº†ï¼Œå¼€å¯å¤šçº¿ç¨‹ï¼ŒCPU ä¸Šå‡ï¼Œå¦‚æœæ­¤æ—¶ CPU æ»¡äº†çš„è¯ï¼Œæ•´ä½“é€Ÿåº¦ä¼šå˜æ…¢ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d730daa7b874e0382a3f0210fb24ca1~tplv-k3u1fbpfcp-watermark.image)

æˆ‘ä»¬å¯ä»¥é€šè¿‡ [speed-measure-webpack-plugin](https://www.npmjs.com/package/speed-measure-webpack-plugin) æ’ä»¶æ¥çœ‹çœ‹ Webpack å¤„ç†çš„æ—¶é•¿ï¼Œå…ˆæ¥å®‰è£…ä¸€ä¸‹

```
npm install --save-dev speed-measure-webpack-plugin
```

ç„¶åä¿®æ”¹ä¸€ä¸‹é…ç½®

```js
// webpack/webpack.render.base.js

const path = require('path');
const CopyWebpackPlugin = require('copy-webpack-plugin');
const HtmlWebpackPlugin = require('html-webpack-plugin');
// ğŸ‘‡ å¼•å…¥ happypack
const HappyPack = require('happypack');
// ğŸ‘‡ å¼•å…¥é€Ÿåº¦åˆ†ææ’ä»¶
const SpeedMeasurePlugin = require('speed-measure-webpack-plugin');
const smp = new SpeedMeasurePlugin();

module.exports = smp.wrap({
  module: {
    rules: [
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        // use: {
        //   loader: 'babel-loader',
        // },
        loader: 'HappyPack/loader?id=visResumeMookHappyPack',
      },
    ],
  },
  plugins: [
    new HappyPack({
      id: 'visResumeMookHappyPack',
      threads: 8,
      loaders: [
        {
          loader: 'babel-loader',
        },
      ],
    }),
  ],
});
```

æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ç›¸å…³çš„ä¸€äº›ä¿¡æ¯

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/433a568ff59f4a9597a09c76f6568566~tplv-k3u1fbpfcp-watermark.image)

å¤©å•Šï¼Œè¿™å°±å¾ˆè›‹ç–¼äº†ï¼Œç”¨äº† happypack ä¹‹ååè€Œå˜æ…¢äº†ã€‚

**æ€»ä¹‹ï¼Œè¿™ä¸ªæ’ä»¶å¤§å®¶è‡ªè¡Œè¡¡é‡ï¼Œè¿™è¾¹å°å†Œå°±ä¸é‡‡ç”¨æ­¤æ–¹æ¡ˆè¿›è¡Œå¤„ç†ï¼Œæ·±å…¥å»äº†è§£ä¸ºä»€ä¹ˆï¼Œæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„æ€çš„äº‹ï¼ŒåŒ…æ‹¬ä½ å¯ä»¥é¡ºé“æ‰©å®½ä¸€ä¸‹å•çº¿ç¨‹/å¤šçº¿ç¨‹ã€è¿›ç¨‹ä¸çº¿ç¨‹çš„ç›¸å…³çŸ¥è¯†ã€‚**

### ğŸ”¨ ä¼˜åŒ–ä¸ƒï¼šç¬¬ä¸‰æ–¹åŒ…æ‰“æˆ dll.js æ–‡ä»¶

æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ï¼Œä¼šå¼•ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹åŒ…ã€‚æ¯”å¦‚

```js
import React from 'react';
import ReactDOM from 'react-dom';
import logger from 'redux-logger';
import { Provider } from 'react-redux';
import { createStore, applyMiddleware, combineReducers } from 'redux';
```

è¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“æ²¡åˆ—ä¸¾å‡ºæ¥ï¼Œé‚£ä¹ˆå¯¹äºè¿™ç§ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¸éœ€è¦æ¯ä¸€æ¬¡æ‰“åŒ…éƒ½é‡æ–°æ„å»ºï¼Œå¯ä»¥å°†å®ƒä½œä¸ºä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ—¶å°†ç¬¬ä¸‰æ–¹æ‰“åŒ…å³å¯ï¼Œä¹‹åæ¯æ¬¡æ‰“åŒ…éƒ½ç”¨ä¸Šä¸€æ¬¡çš„å³å¯ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ†ä¸¤æ­¥æ‰§è¡Œ

- å°†ç¬¬ä¸‰æ–¹åŒ…æ‰“æˆä¸€ä¸ªæ–‡ä»¶ï¼Œåªç”Ÿæˆä¸€æ¬¡
- ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—æ—¶ï¼Œæ˜¯ä» dll æ–‡ä»¶ï¼Œè€Œéä» node_modules

å…ˆæ¥å®ç°ç¬¬ä¸€æ­¥ï¼Œåœ¨ webpack æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å¢ `dll` ç›¸å…³çš„é…ç½®ï¼Œæ–°å¢ `webpack.dll.base.js`ã€`webpack.dll.prod.js`ï¼Œç„¶åç¼–å†™ä¸€ä¸‹ç›¸å…³ä»£ç 

> å°ä¼™ä¼´ä¸è¦å¥‡æ€ªæ€ä¹ˆæ²¡æœ‰ dev ç¯å¢ƒä¸‹ï¼Œå› ä¸ºå¼€å‘ç¯å¢ƒä¸‹ä» `node_module` å–ï¼Œå¹¶æ²¡å•¥æ¯›ç—…

> æˆ‘ä»¬ä¹‹æ‰€ä»¥æŠŠç¬¬ä¸‰æ–¹åŒ…æ‰“æˆä¸€ä¸ªæ–‡ä»¶ï¼Œæ˜¯å› ä¸ºæ¯æ¬¡æ‰“åŒ…æ„å»ºï¼Œè¿™äº›ç¬¬ä¸‰æ–¹åŒ…åˆè¦æ‰“ä¸€æ¬¡ï¼Œæ¯”è¾ƒè€—æ—¶è€Œå·²ï¼Œå¦‚æœä½ èƒ½æ¥å—ï¼Œå…¶å®ä¸ç”¨ dll ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚

```js
// webpack/webpack.dll.base.js

const path = require('path');
module.exports = {
  entry: {
    // ğŸ‘‡ æˆ‘è¿™é‡Œå°† lodash ä¹Ÿæ”¾åœ¨ reacts ä¸­äº†ï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥æ‹†åˆ†çš„
    reacts: ['react', 'react-dom', 'redux', 'react-redux', 'lodash'],
  },
  output: {
    library: '[name]',
    filename: '[name].dll.js',
    path: path.resolve(__dirname, '../dist/dll'),
  },
};
```

```js
// webpack/webpack.dll.prod.js

const webpackMerge = require('webpack-merge');
const dllBaseConfig = require('./webpack.dll.base.js');

module.exports = webpackMerge.merge(dllBaseConfig, {
  mode: 'production',
});
```

æ­¤æ—¶æˆ‘ä»¬å» `package.json` ä¸­æ·»åŠ ä¸€ä¸‹æ‰“åŒ…æˆ dll çš„è„šæœ¬å‘½ä»¤

```json
{
  "scripts": {
    "build:dll": "webpack --config ./webpack/webpack.dll.prod.js"
  }
}
```

ç„¶åæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä¸€ä¸‹ `npm run build:dll`ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ dist ç›®å½•ä¸‹ï¼Œå­˜åœ¨æ­¤æ–‡ä»¶å¤¹

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72e910e26741485da2db9bfb9d5a8173~tplv-k3u1fbpfcp-watermark.image)

æˆ‘ä»¬ç‚¹è¿›å»çœ‹çœ‹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ `react` æºç ã€`react-dom` æºç ç­‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°†ç¬¬ä¸‰æ–¹æ‰“åˆ°ä¸€ä¸ªæ–‡ä»¶ `reacts.dll.js`ï¼Œä½†æˆ‘ä»¬è¿˜æ²¡ä½¿ç”¨å®ƒï¼Œè¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿå¾€ HTML ä¸ŠåŠ æ–‡ä»¶ã€‚

å¦‚ä½•åœ¨é™æ€æ¨¡ç‰ˆ HTML ä¸­æ·»åŠ é™æ€èµ„æºï¼Ÿå¯ä»¥é€šè¿‡ [add-asset-html-webpack-plugin](https://www.npmjs.com/package/add-asset-html-webpack-plugin) æ’ä»¶è¿›è¡Œå¤„ç†ï¼Œè®©æˆ‘ä»¬æ¥å®‰è£…ä¸€ä¸‹

```js
npm install add-asset-html-webpack-plugin --save-dev
```

ç„¶åå‰å¾€ `webpack/webpack.render.base.js` ä¸­æ·»åŠ ä¸€ä¸‹ä»£ç ï¼Œéƒ¨åˆ†ä»£ç çœç•¥

```js
const AddAssetHtmlWebpackPlugin = require('add-asset-html-webpack-plugin');

module.exports = {
  plugins: [
    new AddAssetHtmlWebpackPlugin({
      // ğŸ‘‡ å¼•å…¥åˆšæ‰çš„ reacts.dll.js æ–‡ä»¶
      filepath: path.resolve(__dirname, '../dist/dll/reacts.dll.js'),
    }),
  ],
};
```

æˆ‘ä»¬å¯åŠ¨ä¸€ä¸‹é¡¹ç›®ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ·»åŠ  `reacts.dll.js` æ–‡ä»¶è¿›æ¥ã€‚

```
npm run start:main
npm run start:render
```

æ‰“å¼€æ§åˆ¶å°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¼•å…¥å‘¢ï¼Ÿ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49e54b23315c4027ad15ca7d87294549~tplv-k3u1fbpfcp-watermark.image)

ç¬¬ä¸€æ­¥æˆ‘ä»¬å®ç°äº†ï¼Œå·²ç»ç”Ÿæˆå¥½äº† dll æ–‡ä»¶ï¼Œä½†å¥½åƒå¹¶æ²¡ä»€ä¹ˆç”¨ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸‰æ–¹ä»ç„¶è¿˜æ˜¯ä» `node_modules` å–çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬è¦å€ŸåŠ© `webpack.DLLPlugin` è¿›è¡Œå®ç°ã€‚

æˆ‘ä»¬å…ˆæ¥ä¿®æ”¹ `webpack/webpack.dll.base.js` æ–‡ä»¶

```js
// webpack/webpack.dll.base.js

const path = require('path');
const webpack = require('webpack');

module.exports = {
  entry: {
    reacts: ['react', 'react-dom', 'redux', 'react-redux', 'lodash'],
  },
  output: {
    library: '[name]',
    filename: '[name].dll.js',
    path: path.resolve(__dirname, '../dist/dll'),
  },
  plugins: [
    // ğŸ‘‡ æ–°å¢å˜é‡
    new webpack.DllPlugin({
      name: '[name]',
      path: path.resolve(__dirname, '../dist/dll/[name].manifest.json'),
    }),
  ],
};
```

ç„¶åæˆ‘ä»¬å†åˆ° `webpack/webpack.render.base.js` ä¸­ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œéƒ¨åˆ†ä»£ç çœç•¥

```js
const webpack = require('webpack');

module.exports = {
  plugins: [
    new webpack.DllReferencePlugin({
      manifest: path.resolve(__dirname, '../dist/dll/reacts.manifest.json'),
    }),
  ],
};
```

å½“æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…æ—¶ï¼Œä¼šå…ˆåœ¨ `reacts.manifest.json` æ‰¾ç¬¬ä¸‰æ–¹æ¨¡å—çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœå­˜åœ¨æ˜ å°„å…³ç³»ï¼Œå°±ä¸éœ€è¦æ‰“åŒ…è¿›æ¥ï¼Œå®ƒç›´æ¥ä»å…¨å±€å˜é‡æ‹¿ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡ `webpack.DllPlugin` å®šä¹‰äº†å…¨å±€å˜é‡ï¼Œæ‹¿çš„æ˜¯ `reacts.dll.js`ï¼Œé‚£å¦‚æœæ²¡æœ‰æ˜ å°„å…³ç³»ï¼Œå°±ä¼šä» `node_modules` ä¸­æ‹¿è¿‡æ¥æ‰“åŒ…ã€‚

æ­¤æ—¶æˆ‘ä»¬æ¥å®Œæ•´æ‰“åŒ…ä¸€ä¸‹

```bash
// åˆ é™¤distç›®å½•
rm -rf dist
// ç¬¬ä¸‰æ–¹åŒ…ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶
npm run build:dll
// æ„å»º Electron
npm run build:main
// æ„å»º React
npm run build:render
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ `dist/dll` ç›®å½•ä¸‹ï¼Œå­˜åœ¨ç€ `reacts.dll.js` å’Œ `reacts.manifest.json`

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/186db9bb83e24ea1b1d5dde743e0c812~tplv-k3u1fbpfcp-watermark.image)

æ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹è¿›å»çœ‹çœ‹ `reacts.manifest.json` åˆ°åº•æ˜¯ä¸ªå•¥ä¸œè¥¿

æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹é€šè¿‡ dll ä¹‹åçš„æ‰“åŒ…æ—¶é•¿æœ‰å¤šå°‘

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2326333970ad4e0d872d21e08a1152c2~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4134c4f9774647ddb33bb4182dd2b017~tplv-k3u1fbpfcp-watermark.image)

## æœ€å

å…¶å®æé«˜ Webpack çš„æ‰“åŒ…é€Ÿåº¦è¿˜æœ‰å¾ˆå¤šï¼Œä¸Šé¢åªæ˜¯å¸¸è§çš„å‡ ç§æ–¹å¼ï¼Œæ›´å¤šä¼˜åŒ–æŠ€å·§å°ä¼™ä¼´ä»¬å¯ä»¥ç§ä¸‹ç¿»é˜…ä¸€äº›èµ„æ–™è¿›è¡ŒçŸ¥è¯†çš„è¡¥å……ã€‚å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œçœ‹å®Œä¸€å®šè¦åŠ¨æ‰‹å®æˆ˜ï¼Œæ‰èƒ½è¿›æ­¥ã€‚
