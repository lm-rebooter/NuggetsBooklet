## å¸¸è§é—®é¢˜çš„è§£å†³

> å¦‚æœæ‚¨åœ¨è¾¹é˜…è¯»è¾¹å®è·µæ—¶ï¼Œå‘ç°ä»£ç æŠ¥é”™æˆ–è€… TS æŠ¥é”™ï¼Œé‚£ä¹ˆå°ä¼™ä¼´ä»¬å¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯ï¼Œå»çº¿ä¸Šçœ‹çœ‹ç›¸åº”çš„ä»£ç ã€‚

### Q1: Uncaught ReferenceError: require is not defined

å¦‚æœå‡ºç°ä¸Šè¿°æŠ¥é”™ï¼Œè¯·æ£€æŸ¥ä½ æ˜¯å¦åœ¨ä¸»è¿›ç¨‹ä¸­æ·»åŠ è¿™è¡Œä»£ç 

```js
// åˆ›å»ºæµè§ˆå™¨çª—å£
const mainWindow = new BrowserWindow({
  // ...
  webPreferences: {
    // ğŸ‘‡ è¯·ç¡®ä¿æ·»åŠ æ­¤é…ç½®
    nodeIntegration: true,
  },
});
```

å¦‚æœæ·»åŠ äº†ï¼Œå¹¶ä¸”é‡è·‘ `npm run start:main` ä¹‹åä»è¿˜æ˜¯æ­¤é—®é¢˜ï¼Œé‚£ä¹ˆè¯·ç¡®ä¿ä½ æ­å»ºé¡¹ç›®çš„ Electron ä¸æœ¬åº”ç”¨çš„ç‰ˆæœ¬ä¸€è‡´(å½“å‰é¡¹ç›®çš„ Electron@11.1.1)

> è¯·è‡ªæ£€æŸ¥ä¸€ä¸‹ä½ çš„ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼Œè¿›å…¥ node_modules/electron/package.json ï¼ŒæŸ¥çœ‹ version æ˜¯å¦æ˜¯ 11.1.1ã€‚

å¦‚æœç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œè¯·é‡è£… electron@11.1.1 ç‰ˆæœ¬ã€‚åœ¨ç¡®ä¿ Electron ç‰ˆæœ¬æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œé‡æ–°è¿è¡Œä¸€ä¸‹æœ¬åœ°å¼€å‘è„šæœ¬ã€‚

```
npm run start:render
npm run start:main
```

å¦‚æœä½ å°±æ˜¯æƒ³è¦é«˜ç‰ˆæœ¬ï¼Œæ¯”å¦‚ v13ç‰ˆæœ¬ä¹‹ä¸Šï¼Œé‚£ä¹ˆä½ éœ€è¦å°†é…ç½®æ”¹ä¸ºï¼š

```js
// åˆ›å»ºæµè§ˆå™¨çª—å£
const mainWindow = new BrowserWindow({
  // ...
  webPreferences: {
    // ğŸ‘‡ è¯·ç¡®ä¿æ·»åŠ æ­¤é…ç½®
    nodeIntegration: true,
    contextIsolation: false
  },
});
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3146db129fd344688e5050dbe7e1223d~tplv-k3u1fbpfcp-watermark.image)

æ„Ÿå…´è¶£çš„å¯å‰å¾€[å®˜ç½‘-ä¸Šä¸‹æ–‡éš”ç¦»
](https://www.electronjs.org/docs/tutorial/context-isolation#%E6%88%91%E8%AF%A5%E5%A6%82%E4%BD%95%E5%90%AF%E7%94%A8%EF%BC%9F)ã€[å®˜ç½‘-ä¸ºè¿œç¨‹å†…å®¹å¼€å¯ä¸Šä¸‹æ–‡éš”ç¦»](https://www.electronjs.org/docs/tutorial/security#3-%E4%B8%BA%E8%BF%9C%E7%A8%8B%E5%86%85%E5%AE%B9%E5%BC%80%E5%90%AF%E4%B8%8A%E4%B8%8B%E6%96%87%E9%9A%94%E7%A6%BB)ã€æˆ–è€…[github](https://github.com/electron/electron/issues/23506)æŸ¥çœ‹æ›´æ–°è¯´æ˜

------

**é¢˜å¤–è¯**ï¼šæœ‰å°ä¼™ä¼´è¯´ï¼Œä¸ºä»€ä¹ˆæˆ‘ React èµ·çš„ dev-serverï¼Œåœ¨ Chrome æµè§ˆå™¨é‡Œè®¿é—® `http://127.0.0.1:7001` çœ‹ä¸åˆ°é¡µé¢æ•ˆæœï¼Œä½†æ˜¯åœ¨ Electron åº”ç”¨ä¸­å°±çœ‹åˆ°é¡µé¢æ•ˆæœã€‚

åŸå› åœ¨äºæˆ‘ä»¬çš„ target é…ç½®ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡ [webpack target](https://webpack.js.org/configuration/target) å®˜ç½‘é…ç½®çœ‹åˆ°ç›¸å…³è¯´æ˜

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ccbf001f2d2244e592eb21f2a152b3c9~tplv-k3u1fbpfcp-watermark.image)

**ä½ å¯ä»¥åšä¸ªå°è¯•**ï¼Œä½ ç»ˆæ­¢ Electron åº”ç”¨çš„è¿è¡Œï¼Œç„¶åè¿›å…¥ `webpack.render.dev.js` æ–‡ä»¶ä¸­ï¼Œå°† target å±æ€§è®¾ç½®ä¸ºé»˜è®¤çš„ webï¼Œç„¶åè¿è¡Œ npm run start:render

> è¿™é‡Œæˆ‘åªæ˜¯è®©å°ä¼™ä¼´ä»¬åšä¸ªå°è¯•ï¼Œä½ å°è¯•å®Œä¹‹åï¼Œä»£ç è¿˜æ˜¯è¦è¿˜åŸåˆ°ä¹‹å‰çš„é…ç½®ï¼Œä½ è¿™é‡Œåªæ˜¯å°è¯•ï¼Œå°è¯•å•Šï¼Œå¹¶ä¸æ˜¯è®©ä½ çœŸçš„å»æ”¹é…ç½®

æ­¤æ—¶æˆ‘ä»¬å» Chrome æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ `http://127.0.0.1:7001`ï¼Œè¿™æ—¶å€™å°±èƒ½æ­£å¸¸çœ‹åˆ°é¡µé¢æ•ˆæœäº†ã€‚

> è¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯ [init-cli](https://github.com/PDKSophia/visResumeMook/tree/init-cli) åˆ†æ”¯è¿›è¡Œæ¼”ç¤ºã€‚å¦‚æœä½ å°† target æ”¹æˆ web ä¹‹åä¸èƒ½è®¿é—®ï¼Œè¯´æ˜ä½ çš„ react ä»£ç ä¸­ç”¨åˆ°äº† Node çš„ä¸€äº›ç‰¹æ€§ï¼ˆæ¯”å¦‚ä½ åœ¨ React ä»£ç ä¸­ç”¨åˆ°äº† fs æ¨¡å—ã€path æ¨¡å—ç­‰ï¼‰ï¼Œè€Œæµè§ˆå™¨æ˜¯ä¸çŸ¥é“ Node æ˜¯ä»€ä¹ˆä¸œè¥¿çš„ã€‚

> ä¹‹æ‰€ä»¥ init-cli åˆ†æ”¯ä»£ç å¯è¡Œï¼Œæ˜¯å› ä¸ºæ­¤æ—¶çš„ React ä¸­æ²¡æœ‰æ¶‰åŠ Node ç›¸å…³ä»£ç ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿåœ¨ Chrome ä¸­çœ‹åˆ°æ•ˆæœå±•ç¤ºï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆèƒ½åœ¨ Electron ä¸­èƒ½çœ‹åˆ°æ•ˆæœå‘¢ï¼Ÿå› ä¸º Electron å†…ç½®äº† NodeJSï¼Œä¸ºæ­¤æˆ‘ä»¬å¯¹åº”å°†  target æ”¹æˆäº† electron-rendererï¼Œçœ‹ä¸Šé¢æ–‡æ¡£æœ‰è¯´æ˜ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df005d0f62bb45f1af36164c0a2f7b10~tplv-k3u1fbpfcp-watermark.image)

### Q2: å›¾ç‰‡ icon å¹¶æœªæ­£ç¡®æ˜¾ç¤ºï¼Œbackground: url([object Module])

å¦‚æœå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒï¼š[webpack 4 gives background: url([object Module]) as bg image](https://stackoverflow.com/questions/57671995/webpack-4-gives-background-urlobject-module-as-bg-image)

è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨ `webpack.base.js` æ–‡ä»¶ä¸­ï¼Œå¯¹ file-loader çš„ options æ·»åŠ  esModule é…ç½®

```js
module: {
  rules: [
    {
      test: /\.(jpg|png|jpeg|gif)$/,
      use: [
        {
          loader: 'file-loader',
          options: {
            name: '[name]_[hash].[ext]',
            outputPath: 'images/',
            esModule: false
          },
        },
      ],
    },
  ],
}
```

### Q3: æ–‡ä»¶éƒ¨åˆ†ç±»å‹ TS æŠ¥çº¢

å¦‚æœä½ å¼•å…¥ pngã€jpeg ç±»å‹æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯ less æ–‡ä»¶ï¼Œå¯¼è‡´ TS æŠ¥é”™ï¼ˆçº¢è‰²æ³¢æµªçº¿ï¼‰ï¼Œè¯´æ‰¾ä¸åˆ°æ¨¡å—ï¼Œå®é™…ä¸Šæˆ‘ä»¬çš„è·¯å¾„æ˜¯æ­£ç¡®çš„ï¼Œé¡¹ç›®èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚

å¦‚æœå»æ‰è¿™è†ˆåº”äººçš„çº¢è‰²æ³¢æµªçº¿å‘¢ï¼Ÿè¿›å…¥åˆ° global.d.tsï¼Œè¿›è¡Œç±»å‹å£°æ˜ã€‚

```ts
// png ç±»å‹å£°æ˜
declare module '*.png' {
  const png: string;
  export default png;
}

// svg ç±»å‹å£°æ˜
declare module '*.svg';

// png ç±»å‹å£°æ˜
declare module '*.less';

// rc-redux-model ç±»å‹å£°æ˜
declare module 'rc-redux-model';
```

> åå°æœ‰ä½å°ä¼™ä¼´æå‡ºä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦å•ç‹¬åœ¨ global.d.ts é‡Œå†™ç±»å‹å£°æ˜ï¼Œåƒåœ¨ webpack çš„ resolve çš„ extensions ä¸­æ”¯æŒ .lessã€.png ä¸è¡Œå—ï¼Ÿè¿˜çœŸä¸è¡Œï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥æŸ¥çœ‹[è¿™ç¯‡æ–‡ç« ](https://stackoverflow.com/questions/36148639/webpack-not-able-to-import-images-using-express-and-angular2-in-typescript/36151803#36151803)

### Q4: Uncaught ReferenceError: global is not defined

å¦‚æœå‡ºç°ä¸Šè¿°æŠ¥é”™ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯ä½  babel ç›¸å…³é…ç½®é…ç½®çš„é—®é¢˜ï¼ˆå¯ä»¥æ£€æŸ¥ä¸€ä¸‹ç‰ˆæœ¬æˆ–è€…é…ç½®æ˜¯å¦ä¸å°å†Œä¸€è‡´ï¼‰ï¼Œè¯´å®åœ¨è¯ï¼Œå°ç¼–ç›®å‰æœªé‡åˆ°æ­¤é—®é¢˜ï¼Œæš‚æ—¶æ— æ³•å¤ç°å»å®šä½ï¼Œç›®å‰åœ¨ webpack çš„å®˜æ–¹ issues ä¹Ÿæœ‰æ‰¾åˆ°ç›¸å…³çš„èµ„æ–™ã€‚

- [Uncaught ReferenceError: global is not defined](https://github.com/webpack/webpack/issues/10035)
- [Uncaught ReferenceError: global is not defined at Object../node_modules/fbjs/lib/setImmediate.js](https://stackoverflow.com/questions/58936238/uncaught-referenceerror-global-is-not-defined-at-object-node-modules-fbjs-lib)

## æœ€å

å°ä¼™ä¼´ä»¬ä¸€å®šè¦è¿›ç¾¤ï¼åœ¨ç¾¤é‡Œé¢äº¤æµæ‰æ˜¯æœ€å¿«è§£å†³é—®é¢˜çš„æ–¹æ¡ˆï¼Œè®°ä½ï¼Œå½­äºæ™ä¸ä½ ä»¬åŒåœ¨ã€‚

ğŸ‘‡ ä¸‹é¢æ˜¯è¿›ç¾¤çš„æ–¹å¼

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b5e1abe9188411895c45eeeef7ab003~tplv-k3u1fbpfcp-watermark.image)
